<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <style>
            
        </style>
        <link rel="stylesheet" href="file:///Users/joshchen/projects/repo-to-pdf/html5bp/css/normalize.css">
        <link rel="stylesheet" href="file:///Users/joshchen/projects/repo-to-pdf/html5bp/css/main.css">
        <link rel="stylesheet" href="file:///Users/joshchen/projects/repo-to-pdf/html5bp/css/github-min.css">
        <link rel="stylesheet" href="file:///Users/joshchen/projects/repo-to-pdf/html5bp/css/vs.css">
        <script src="file:///Users/joshchen/projects/repo-to-pdf/html5bp/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <article class="markdown-body"><h1 id=title-rates-api/src/gql (5) anchor=true>title-rates-api/src/gql (5)</h1>
<h2 id=Contents anchor=true>Contents</h2>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- RateTableCount.ts](#/generated/type-graphql/resolvers/outputs/RateTableCount.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/RateTableCount.ts">                    |- RateTableCount.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- RateTableCountAggregate.ts](#/generated/type-graphql/resolvers/outputs/RateTableCountAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/RateTableCountAggregate.ts">                    |- RateTableCountAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- RateTableGroupBy.ts](#/generated/type-graphql/resolvers/outputs/RateTableGroupBy.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/RateTableGroupBy.ts">                    |- RateTableGroupBy.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- RateTableMaxAggregate.ts](#/generated/type-graphql/resolvers/outputs/RateTableMaxAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/RateTableMaxAggregate.ts">                    |- RateTableMaxAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- RateTableMinAggregate.ts](#/generated/type-graphql/resolvers/outputs/RateTableMinAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/RateTableMinAggregate.ts">                    |- RateTableMinAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- TestCaseAvgAggregate.ts](#/generated/type-graphql/resolvers/outputs/TestCaseAvgAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/TestCaseAvgAggregate.ts">                    |- TestCaseAvgAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- TestCaseCountAggregate.ts](#/generated/type-graphql/resolvers/outputs/TestCaseCountAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/TestCaseCountAggregate.ts">                    |- TestCaseCountAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- TestCaseGroupBy.ts](#/generated/type-graphql/resolvers/outputs/TestCaseGroupBy.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/TestCaseGroupBy.ts">                    |- TestCaseGroupBy.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- TestCaseMaxAggregate.ts](#/generated/type-graphql/resolvers/outputs/TestCaseMaxAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/TestCaseMaxAggregate.ts">                    |- TestCaseMaxAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- TestCaseMinAggregate.ts](#/generated/type-graphql/resolvers/outputs/TestCaseMinAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/TestCaseMinAggregate.ts">                    |- TestCaseMinAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- TestCaseSumAggregate.ts](#/generated/type-graphql/resolvers/outputs/TestCaseSumAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/TestCaseSumAggregate.ts">                    |- TestCaseSumAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- UnderwriterCount.ts](#/generated/type-graphql/resolvers/outputs/UnderwriterCount.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/UnderwriterCount.ts">                    |- UnderwriterCount.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- UnderwriterCountAggregate.ts](#/generated/type-graphql/resolvers/outputs/UnderwriterCountAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/UnderwriterCountAggregate.ts">                    |- UnderwriterCountAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- UnderwriterGroupBy.ts](#/generated/type-graphql/resolvers/outputs/UnderwriterGroupBy.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/UnderwriterGroupBy.ts">                    |- UnderwriterGroupBy.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- UnderwriterMaxAggregate.ts](#/generated/type-graphql/resolvers/outputs/UnderwriterMaxAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/UnderwriterMaxAggregate.ts">                    |- UnderwriterMaxAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- UnderwriterMinAggregate.ts](#/generated/type-graphql/resolvers/outputs/UnderwriterMinAggregate.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/UnderwriterMinAggregate.ts">                    |- UnderwriterMinAggregate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/generated/type-graphql/resolvers/outputs/index.ts) anchor=true><a href="#/generated/type-graphql/resolvers/outputs/index.ts">                    |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- scalars.ts](#/generated/type-graphql/scalars.ts) anchor=true><a href="#/generated/type-graphql/scalars.ts">            |- scalars.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;|- helpers.ts](#/helpers.ts) anchor=true><a href="#/helpers.ts">    |- helpers.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;  /inputs anchor=true>      /inputs</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/inputs/index.ts) anchor=true><a href="#/inputs/index.ts">        |- index.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;  /interfaces anchor=true>      /interfaces</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/interfaces/index.ts) anchor=true><a href="#/interfaces/index.ts">        |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- organizationUser.ts](#/interfaces/organizationUser.ts) anchor=true><a href="#/interfaces/organizationUser.ts">        |- organizationUser.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;  /plugins anchor=true>      /plugins</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- errors.ts](#/plugins/errors.ts) anchor=true><a href="#/plugins/errors.ts">        |- errors.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- examples.ts](#/plugins/examples.ts) anchor=true><a href="#/plugins/examples.ts">        |- examples.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/plugins/index.ts) anchor=true><a href="#/plugins/index.ts">        |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- loggingPlugin.ts](#/plugins/loggingPlugin.ts) anchor=true><a href="#/plugins/loggingPlugin.ts">        |- loggingPlugin.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- metrics.ts](#/plugins/metrics.ts) anchor=true><a href="#/plugins/metrics.ts">        |- metrics.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;  /resolvers anchor=true>      /resolvers</h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /helpers anchor=true>          /helpers</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- fees.ts](#/resolvers/helpers/fees.ts) anchor=true><a href="#/resolvers/helpers/fees.ts">            |- fees.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateManual.ts](#/resolvers/helpers/rateManual.ts) anchor=true><a href="#/resolvers/helpers/rateManual.ts">            |- rateManual.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rates.ts](#/resolvers/helpers/rates.ts) anchor=true><a href="#/resolvers/helpers/rates.ts">            |- rates.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/resolvers/index.ts) anchor=true><a href="#/resolvers/index.ts">        |- index.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /mutations anchor=true>          /mutations</h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /__tests__ anchor=true>              /<strong>tests</strong></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- cplRate.test.ts](#/resolvers/mutations/__tests__/cplRate.test.ts) anchor=true><a href="#/resolvers/mutations/__tests__/cplRate.test.ts">                |- cplRate.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- endorsementRate.test.ts](#/resolvers/mutations/__tests__/endorsementRate.test.ts) anchor=true><a href="#/resolvers/mutations/__tests__/endorsementRate.test.ts">                |- endorsementRate.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- policyRate.test.ts](#/resolvers/mutations/__tests__/policyRate.test.ts) anchor=true><a href="#/resolvers/mutations/__tests__/policyRate.test.ts">                |- policyRate.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateManual.test.ts](#/resolvers/mutations/__tests__/rateManual.test.ts) anchor=true><a href="#/resolvers/mutations/__tests__/rateManual.test.ts">                |- rateManual.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateTable.test.ts](#/resolvers/mutations/__tests__/rateTable.test.ts) anchor=true><a href="#/resolvers/mutations/__tests__/rateTable.test.ts">                |- rateTable.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- cplRate.ts](#/resolvers/mutations/cplRate.ts) anchor=true><a href="#/resolvers/mutations/cplRate.ts">            |- cplRate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- endorsementRate.ts](#/resolvers/mutations/endorsementRate.ts) anchor=true><a href="#/resolvers/mutations/endorsementRate.ts">            |- endorsementRate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/resolvers/mutations/index.ts) anchor=true><a href="#/resolvers/mutations/index.ts">            |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- policyRate.ts](#/resolvers/mutations/policyRate.ts) anchor=true><a href="#/resolvers/mutations/policyRate.ts">            |- policyRate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateManualMeta.ts](#/resolvers/mutations/rateManualMeta.ts) anchor=true><a href="#/resolvers/mutations/rateManualMeta.ts">            |- rateManualMeta.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateTable.ts](#/resolvers/mutations/rateTable.ts) anchor=true><a href="#/resolvers/mutations/rateTable.ts">            |- rateTable.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /queries anchor=true>          /queries</h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /__tests__ anchor=true>              /<strong>tests</strong></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- fees.test.ts](#/resolvers/queries/__tests__/fees.test.ts) anchor=true><a href="#/resolvers/queries/__tests__/fees.test.ts">                |- fees.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateManual.test.ts](#/resolvers/queries/__tests__/rateManual.test.ts) anchor=true><a href="#/resolvers/queries/__tests__/rateManual.test.ts">                |- rateManual.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rates.test.ts](#/resolvers/queries/__tests__/rates.test.ts) anchor=true><a href="#/resolvers/queries/__tests__/rates.test.ts">                |- rates.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- viewer.test.ts](#/resolvers/queries/__tests__/viewer.test.ts) anchor=true><a href="#/resolvers/queries/__tests__/viewer.test.ts">                |- viewer.test.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- fees.ts](#/resolvers/queries/fees.ts) anchor=true><a href="#/resolvers/queries/fees.ts">            |- fees.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/resolvers/queries/index.ts) anchor=true><a href="#/resolvers/queries/index.ts">            |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateManual.ts](#/resolvers/queries/rateManual.ts) anchor=true><a href="#/resolvers/queries/rateManual.ts">            |- rateManual.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rates.ts](#/resolvers/queries/rates.ts) anchor=true><a href="#/resolvers/queries/rates.ts">            |- rates.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- viewer.ts](#/resolvers/queries/viewer.ts) anchor=true><a href="#/resolvers/queries/viewer.ts">            |- viewer.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;|- server.ts](#/server.ts) anchor=true><a href="#/server.ts">    |- server.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;  /types anchor=true>      /types</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- cplRate.ts](#/types/cplRate.ts) anchor=true><a href="#/types/cplRate.ts">        |- cplRate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- endorsementRate.ts](#/types/endorsementRate.ts) anchor=true><a href="#/types/endorsementRate.ts">        |- endorsementRate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- fees.ts](#/types/fees.ts) anchor=true><a href="#/types/fees.ts">        |- fees.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/types/index.ts) anchor=true><a href="#/types/index.ts">        |- index.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /issued-document anchor=true>          /issued-document</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- addressee.ts](#/types/issued-document/addressee.ts) anchor=true><a href="#/types/issued-document/addressee.ts">            |- addressee.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/types/issued-document/index.ts) anchor=true><a href="#/types/issued-document/index.ts">            |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- policy.ts](#/types/issued-document/policy.ts) anchor=true><a href="#/types/issued-document/policy.ts">            |- policy.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- property-types.ts](#/types/issued-document/property-types.ts) anchor=true><a href="#/types/issued-document/property-types.ts">            |- property-types.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- shared-document-data.ts](#/types/issued-document/shared-document-data.ts) anchor=true><a href="#/types/issued-document/shared-document-data.ts">            |- shared-document-data.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- organizationType.ts](#/types/organizationType.ts) anchor=true><a href="#/types/organizationType.ts">        |- organizationType.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- policyRate.ts](#/types/policyRate.ts) anchor=true><a href="#/types/policyRate.ts">        |- policyRate.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateManual.ts](#/types/rateManual.ts) anchor=true><a href="#/types/rateManual.ts">        |- rateManual.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rateTable.ts](#/types/rateTable.ts) anchor=true><a href="#/types/rateTable.ts">        |- rateTable.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- rates.ts](#/types/rates.ts) anchor=true><a href="#/types/rates.ts">        |- rates.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  /scalars anchor=true>          /scalars</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/types/scalars/index.ts) anchor=true><a href="#/types/scalars/index.ts">            |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- money.ts](#/types/scalars/money.ts) anchor=true><a href="#/types/scalars/money.ts">            |- money.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- type-graphql-decorators.ts](#/types/type-graphql-decorators.ts) anchor=true><a href="#/types/type-graphql-decorators.ts">        |- type-graphql-decorators.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- viewer.ts](#/types/viewer.ts) anchor=true><a href="#/types/viewer.ts">        |- viewer.ts</a></h4>
<h4 id=&nbsp;&nbsp;&nbsp;&nbsp;  /utilities anchor=true>      /utilities</h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- index.ts](#/utilities/index.ts) anchor=true><a href="#/utilities/index.ts">        |- index.ts</a></h4>
<h4 id=[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- propertyTypes.ts](#/utilities/propertyTypes.ts) anchor=true><a href="#/utilities/propertyTypes.ts">        |- propertyTypes.ts</a></h4>
<h4 id=/generated/type-graphql/resolvers/outputs/RateTableCount.ts anchor=true>/generated/type-graphql/resolvers/outputs/RateTableCount.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;RateTableCount&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableCount</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  policyRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  simulPolicyRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  reissuePolicyRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  endorsementRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  endorsementShortRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  cplRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  additionalFeePolicyRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  excessPolicyRates!: <span class="hljs-built_in">number</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/RateTableCountAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/RateTableCountAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;RateTableCountAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableCountAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  id!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  name!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  rateManualId!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  createdAt!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  updatedAt!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  _all!: <span class="hljs-built_in">number</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/RateTableGroupBy.ts anchor=true>/generated/type-graphql/resolvers/outputs/RateTableGroupBy.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;
<span class="hljs-keyword">import</span> { RateTableCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/RateTableCountAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { RateTableMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/RateTableMaxAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { RateTableMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/RateTableMinAggregate&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;RateTableGroupBy&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableGroupBy</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  name!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  rateManualId!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> RateTableCountAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _count!: RateTableCountAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> RateTableMinAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _min!: RateTableMinAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> RateTableMaxAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _max!: RateTableMaxAggregate | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/RateTableMaxAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/RateTableMaxAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;RateTableMaxAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableMaxAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  id!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  name!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  rateManualId!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/RateTableMinAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/RateTableMinAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;RateTableMinAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableMinAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  id!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  name!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  rateManualId!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/TestCaseAvgAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/TestCaseAvgAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;TestCaseAvgAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCaseAvgAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  insuranceAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAge!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  crrOrders!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  underwriterSplit!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedUnderwriterPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedAgentPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedTrid!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedEndorsementRates!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/TestCaseCountAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/TestCaseCountAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;TestCaseCountAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCaseCountAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  id!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  policyType!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  rateType!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  propertyType!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  transactionType!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  insuranceAmount!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  endorsements!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  oldLoanAge!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  oldLoanAmount!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  crrOrders!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  priorPolicyType!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  priorRateType!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  county!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  underwriterSplit!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedUnderwriterPremium!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedAgentPremium!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedTrid!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedEndorsementRates!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  createdAt!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  updatedAt!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  rateManualId!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  _all!: <span class="hljs-built_in">number</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/TestCaseGroupBy.ts anchor=true>/generated/type-graphql/resolvers/outputs/TestCaseGroupBy.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;
<span class="hljs-keyword">import</span> { TestCaseAvgAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/TestCaseAvgAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { TestCaseCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/TestCaseCountAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { TestCaseMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/TestCaseMaxAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { TestCaseMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/TestCaseMinAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { TestCaseSumAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/TestCaseSumAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { PolicyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/PolicyType&quot;</span>;
<span class="hljs-keyword">import</span> { PropertyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/PropertyType&quot;</span>;
<span class="hljs-keyword">import</span> { TransactionType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/TransactionType&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;TestCaseGroupBy&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCaseGroupBy</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [PolicyType], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  policyType!: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-string">&quot;ALTA_LOAN&quot;</span> | <span class="hljs-string">&quot;ALTA_LOAN_SHORT&quot;</span> | <span class="hljs-string">&quot;ALTA_EXPANDED_LOAN&quot;</span> | <span class="hljs-string">&quot;ALTA_EXPANDED_LOAN_SHORT&quot;</span> | <span class="hljs-string">&quot;ALTA_JUNIOR_LOAN&quot;</span> | <span class="hljs-string">&quot;ALTA_JUNIOR_LOAN_SHORT&quot;</span> | <span class="hljs-string">&quot;ALTA_HOMEOWNER&quot;</span> | <span class="hljs-string">&quot;ALTA_OWNER&quot;</span> | <span class="hljs-string">&quot;CLTA_LOAN&quot;</span> | <span class="hljs-string">&quot;CLTA_EXPANDED_LOAN&quot;</span> | <span class="hljs-string">&quot;CLTA_OWNER&quot;</span> | <span class="hljs-string">&quot;CLTA_HOMEOWNER&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_CLTA_STANDARD&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_CLTA_EXTENDED&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_ALTA_STANDARD&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_ALTA_EXTENDED&quot;</span> | <span class="hljs-string">&quot;ALTA_OWNERS&quot;</span> | <span class="hljs-string">&quot;ALTA_LENDERS&quot;</span> | <span class="hljs-string">&quot;CLTA_OWNERS&quot;</span> | <span class="hljs-string">&quot;CLTA_LENDERS&quot;</span> | <span class="hljs-string">&quot;RESIDENTIAL_OWNER&quot;</span> | <span class="hljs-string">&quot;TLTA_HOMEOWNER&quot;</span> | <span class="hljs-string">&quot;TLTA_LOAN_BINDER&quot;</span> | <span class="hljs-string">&quot;TLTA_OWNER&quot;</span> | <span class="hljs-string">&quot;TLTA_LOAN&quot;</span> | <span class="hljs-string">&quot;OTHER_OWNER&quot;</span> | <span class="hljs-string">&quot;OTHER_LOAN&quot;</span> | <span class="hljs-string">&quot;TRUSTEE_SALE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LITIGATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;SUBDIVISION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;FORFEITURE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LOT_BOOK_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;CHAIN_OF_TITLE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;JUDGMENT_AND_TAX_LIEN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;JUDGEMENT_AND_TAX_LIEN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MORTGAGE_MODIFICATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;DATE_DOWN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MORTGAGE_PRIORITY_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LIMITED_LIABILITY_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;RECORDED_DOCUMENT_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MORTGAGE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;TITLE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;COMBINATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;FORECLOSURE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;CONDITION_OF_TITLE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MECHANICS_LIEN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PARCEL_MAP_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PARCEL_MAP_FINAL_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PRELIMINARY_PARCEL_MAP_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PLANT_INFORMATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;RECORD_OWNERS_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;RECORDERS_INDEX_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PROPERTY_OWNERS_NOTICE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PROPERTY_SEARCH_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LIMITED_TRUSTEE_SALE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PERSONAL_PROPERTY_ENCUMBRANCE_GUARANTEE&quot;</span>&gt; | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [<span class="hljs-built_in">String</span>], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  rateType!: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> PropertyType, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  propertyType!: <span class="hljs-string">&quot;RESIDENTIAL&quot;</span> | <span class="hljs-string">&quot;COMMERCIAL&quot;</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TransactionType, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  transactionType!: <span class="hljs-string">&quot;PURCHASE&quot;</span> | <span class="hljs-string">&quot;REFINANCE&quot;</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  insuranceAmount!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [<span class="hljs-built_in">String</span>], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  endorsements!: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAge!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  crrOrders!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [PolicyType], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  priorPolicyType!: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-string">&quot;ALTA_LOAN&quot;</span> | <span class="hljs-string">&quot;ALTA_LOAN_SHORT&quot;</span> | <span class="hljs-string">&quot;ALTA_EXPANDED_LOAN&quot;</span> | <span class="hljs-string">&quot;ALTA_EXPANDED_LOAN_SHORT&quot;</span> | <span class="hljs-string">&quot;ALTA_JUNIOR_LOAN&quot;</span> | <span class="hljs-string">&quot;ALTA_JUNIOR_LOAN_SHORT&quot;</span> | <span class="hljs-string">&quot;ALTA_HOMEOWNER&quot;</span> | <span class="hljs-string">&quot;ALTA_OWNER&quot;</span> | <span class="hljs-string">&quot;CLTA_LOAN&quot;</span> | <span class="hljs-string">&quot;CLTA_EXPANDED_LOAN&quot;</span> | <span class="hljs-string">&quot;CLTA_OWNER&quot;</span> | <span class="hljs-string">&quot;CLTA_HOMEOWNER&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_CLTA_STANDARD&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_CLTA_EXTENDED&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_ALTA_STANDARD&quot;</span> | <span class="hljs-string">&quot;CLTA_INTERIM_BINDER_ALTA_EXTENDED&quot;</span> | <span class="hljs-string">&quot;ALTA_OWNERS&quot;</span> | <span class="hljs-string">&quot;ALTA_LENDERS&quot;</span> | <span class="hljs-string">&quot;CLTA_OWNERS&quot;</span> | <span class="hljs-string">&quot;CLTA_LENDERS&quot;</span> | <span class="hljs-string">&quot;RESIDENTIAL_OWNER&quot;</span> | <span class="hljs-string">&quot;TLTA_HOMEOWNER&quot;</span> | <span class="hljs-string">&quot;TLTA_LOAN_BINDER&quot;</span> | <span class="hljs-string">&quot;TLTA_OWNER&quot;</span> | <span class="hljs-string">&quot;TLTA_LOAN&quot;</span> | <span class="hljs-string">&quot;OTHER_OWNER&quot;</span> | <span class="hljs-string">&quot;OTHER_LOAN&quot;</span> | <span class="hljs-string">&quot;TRUSTEE_SALE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LITIGATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;SUBDIVISION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;FORFEITURE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LOT_BOOK_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;CHAIN_OF_TITLE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;JUDGMENT_AND_TAX_LIEN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;JUDGEMENT_AND_TAX_LIEN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MORTGAGE_MODIFICATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;DATE_DOWN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MORTGAGE_PRIORITY_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LIMITED_LIABILITY_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;RECORDED_DOCUMENT_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MORTGAGE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;TITLE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;COMBINATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;FORECLOSURE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;CONDITION_OF_TITLE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;MECHANICS_LIEN_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PARCEL_MAP_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PARCEL_MAP_FINAL_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PRELIMINARY_PARCEL_MAP_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PLANT_INFORMATION_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;RECORD_OWNERS_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;RECORDERS_INDEX_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PROPERTY_OWNERS_NOTICE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PROPERTY_SEARCH_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;LIMITED_TRUSTEE_SALE_GUARANTEE&quot;</span> | <span class="hljs-string">&quot;PERSONAL_PROPERTY_ENCUMBRANCE_GUARANTEE&quot;</span>&gt; | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [<span class="hljs-built_in">String</span>], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  priorRateType!: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [<span class="hljs-built_in">String</span>], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  county!: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  underwriterSplit!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedUnderwriterPremium!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedAgentPremium!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  expectedTrid!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [TypeGraphQL.Float], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedEndorsementRates!: <span class="hljs-built_in">number</span>[] | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  rateManualId!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TestCaseCountAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _count!: TestCaseCountAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TestCaseAvgAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _avg!: TestCaseAvgAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TestCaseSumAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _sum!: TestCaseSumAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TestCaseMinAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _min!: TestCaseMinAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TestCaseMaxAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _max!: TestCaseMaxAggregate | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/TestCaseMaxAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/TestCaseMaxAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;
<span class="hljs-keyword">import</span> { PropertyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/PropertyType&quot;</span>;
<span class="hljs-keyword">import</span> { TransactionType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/TransactionType&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;TestCaseMaxAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCaseMaxAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  id!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> PropertyType, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  propertyType!: <span class="hljs-string">&quot;RESIDENTIAL&quot;</span> | <span class="hljs-string">&quot;COMMERCIAL&quot;</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TransactionType, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  transactionType!: <span class="hljs-string">&quot;PURCHASE&quot;</span> | <span class="hljs-string">&quot;REFINANCE&quot;</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  insuranceAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAge!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  crrOrders!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  underwriterSplit!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedUnderwriterPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedAgentPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedTrid!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  rateManualId!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/TestCaseMinAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/TestCaseMinAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;
<span class="hljs-keyword">import</span> { PropertyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/PropertyType&quot;</span>;
<span class="hljs-keyword">import</span> { TransactionType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../enums/TransactionType&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;TestCaseMinAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCaseMinAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  id!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> PropertyType, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  propertyType!: <span class="hljs-string">&quot;RESIDENTIAL&quot;</span> | <span class="hljs-string">&quot;COMMERCIAL&quot;</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TransactionType, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  transactionType!: <span class="hljs-string">&quot;PURCHASE&quot;</span> | <span class="hljs-string">&quot;REFINANCE&quot;</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  insuranceAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAge!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  crrOrders!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  underwriterSplit!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedUnderwriterPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedAgentPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedTrid!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  rateManualId!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/TestCaseSumAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/TestCaseSumAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;TestCaseSumAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCaseSumAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  insuranceAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAge!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  oldLoanAmount!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  crrOrders!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  underwriterSplit!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedUnderwriterPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedAgentPremium!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Float, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedTrid!: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> [TypeGraphQL.Float], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  expectedEndorsementRates!: <span class="hljs-built_in">number</span>[] | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/UnderwriterCount.ts anchor=true>/generated/type-graphql/resolvers/outputs/UnderwriterCount.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;UnderwriterCount&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnderwriterCount</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  rateManuals!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  withAccess!: <span class="hljs-built_in">number</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/UnderwriterCountAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/UnderwriterCountAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;UnderwriterCountAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnderwriterCountAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  id!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  name!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  config!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  createdAt!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  updatedAt!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> TypeGraphQL.Int, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  _all!: <span class="hljs-built_in">number</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/UnderwriterGroupBy.ts anchor=true>/generated/type-graphql/resolvers/outputs/UnderwriterGroupBy.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;
<span class="hljs-keyword">import</span> { UnderwriterCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/UnderwriterCountAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { UnderwriterMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/UnderwriterMaxAggregate&quot;</span>;
<span class="hljs-keyword">import</span> { UnderwriterMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../outputs/UnderwriterMinAggregate&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;UnderwriterGroupBy&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnderwriterGroupBy</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  name!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> GraphQLScalars.JSONResolver, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  config!: Prisma.JsonValue;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> UnderwriterCountAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _count!: UnderwriterCountAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> UnderwriterMinAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _min!: UnderwriterMinAggregate | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> UnderwriterMaxAggregate, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  _max!: UnderwriterMaxAggregate | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/UnderwriterMaxAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/UnderwriterMaxAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;UnderwriterMaxAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnderwriterMaxAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  id!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  name!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/UnderwriterMinAggregate.ts anchor=true>/generated/type-graphql/resolvers/outputs/UnderwriterMinAggregate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> TypeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;type-graphql&quot;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> GraphQLScalars <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql-scalars&quot;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { DecimalJSScalar } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../scalars&quot;</span>;

<span class="hljs-meta">@TypeGraphQL</span>.ObjectType(<span class="hljs-string">&quot;UnderwriterMinAggregate&quot;</span>, {
  <span class="hljs-attr">isAbstract</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UnderwriterMinAggregate</span> </span>{
  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  id!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  name!: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  createdAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@TypeGraphQL</span>.Field(<span class="hljs-function"><span class="hljs-params">_type</span> =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>
  })
  updatedAt!: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;
}

</code></pre>
<h4 id=/generated/type-graphql/resolvers/outputs/index.ts anchor=true>/generated/type-graphql/resolvers/outputs/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> { AffectedRowsOutput } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AffectedRowsOutput&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateCplRate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateCplRate&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateEndorsementRate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateEndorsementRate&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateEndorsementShortRate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateEndorsementShortRate&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateOrganization } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateOrganization&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateOrganizationAccess } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateOrganizationAccess&quot;</span>;
<span class="hljs-keyword">export</span> { AggregatePolicyRate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregatePolicyRate&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateRateManual } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateRateManual&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateRateTable } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateRateTable&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateTestCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateTestCase&quot;</span>;
<span class="hljs-keyword">export</span> { AggregateUnderwriter } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./AggregateUnderwriter&quot;</span>;
<span class="hljs-keyword">export</span> { CplRateAvgAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./CplRateAvgAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { CplRateCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./CplRateCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { CplRateGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./CplRateGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { CplRateMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./CplRateMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { CplRateMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./CplRateMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { CplRateSumAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./CplRateSumAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementRateAvgAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementRateAvgAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementRateCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementRateCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementRateGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementRateGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementRateMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementRateMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementRateMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementRateMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementRateSumAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementRateSumAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementShortRateAvgAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementShortRateAvgAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementShortRateCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementShortRateCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementShortRateGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementShortRateGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementShortRateMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementShortRateMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementShortRateMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementShortRateMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { EndorsementShortRateSumAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./EndorsementShortRateSumAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationAccessCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationAccessCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationAccessGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationAccessGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationAccessMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationAccessMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationAccessMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationAccessMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationCount } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationCount&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { OrganizationMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./OrganizationMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { PolicyRateAvgAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./PolicyRateAvgAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { PolicyRateCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./PolicyRateCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { PolicyRateGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./PolicyRateGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { PolicyRateMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./PolicyRateMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { PolicyRateMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./PolicyRateMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { PolicyRateSumAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./PolicyRateSumAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { RateManualCount } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateManualCount&quot;</span>;
<span class="hljs-keyword">export</span> { RateManualCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateManualCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { RateManualGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateManualGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { RateManualMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateManualMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { RateManualMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateManualMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { RateTableCount } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateTableCount&quot;</span>;
<span class="hljs-keyword">export</span> { RateTableCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateTableCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { RateTableGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateTableGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { RateTableMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateTableMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { RateTableMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./RateTableMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { TestCaseAvgAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./TestCaseAvgAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { TestCaseCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./TestCaseCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { TestCaseGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./TestCaseGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { TestCaseMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./TestCaseMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { TestCaseMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./TestCaseMinAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { TestCaseSumAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./TestCaseSumAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { UnderwriterCount } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./UnderwriterCount&quot;</span>;
<span class="hljs-keyword">export</span> { UnderwriterCountAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./UnderwriterCountAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { UnderwriterGroupBy } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./UnderwriterGroupBy&quot;</span>;
<span class="hljs-keyword">export</span> { UnderwriterMaxAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./UnderwriterMaxAggregate&quot;</span>;
<span class="hljs-keyword">export</span> { UnderwriterMinAggregate } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./UnderwriterMinAggregate&quot;</span>;

</code></pre>
<h4 id=/generated/type-graphql/scalars.ts anchor=true>/generated/type-graphql/scalars.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@prisma/client&quot;</span>;
<span class="hljs-keyword">import</span> { GraphQLScalarType } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;graphql&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> DecimalJSScalar = <span class="hljs-keyword">new</span> GraphQLScalarType({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Decimal&quot;</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;GraphQL Scalar representing the Prisma.Decimal type, based on Decimal.js library.&quot;</span>,
  <span class="hljs-attr">serialize</span>: <span class="hljs-function">(<span class="hljs-params">value: unknown</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!(Prisma.Decimal.isDecimal(value))) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`[DecimalError] Invalid argument: <span class="hljs-subst">${<span class="hljs-built_in">Object</span>.prototype.toString.call(value)}</span>. Expected Prisma.Decimal.`</span>);
    }
    <span class="hljs-keyword">return</span> (value <span class="hljs-keyword">as</span> Prisma.Decimal).toString();
  },
  <span class="hljs-attr">parseValue</span>: <span class="hljs-function">(<span class="hljs-params">value: unknown</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">&quot;string&quot;</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`[DecimalError] Invalid argument: <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> value}</span>. Expected string.`</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Prisma.Decimal(value);
  },
});


</code></pre>
<h4 id=/helpers.ts anchor=true>/helpers.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { ValidationError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server&#x27;</span>;
<span class="hljs-keyword">import</span> { validate <span class="hljs-keyword">as</span> validateUuid } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;uuid&#x27;</span>;

<span class="hljs-comment">// taken from https://stackoverflow.com/a/9204568/12132909 (The regex that prevents matching multiple &#x27;@&#x27;s)</span>
<span class="hljs-comment">// I modified it to reject non-alphanumerics after the final &#x27;.&#x27;. This is necessary to prevent scnearios where multiple emails</span>
<span class="hljs-comment">// may be chaned together, like we sometimes see on encompass loans, e.g. &#x27;test@qualia.com;test@qualia.com&#x27;</span>
<span class="hljs-keyword">const</span> EMAIL_ADDRESS_REGEX = <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[a-zA-Z0-9_]+$/</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> validateUuidOrThrow = <span class="hljs-function">(<span class="hljs-params">uuid: <span class="hljs-built_in">string</span>, field: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!validateUuid(uuid)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationError(<span class="hljs-string">`<span class="hljs-subst">${field}</span> is not a valid uuid`</span>);
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> validateEmailAddresses = <span class="hljs-function">(<span class="hljs-params">email: <span class="hljs-built_in">string</span>, field: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!EMAIL_ADDRESS_REGEX.test(email)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationError(<span class="hljs-string">`<span class="hljs-subst">${field}</span> is not a valid email address`</span>);
  }
};

</code></pre>
<h4 id=/inputs/index.ts anchor=true>/inputs/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript">
</code></pre>
<h4 id=/interfaces/index.ts anchor=true>/interfaces/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> { OrganizationUser } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./organizationUser&#x27;</span>;

</code></pre>
<h4 id=/interfaces/organizationUser.ts anchor=true>/interfaces/organizationUser.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { OrganizationAccess } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> OrganizationUser {
  <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">string</span>;
  access: OrganizationAccess[];
  isAuthenticated: <span class="hljs-built_in">boolean</span>;
}

</code></pre>
<h4 id=/plugins/errors.ts anchor=true>/plugins/errors.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
  ApolloServerPlugin,
  BaseContext,
  GraphQLRequestListener,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-plugin-base&#x27;</span>;
<span class="hljs-keyword">import</span> { LegacyUndertakerError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../errors&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ErrorFormattingPlugin = (): ApolloServerPlugin&lt;BaseContext&gt; =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-keyword">async</span> requestDidStart(): <span class="hljs-built_in">Promise</span>&lt;GraphQLRequestListener&gt; {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">willSendResponse</span>(<span class="hljs-params">ctx</span>)</span> {
          <span class="hljs-keyword">const</span> fromQualia = !!ctx.request.http?.headers.get(
            <span class="hljs-string">&#x27;x-distributed-transaction-id&#x27;</span>
          );
          <span class="hljs-keyword">if</span> (
            ctx?.response?.errors &amp;&amp;
            ctx?.response?.errors.length &gt; <span class="hljs-number">0</span> &amp;&amp;
            fromQualia
          ) {
            <span class="hljs-comment">// eslint-disable-next-line no-param-reassign</span>
            ctx.response.data = <span class="hljs-keyword">new</span> LegacyUndertakerError(
              ctx.response.errors[<span class="hljs-number">0</span>]
            ).body();
            <span class="hljs-comment">// eslint-disable-next-line no-param-reassign</span>
            <span class="hljs-keyword">delete</span> ctx.response.errors;
          }
        },
      };
    },
  };
};

</code></pre>
<h4 id=/plugins/examples.ts anchor=true>/plugins/examples.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../db&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> exampleTabs = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> exampleRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
    <span class="hljs-attr">where</span>: {
      <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span> },
      <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;AZ&#x27;</span>,
    },
    <span class="hljs-attr">include</span>: {
      <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">endorsementShortRates</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
    },
  });
  <span class="hljs-keyword">const</span> exampleRateManualWithCPL = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
    <span class="hljs-attr">where</span>: {
      <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
      <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
    },
    <span class="hljs-attr">include</span>: {
      <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
    },
  });
  <span class="hljs-keyword">const</span> readHeaders = {
    <span class="hljs-attr">authorization</span>: <span class="hljs-string">`basic <span class="hljs-subst">${process.env.TITLE_RATES_API_QUALIA_READ_API_KEY}</span>`</span>,
    <span class="hljs-string">&#x27;x-distributed-transaction-id&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>,
  };
  <span class="hljs-keyword">const</span> adminHeaders = {
    <span class="hljs-attr">authorization</span>: <span class="hljs-string">`basic <span class="hljs-subst">${process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY}</span>`</span>,
    <span class="hljs-string">&#x27;x-distributed-transaction-id&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>,
  };
  <span class="hljs-keyword">return</span> process.env.TITLE_RATES_API_PLAYGROUND_ENABLED === <span class="hljs-string">&#x27;true&#x27;</span>
    ? [
        <span class="hljs-comment">// ================== CALCULATE RATES ==================</span>
        {
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Calculate Rates&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`query Rates($input: RatesInput!) {
  rates(input: $input) {
    policies {
      id
      underwriterPremium
      agentPremium
      disclosedTotalPremium
      endorsements {
        totalPremium
      }
    }
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;agentID&quot;: &quot;&quot;,
    &quot;underwriter&quot;: &quot;wfg&quot;,
    &quot;policies&quot;: [
      {
        &quot;id&quot;: &quot;&quot;,
        &quot;policyCategory&quot;: &quot;OWNER&quot;,
        &quot;policyFormName&quot;: &quot;alta_owner&quot;,
        &quot;rateType&quot;: &quot;basic&quot;,
        &quot;coverageAmount&quot;: 3340000,
        &quot;endorsements&quot;: [
          {
            &quot;id&quot;: &quot;ALTA 15&quot;
          }
        ],
        &quot;rateEffectiveDate&quot;: &quot;2023-01-27&quot;
      }
    ],
    &quot;purpose&quot;: &quot;PURCHASE&quot;,
    &quot;property&quot;: {
      &quot;address&quot;: {
        &quot;state&quot;: &quot;ME&quot;,
        &quot;counties&quot;: []
      }
    }
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ================== CALCULATE RATES TWO P ==================</span>
        {
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Calculate Rates 2P&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`query Rates($input: RatesInput!) {
  rates(input: $input) {
    policies {
      id
      underwriterPremium
      agentPremium
      disclosedTotalPremium
      endorsements {
        totalPremium
      }
    }
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;agentID&quot;: &quot;&quot;,
    &quot;underwriter&quot;: &quot;first_american&quot;,
    &quot;policies&quot;: [
      {
        &quot;id&quot;: &quot;&quot;,
        &quot;policyCategory&quot;: &quot;OWNER&quot;,
        &quot;policyFormName&quot;: &quot;alta_owner&quot;,
        &quot;rateType&quot;: &quot;extended basic&quot;,
        &quot;coverageAmount&quot;: 45000000,
        &quot;endorsements&quot;: [],
        &quot;rateEffectiveDate&quot;: &quot;2023-01-27&quot;
      },
      {
        &quot;id&quot;: &quot;&quot;,
        &quot;policyCategory&quot;: &quot;LENDER&quot;,
        &quot;policyFormName&quot;: &quot;alta_loan&quot;,
        &quot;rateType&quot;: &quot;bundled lenders purchase loan&quot;,
        &quot;coverageAmount&quot;: 44184900,
        &quot;endorsements&quot;: [],
        &quot;rateEffectiveDate&quot;: &quot;2023-01-27&quot;
      }
    ],
    &quot;policySplit&quot;: &quot;89&quot;,
    &quot;purpose&quot;: &quot;PURCHASE&quot;,
    &quot;property&quot;: {
      &quot;address&quot;: {
        &quot;state&quot;: &quot;CO&quot;,
        &quot;counties&quot;: [&quot;Douglas&quot;]
      }
    }
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ====================== GET RATE TYPES ======================</span>
        {
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Get Rate Types&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`query RateTypes($input: RateTypesInput!) {
  rateTypes(input: $input) {
    policyFormName,
    rateTypes {
      label,
      id
    }
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;agentID&quot;: &quot;&quot;,
    &quot;underwriter&quot;: &quot;wfg&quot;,
    &quot;policyFormNames&quot;: [&quot;ALTA_OWNER&quot;],
    &quot;property&quot;: {
      &quot;address&quot;: {
        &quot;state&quot;: &quot;ME&quot;,
        &quot;counties&quot;: []
      }
    },
    &quot;rateEffectiveDate&quot;: &quot;2023-01-27&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ====================== GET RATE MANUALS ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Get Rate Manuals&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`query RateManualsAll {
  rateManuals {
    id
    state
    effectiveDate
    status
  }
}
query RateManualsFiltered {
  rateManuals(state: &quot;AK&quot;, underwriter: &quot;amtrust&quot;) {
    id
    state
    effectiveDate
    status
  }
}
query RateManualStates {
  rateManualStates(underwriter: &quot;amtrust&quot;, take: 10, skip: 0) {
    id
    state
    effectiveDate
    status
    updatedAt
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ================== GET RATE MANUAL (SUMMARY) ==================</span>
        {
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Get Rate Manual&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`query fullRateManual {
  rateManual(id: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;) {
    id
    state
    effectiveDate
    status
    policyRates {
      id
      policyType
      rateType
      policyCategory
      transactionType
      propertyType
      crrOrdersRange
      priorPolicyType
      priorRateType
      otherPolicyType
      otherRateType
      county
      rateTableDiscount
      rateTypeDiscount
      policyDiscount
      excessDiscount
      policyAmountMin
      additionalFeeAmount
      additionalFeeDiscount
      simultaneousPremium
      simultaneousPremiumTableDiscount
      simultaneousBasePremiumDiscount
      insuranceAmountRange
      premiumRounding
      discountRounding
      minPremium
      oldLoanAgeRange
      reissueMinPremium
      reissueDiscount
      useLenderActualAsDisclosed
      aggressiveRounding
      name
      description
      updatedAt
      createdAt
    }
    endorsementRates {
      id
      endorsementId
      rateType
      propertyType
      ownerFlatRate
      ownerDiscount
      ownerMinimumFee
      ownerMaximumFee
      lenderFlatRate
      lenderDiscount
      lenderMinimumFee
      lenderMaximumFee
      cltaOwnerFlatFee
      cltaOwnerDiscount
      cltaLenderFlatFee
      cltaLenderDiscount
      policyPremiumDiscount
      insuranceAmountDiscount
      lenderSimultaneous
      ownerSimultaneous
      county
      updatedAt
      createdAt
    }
    endorsementShortRates {
      id
      endorsementId
      rateType
      propertyType
      county
      rateSource
      flatRate
      policyPremiumDiscount
      rateTablePremiumDiscount
      insuranceAmountDiscount
      minimumFee
      maximumFee
      simultaneousFlatRate
      updatedAt
      createdAt
    }
    rateTables {
      id
      name
      tiers {
        lowerBound
        upperBound
        flatRate
        ratePerAmount
        perAmount
        tierType
        baseTableDiscount
        createdAt
      }
      updatedAt
      createdAt
    }
    cplRates {
      id
      protectedParty
      flatRate
      rateTableId
      updatedAt
      createdAt
    }
  }
}
query rateManualSummary {
  rateManual(id: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;) {
    id
    state
    effectiveDate
    status
    policyRatesCount
    endorsementRatesCount
    endorsementShortRatesCount
    rateTablesCount
    policyRates(skip: 0, take: 10, orderBy: { createdAt: &quot;desc&quot; }) {
      id
      rateType
      policyType
      transactionType
      createdAt
    }
    endorsementRates(skip: 0, take: 10, orderBy: { endorsementId: &quot;asc&quot; }) {
      id
      endorsementId
      propertyType
    }
    endorsementShortRates(skip: 0, take: 10, orderBy: { endorsementId: &quot;asc&quot; }) {
      id
      endorsementId
      rateType
      propertyType
      policyType
      county
      updatedAt
      createdAt
    }
    rateTables(skip: 0, take: 10, orderBy: { name: &quot;asc&quot; }) {
      id
      name
    }
    cplRates(skip: 0, take: 10, orderBy: { protectedParty: &quot;asc&quot; }) {
      id
      protectedParty
    }
  }
}
query cplRates {
  rateManual(id: &quot;<span class="hljs-subst">${exampleRateManualWithCPL?.id}</span>&quot;) {
    id
    state
    effectiveDate
    status
    cplRates {
      id
      protectedParty
      flatRate
      rateTableId
    }
  }
}
`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// =================== UPDATE RATE MANUAL META ====================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Update Rate Manual Meta&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation UpdateRateManualMeta ($input: UpdateRateManualMetaInput!) {
  updateRateManualMeta(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;id&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;,
    &quot;underwriter&quot;: &quot;amtrust&quot;,
    &quot;effectiveDate&quot;: &quot;2023-01-27&quot;,
    &quot;status&quot;: &quot;PROD&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== CREATE RATE MANUAL ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Create Rate Manual&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation CreateRateManual ($input: CreateRateManualInput!) {
  createRateManual(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;state&quot;: &quot;AK&quot;,
    &quot;effectiveDate&quot;: &quot;2023-01-27&quot;,
    &quot;underwriter&quot;: &quot;amtrust&quot;,
    &quot;status&quot;: &quot;DRAFT&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== REMOVE RATE MANUAL ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Remove Rate Manual&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation RemoveRateManual {
  removeRateManual(id: &quot;&quot;) {
    status
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== UPDATE POLICY RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Update Policy Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingUpdate ($input: UpdatePolicyRateInput!) {
  updatePolicyRate(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;rateType&quot;: [&quot;refinance&quot;],
    &quot;rateManualId&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;,
    &quot;id&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.policyRates[<span class="hljs-number">0</span>]?.id}</span>&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== CREATE POLICY RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Create Policy Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingCreate ($input: CreatePolicyRateInput!) {
  createPolicyRate(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;rateType&quot;: [&quot;refinance&quot;],
    &quot;rateManualId&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;,
    &quot;policyType&quot;: [&quot;ALTA_LOAN&quot;],
    &quot;policyCategory&quot;: &quot;LENDER&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== REMOVE POLICY RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Remove Policy Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation RemovePolicyRate {
  removePolicyRate(id: &quot;&quot;) {
    status
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== UPDATE ENDORSEMENT RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Update Endorsement Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingUpdate ($input: UpdateEndorsementRateInput!) {
  updateEndorsementRate(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;id&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.endorsementRates[<span class="hljs-number">0</span>]?.id}</span>&quot;,
    &quot;ownerFlatRate&quot;: 40,
    &quot;lenderFlatRate&quot;: 50
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Update Endorsement Short Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingUpdate ($input: UpdateEndorsementShortRateInput!) {
  updateEndorsementShortRate(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;id&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.endorsementShortRates[<span class="hljs-number">0</span>]?.id}</span>&quot;,
    &quot;flatRate&quot;: 40,
    &quot;rateSource&quot;: &quot;FLAT_RATE&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== CREATE ENDORSEMENT RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Create Endorsement Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingCreate ($input: CreateEndorsementRateInput!) {
  createEndorsementRate(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;rateManualId&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;,
    &quot;endorsementId&quot;: &quot;ALTA 1000&quot;,
    &quot;ownerFlatRate&quot;: 40,
    &quot;lenderFlatRate&quot;: 50
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Create Endorsement Short Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingCreate ($input: CreateEndorsementShortRateInput!) {
  createEndorsementShortRate(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;rateManualId&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;,
    &quot;endorsementId&quot;: &quot;ALTA 1000&quot;,
    &quot;flatRate&quot;: 40,
    &quot;rateSource&quot;: &quot;FLAT_RATE&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== REMOVE ENDORSEMENT RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Remove Endorsement Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation RemoveEndorsementRate {
  removeEndorsementRate(id: &quot;&quot;) {
    status
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Remove Endorsement Short Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation RemoveEndorsementShortRate {
  removeEndorsementShortRate(id: &quot;&quot;) {
    status
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ====================== UPDATE RATE TABLE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Update Rate Table&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingUpdate ($input: UpdateRateTableInput!) {
  updateRateTable(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;id&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.rateTables[<span class="hljs-number">0</span>]?.id}</span>&quot;,
    &quot;name&quot;: &quot;BASIC_TEST&quot;,
    &quot;tiers&quot;: [
      {
        &quot;lowerBound&quot;: 0,
        &quot;upperBound&quot;: 100000,
        &quot;tierType&quot;: &quot;FIXED&quot;,
        &quot;flatRate&quot;: 100
      },
      {
        &quot;lowerBound&quot;: 100000,
        &quot;upperBound&quot;: -1,
        &quot;tierType&quot;: &quot;FIXED&quot;,
        &quot;flatRate&quot;: 200
      }
    ]
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ====================== CREATE RATE TABLE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Create Rate Table&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation testingCreate ($input: CreateRateTableInput!) {
  createRateTable(input: $input) {
    status
  }
}`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;rateManualId&quot;: &quot;<span class="hljs-subst">${exampleRateManual?.id}</span>&quot;,
    &quot;name&quot;: &quot;BASIC_TEST_NEW&quot;,
    &quot;tiers&quot;: [
      {
        &quot;lowerBound&quot;: 0,
        &quot;upperBound&quot;: 100000,
        &quot;tierType&quot;: &quot;FIXED&quot;,
        &quot;flatRate&quot;: 100
      },
      {
        &quot;lowerBound&quot;: 100000,
        &quot;upperBound&quot;: -1,
        &quot;tierType&quot;: &quot;FIXED&quot;,
        &quot;flatRate&quot;: 200
      }
    ]
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ====================== REMOVE RATE TABLE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Remove Rate Table&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation RemoveRateTable {
  removeRateTable(id: &quot;&quot;) {
    status
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
        <span class="hljs-comment">// ======================== UPDATE CPL RATE ========================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Update CPL Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation UpdateCPLRate ($input: UpdateCPLRateInput!) {
    updateCPLRate(input: $input) {
      status
    }
  }`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;id&quot;: &quot;<span class="hljs-subst">${exampleRateManualWithCPL?.cplRates[<span class="hljs-number">0</span>]?.id}</span>&quot;,
    &quot;protectedParty&quot;: &quot;<span class="hljs-subst">${exampleRateManualWithCPL?.cplRates[<span class="hljs-number">0</span>]?.protectedParty}</span>&quot;,
    &quot;flatRate&quot;: 0
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ====================== CREATE CPL RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Create CPL Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation CreateCPLRate ($input: CreateCPLRateInput!) {
    createCPLRate(input: $input) {
      status
    }
  }`</span>,
          <span class="hljs-attr">variables</span>: <span class="hljs-string">`{
  &quot;input&quot;: {
    &quot;protectedParty&quot;: &quot;BUYER&quot;,
    &quot;flatRate&quot;: 0,
    &quot;rateManualId&quot;: &quot;<span class="hljs-subst">${exampleRateManualWithCPL?.id}</span>&quot;
  }
}`</span>,
          <span class="hljs-attr">headers</span>: readHeaders,
        },
        <span class="hljs-comment">// ====================== REMOVE CPL RATE ======================</span>
        {
          <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Remove CPL Rate&#x27;</span>,
          <span class="hljs-attr">endpoint</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">query</span>: <span class="hljs-string">`mutation RemoveCPLRate {
  removeCPLRate(id: &quot;&quot;) {
    status
  }
}`</span>,
          <span class="hljs-attr">headers</span>: adminHeaders,
        },
      ]
    : [];
};

</code></pre>
<h4 id=/plugins/index.ts anchor=true>/plugins/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> { LoggingPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./loggingPlugin&#x27;</span>;
<span class="hljs-keyword">export</span> { PrometheusTimingPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./metrics&#x27;</span>;
<span class="hljs-keyword">export</span> { ErrorFormattingPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./errors&#x27;</span>;

</code></pre>
<h4 id=/plugins/loggingPlugin.ts anchor=true>/plugins/loggingPlugin.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
  ApolloServerPlugin,
  BaseContext,
  GraphQLRequestListener,
  GraphQLRequestContext,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-plugin-base&#x27;</span>;
<span class="hljs-keyword">import</span> { getEnvironment } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../environment&#x27;</span>;
<span class="hljs-keyword">import</span> { logger } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../logger&#x27;</span>;

<span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>
<span class="hljs-keyword">const</span> redactPasswords = (obj: <span class="hljs-built_in">any</span>): <span class="hljs-function"><span class="hljs-params">any</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; obj !== <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>
    <span class="hljs-keyword">const</span> newObj: <span class="hljs-built_in">any</span> = {};

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> obj) {
      <span class="hljs-comment">// eslint-disable-next-line no-prototype-builtins</span>
      <span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)) {
        <span class="hljs-keyword">if</span> (key === <span class="hljs-string">&#x27;password&#x27;</span>) {
          newObj[key] = <span class="hljs-string">&#x27;REDACTED&#x27;</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj[key] === <span class="hljs-string">&#x27;object&#x27;</span>) {
          newObj[key] = redactPasswords(obj[key]);
        } <span class="hljs-keyword">else</span> {
          newObj[key] = obj[key];
        }
      }
    }

    <span class="hljs-keyword">return</span> newObj;
  }

  <span class="hljs-keyword">return</span> obj;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> LoggingPlugin: ApolloServerPlugin&lt;BaseContext&gt; = {
  <span class="hljs-keyword">async</span> requestDidStart(
    ctx: GraphQLRequestContext
  ): <span class="hljs-built_in">Promise</span>&lt;GraphQLRequestListener&gt; {
    <span class="hljs-keyword">const</span> startTime = performance.now();

    logger.info(<span class="hljs-string">&#x27;GQL Call Started&#x27;</span>, {
      <span class="hljs-attr">sourceId</span>: <span class="hljs-string">&#x27;title-rates-api::gql::global::requestDidStart&#x27;</span>,
      <span class="hljs-attr">distributedTransactionId</span>: ctx.context.distributedTransactionId,
      <span class="hljs-attr">deployment</span>: ctx.context.deployment,
      <span class="hljs-attr">additionalInfo</span>: {
        <span class="hljs-attr">operationName</span>: ctx.operationName,
        ...(getEnvironment().logging.verboseGQL
          ? [
              {
                <span class="hljs-attr">query</span>: ctx.request.query,
                <span class="hljs-attr">variables</span>: redactPasswords(ctx.request.variables),
              },
            ]
          : []),
      },
    });

    <span class="hljs-keyword">return</span> {
      <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">didEncounterErrors</span>(<span class="hljs-params">{ errors }</span>)</span> {
        errors.forEach(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span>
          logger.error(<span class="hljs-string">&#x27;GQL Call Error&#x27;</span>, {
            <span class="hljs-attr">sourceId</span>:
              <span class="hljs-string">&#x27;title-rates-api::gql::global::didEncounterErrors::&#x27;</span> +
              error.originalError?.constructor?.name,
            <span class="hljs-attr">distributedTransactionId</span>: ctx.context.distributedTransactionId,
            <span class="hljs-attr">deployment</span>: ctx.context.deployment,
            error,
          })
        );
      },
      <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">willSendResponse</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-keyword">const</span> durationMS = <span class="hljs-built_in">Math</span>.round(performance.now() - startTime);

        logger.info(<span class="hljs-string">&#x27;GQL Call Executed&#x27;</span>, {
          <span class="hljs-attr">sourceId</span>: <span class="hljs-string">&#x27;title-rates-api::gql::global::willSendResponse&#x27;</span>,
          <span class="hljs-attr">additionalInfo</span>: {
            <span class="hljs-attr">operationName</span>: ctx.operationName,
            <span class="hljs-attr">distributedTransactionId</span>: ctx.context.distributedTransactionId,
            <span class="hljs-attr">deployment</span>: ctx.context.deployment,
            <span class="hljs-attr">timing</span>: {
              durationMS,
            },
            ...(getEnvironment().logging.verboseGQL
              ? [
                  {
                    <span class="hljs-attr">data</span>: ctx.response?.data,
                  },
                ]
              : []),
          },
        });

        <span class="hljs-keyword">if</span> (
          durationMS &gt;= getEnvironment().logging.resolverDurationThresholdMS
        ) {
          logger.info(<span class="hljs-string">&#x27;GQL Call duration exceeded threshold&#x27;</span>, {
            <span class="hljs-attr">sourceId</span>: <span class="hljs-string">&#x27;title-rates-api::gql::global::willSendResponse::timing&#x27;</span>,
            <span class="hljs-attr">additionalInfo</span>: {
              <span class="hljs-attr">operationName</span>: ctx.operationName,
              <span class="hljs-attr">timing</span>: {
                durationMS,
              },
            },
          });
        }
      },
    } <span class="hljs-keyword">as</span> GraphQLRequestListener;
  },
};

</code></pre>
<h4 id=/plugins/metrics.ts anchor=true>/plugins/metrics.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
  ApolloServerPlugin,
  BaseContext,
  GraphQLRequestContext,
  GraphQLRequestListener,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-plugin-base&#x27;</span>;
<span class="hljs-keyword">import</span> { Counter, Histogram, Registry } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prom-client&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> PrometheusTimingPlugin = (
  registry: Registry
): ApolloServerPlugin&lt;BaseContext&gt; =&gt; {
  <span class="hljs-keyword">const</span> queryParseStarted = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_parse_started&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query parse started&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> queryParseFailed = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_parse_failed&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query parse failed&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> queryValidationStarted = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_validation_started&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query validation started&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> queryVaildationFailed = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_validation_failed&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query validation failed&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> queryResolved = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_resolved&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query resolved&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> queryExecutionStarted = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_execution_started&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query execution started&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> queryExecutionFailed = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_query_execution_failed&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of query execution failed&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> resolverTime = <span class="hljs-keyword">new</span> Histogram({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_resolver_duration&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;Time to resolve a GraphQL field.&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [
      <span class="hljs-string">&#x27;operationName&#x27;</span>,
      <span class="hljs-string">&#x27;operation&#x27;</span>,
      <span class="hljs-string">&#x27;parentType&#x27;</span>,
      <span class="hljs-string">&#x27;fieldName&#x27;</span>,
      <span class="hljs-string">&#x27;returnType&#x27;</span>,
    ],
  });

  <span class="hljs-keyword">const</span> totalRequestTime = <span class="hljs-keyword">new</span> Histogram({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_total_request_duration&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;Time to complete the GraphQL request&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>, <span class="hljs-string">&#x27;success&#x27;</span>],
  });

  <span class="hljs-keyword">const</span> errorsEncountered = <span class="hljs-keyword">new</span> Counter({
    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;graphql_errors_encountered&#x27;</span>,
    <span class="hljs-attr">help</span>: <span class="hljs-string">&#x27;The count of errors encountered&#x27;</span>,
    <span class="hljs-attr">labelNames</span>: [<span class="hljs-string">&#x27;operationName&#x27;</span>, <span class="hljs-string">&#x27;operation&#x27;</span>],
  });

  registry.registerMetric(queryParseStarted);
  registry.registerMetric(queryParseFailed);
  registry.registerMetric(queryValidationStarted);
  registry.registerMetric(queryVaildationFailed);
  registry.registerMetric(queryResolved);
  registry.registerMetric(queryExecutionStarted);
  registry.registerMetric(queryExecutionFailed);
  registry.registerMetric(resolverTime);
  registry.registerMetric(totalRequestTime);
  registry.registerMetric(errorsEncountered);

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">requestDidStart</span>: <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> requestStartDate = <span class="hljs-built_in">Date</span>.now();

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">parsingDidStart</span>: <span class="hljs-keyword">async</span> (context: GraphQLRequestContext) =&gt; {
          <span class="hljs-keyword">const</span> operationName = context.request?.operationName;
          <span class="hljs-keyword">const</span> operation = context.operation?.operation;
          queryParseStarted.inc({
            <span class="hljs-attr">operationName</span>: operationName,
            <span class="hljs-attr">operation</span>: operation,
          });
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (err) =&gt; {
            <span class="hljs-keyword">if</span> (err) {
              queryParseFailed.inc({
                <span class="hljs-attr">operationName</span>: operationName,
                <span class="hljs-attr">operation</span>: operation,
              });
            }
          };
        },
        <span class="hljs-attr">validationDidStart</span>: <span class="hljs-keyword">async</span> (context: GraphQLRequestContext) =&gt; {
          <span class="hljs-keyword">const</span> operationName = context.request?.operationName;
          <span class="hljs-keyword">const</span> operation = context.operation?.operation;
          queryValidationStarted.inc({
            <span class="hljs-attr">operationName</span>: operationName,
            <span class="hljs-attr">operation</span>: operation,
          });
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (err) =&gt; {
            <span class="hljs-keyword">if</span> (err) {
              queryVaildationFailed.inc({
                <span class="hljs-attr">operationName</span>: operationName,
                <span class="hljs-attr">operation</span>: operation,
              });
            }
          };
        },
        <span class="hljs-attr">didResolveOperation</span>: <span class="hljs-keyword">async</span> (context: GraphQLRequestContext) =&gt; {
          <span class="hljs-keyword">const</span> operationName = context.request?.operationName;
          <span class="hljs-keyword">const</span> operation = context.operation?.operation;
          queryResolved.inc({
            <span class="hljs-attr">operationName</span>: operationName,
            <span class="hljs-attr">operation</span>: operation,
          });
        },
        <span class="hljs-attr">executionDidStart</span>: <span class="hljs-keyword">async</span> (
          context: GraphQLRequestContext
        ): <span class="hljs-built_in">Promise</span>&lt;GraphQLRequestListener | <span class="hljs-built_in">void</span>&gt; =&gt; {
          <span class="hljs-keyword">const</span> operationName = context.request?.operationName;
          <span class="hljs-keyword">const</span> operation = context.operation?.operation;
          queryExecutionStarted.inc({
            <span class="hljs-attr">operationName</span>: operationName,
            <span class="hljs-attr">operation</span>: operation,
          });

          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">willResolveField</span>: <span class="hljs-function">(<span class="hljs-params">{ info }</span>) =&gt;</span> {
              <span class="hljs-keyword">const</span> fieldResolveStart = <span class="hljs-built_in">Date</span>.now();
              <span class="hljs-keyword">const</span> fieldName = info.fieldName;
              <span class="hljs-keyword">const</span> parentType = info.parentType.name;
              <span class="hljs-keyword">const</span> returnType = info.returnType.toString();

              <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> fieldResolveEnd = <span class="hljs-built_in">Date</span>.now();
                <span class="hljs-keyword">const</span> duration = (fieldResolveEnd - fieldResolveStart) / <span class="hljs-number">1000.0</span>;
                resolverTime.observe(
                  {
                    <span class="hljs-attr">operationName</span>: operationName,
                    <span class="hljs-attr">operation</span>: operation,
                    <span class="hljs-attr">parentType</span>: parentType,
                    <span class="hljs-attr">fieldName</span>: fieldName,
                    <span class="hljs-attr">returnType</span>: returnType,
                  },
                  duration
                );
              };
            },
            <span class="hljs-attr">executionDidEnd</span>: <span class="hljs-keyword">async</span> (err) =&gt; {
              <span class="hljs-keyword">if</span> (err) {
                queryExecutionFailed.inc({
                  <span class="hljs-attr">operationName</span>: operationName,
                  <span class="hljs-attr">operation</span>: operation,
                });
              }
            },
          };
        },
        <span class="hljs-attr">didEncounterErrors</span>: <span class="hljs-keyword">async</span> (context: GraphQLRequestContext) =&gt; {
          <span class="hljs-keyword">const</span> requestEndDate = <span class="hljs-built_in">Date</span>.now();
          <span class="hljs-keyword">const</span> duration = (requestEndDate - requestStartDate) / <span class="hljs-number">1000.0</span>;
          <span class="hljs-keyword">const</span> operationName = context.request?.operationName;
          <span class="hljs-keyword">const</span> operation = context.operation?.operation;

          errorsEncountered.inc({
            <span class="hljs-attr">operationName</span>: operationName,
            <span class="hljs-attr">operation</span>: operation,
          });
          totalRequestTime.observe(
            {
              <span class="hljs-attr">operationName</span>: operationName,
              <span class="hljs-attr">operation</span>: operation,
              <span class="hljs-attr">success</span>: <span class="hljs-string">&#x27;false&#x27;</span>,
            },
            duration
          );
        },
        <span class="hljs-attr">willSendResponse</span>: <span class="hljs-keyword">async</span> (context: GraphQLRequestContext) =&gt; {
          <span class="hljs-keyword">if</span> ((context.errors?.length ?? <span class="hljs-number">0</span>) === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">const</span> requestEndDate = <span class="hljs-built_in">Date</span>.now();
            <span class="hljs-keyword">const</span> duration = (requestEndDate - requestStartDate) / <span class="hljs-number">1000.0</span>;
            <span class="hljs-keyword">const</span> operationName = context.request?.operationName;
            <span class="hljs-keyword">const</span> operation = context.operation?.operation;

            totalRequestTime.observe(
              {
                <span class="hljs-attr">operationName</span>: operationName,
                <span class="hljs-attr">operation</span>: operation,
                <span class="hljs-attr">success</span>: <span class="hljs-string">&#x27;true&#x27;</span>,
              },
              duration
            );
          }
        },
      };
    },
  };
};

</code></pre>
<h4 id=/resolvers/helpers/fees.ts anchor=true>/resolvers/helpers/fees.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-comment">// Copied from src/qualia/services/assure/app/imports/title-api/server/rates.ts</span>
<span class="hljs-keyword">import</span> { FeesInput, FeesPayload, Fee } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { is } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/is&#x27;</span>;
<span class="hljs-keyword">import</span> { ExtractGuardedType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/util&#x27;</span>;
<span class="hljs-keyword">import</span> {
  getEndpoint,
  getUndertakerProperty,
  makeRequest,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utilities&#x27;</span>;

<span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;

<span class="hljs-keyword">import</span> { execFile } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;child_process&#x27;</span>;
<span class="hljs-keyword">import</span> { transformCountFieldIntoSelectRelationsCount } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../generated/type-graphql/helpers&#x27;</span>;

<span class="hljs-keyword">const</span> isUndertakerFee = is.obj(
  {
    <span class="hljs-attr">allow_override</span>: is.boolean,
    <span class="hljs-attr">charge</span>: is.boolean,
    <span class="hljs-attr">description</span>: is.string,
    <span class="hljs-attr">how_to_disclose</span>: is.string,
    <span class="hljs-attr">internal</span>: is.optional(
      is.obj({
        <span class="hljs-attr">FeeAmount</span>: is.optional(is.string),
        <span class="hljs-attr">FeeCode</span>: is.optional(is.string),
        <span class="hljs-attr">FeeDescription</span>: is.optional(is.string),
        <span class="hljs-attr">FeeType</span>: is.optional(is.string),
        <span class="hljs-attr">KYTaxID</span>: is.optional(is.string),
      })
    ),
    <span class="hljs-attr">paid_to</span>: is.string,
    <span class="hljs-attr">required</span>: is.boolean,
    <span class="hljs-attr">id</span>: is.string,
    <span class="hljs-attr">price</span>: is.number,
    <span class="hljs-attr">municipality</span>: is.optional(is.string),
    <span class="hljs-attr">attached_to</span>: is.optional(is.string),
    <span class="hljs-attr">effective_calculator_date</span>: is.string,
    <span class="hljs-attr">policy_id</span>: is.string,
  },
  <span class="hljs-literal">true</span>
);
<span class="hljs-keyword">const</span> isUndertakerFeesResult = is.array(isUndertakerFee);

<span class="hljs-keyword">type</span> UndertakerFee = ExtractGuardedType&lt;<span class="hljs-keyword">typeof</span> isUndertakerFee&gt;;
<span class="hljs-keyword">type</span> UndertakerFeesResult = ExtractGuardedType&lt;<span class="hljs-keyword">typeof</span> isUndertakerFeesResult&gt;;

<span class="hljs-keyword">const</span> getUndertakerPolicies = <span class="hljs-function">(<span class="hljs-params">{ policies }: FeesInput</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> policies?.map(<span class="hljs-function">(<span class="hljs-params">policy</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: policy.id,
    <span class="hljs-attr">policy_id</span>: policy.policyFormName.split(<span class="hljs-string">&#x27; &#x27;</span>).join(<span class="hljs-string">&#x27;_&#x27;</span>),
    <span class="hljs-comment">// Undertaker uses lowercase policy category IDs</span>
    <span class="hljs-attr">policy_category</span>: policy.policyCategory.toLowerCase(),
    <span class="hljs-attr">effective_date</span>: policy.rateEffectiveDate
      ? policy.rateEffectiveDate
      : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
    <span class="hljs-attr">fees</span>: policy.fees.map(<span class="hljs-function">(<span class="hljs-params">fee</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">required</span>: fee.required,
        <span class="hljs-attr">charge</span>: fee.charge,
        <span class="hljs-attr">id</span>: fee.id,
        <span class="hljs-attr">description</span>: fee.description,
        <span class="hljs-attr">internal</span>: fee.internal,
        <span class="hljs-attr">price</span>: fee.price,
        <span class="hljs-attr">calculated_municipality</span>: fee.calculatedMunicipality,
        <span class="hljs-attr">municipality</span>: fee.municipality,
        <span class="hljs-attr">calculated_price</span>: fee.calculatedPrice,
        <span class="hljs-attr">endorsement_taxes</span>: fee.endorsementTaxes
          ? fee.endorsementTaxes.map(<span class="hljs-function">(<span class="hljs-params">endorsementTax</span>) =&gt;</span> {
              <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">name</span>: endorsementTax.name,
                <span class="hljs-attr">tax_price</span>: endorsementTax.taxPrice,
              };
            })
          : [],
        <span class="hljs-attr">how_to_disclose</span>: fee.howToDisclose,
        <span class="hljs-attr">is_internal_fee</span>: fee.isInternalFee,
        <span class="hljs-attr">paid_to</span>: fee.paidTo,
        <span class="hljs-attr">allow_override</span>: fee.allowOverride,
        <span class="hljs-attr">attached_to</span>: fee.attachedTo,
      };
    }),
    <span class="hljs-attr">endorsements</span>: [],
    <span class="hljs-attr">policy_disclosed_premium</span>: (policy.policyPremium ?? <span class="hljs-number">0</span>) / <span class="hljs-number">100</span>,
    <span class="hljs-attr">policy_premium</span>: (policy.policyPremium ?? <span class="hljs-number">0</span>) / <span class="hljs-number">100</span>,
  }));
};

<span class="hljs-keyword">const</span> getUndertakerCpls = <span class="hljs-function">(<span class="hljs-params">{ cpls }: FeesInput</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> cpls?.map(<span class="hljs-function">(<span class="hljs-params">cpl</span>) =&gt;</span> ({
    <span class="hljs-attr">premium_total</span>: cpl.premiumTotal,
    <span class="hljs-attr">underwriter_premium</span>: cpl.underwriterPremium,
    <span class="hljs-attr">cpl_id</span>: cpl.cplID,
    <span class="hljs-attr">agent_premium</span>: cpl.agentPremium,
    <span class="hljs-attr">charge</span>: cpl.charge,
    <span class="hljs-attr">protected_party_type</span>: cpl.protectedPartyType,
    <span class="hljs-attr">issued_cpl_id</span>: cpl.issuedCplID,
  }));
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getFeesResolverResult = <span class="hljs-keyword">async</span> (
  input: FeesInput,
  <span class="hljs-attr">context</span>: Context
): <span class="hljs-built_in">Promise</span>&lt;[FeesPayload]&gt; =&gt; {
  <span class="hljs-keyword">if</span> (input.requestBlackBox) {
    <span class="hljs-keyword">const</span> feesResult = (<span class="hljs-keyword">await</span> makeRequest(
      <span class="hljs-string">&#x27;jacket/fees&#x27;</span>,
      <span class="hljs-built_in">JSON</span>.parse(input.requestBlackBox),
      context
    )) <span class="hljs-keyword">as</span> Record&lt;<span class="hljs-built_in">string</span>, [unknown]&gt;;
    <span class="hljs-keyword">const</span> policyIDs = <span class="hljs-built_in">Object</span>.keys(feesResult);
    <span class="hljs-keyword">return</span> policyIDs.map(<span class="hljs-function">(<span class="hljs-params">policyID</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">responseBlackBox</span>: <span class="hljs-built_in">JSON</span>.stringify({
          [policyID]: feesResult[policyID],
        }),
      };
    }) <span class="hljs-keyword">as</span> [FeesPayload];
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Deprecate this flow once hotfix is released.</span>
    <span class="hljs-keyword">const</span> organization = input.underwriter || <span class="hljs-string">&#x27;&#x27;</span>;
    <span class="hljs-keyword">const</span> policies = getUndertakerPolicies(input);
    <span class="hljs-keyword">const</span> cpls = getUndertakerCpls(input);

    <span class="hljs-keyword">const</span> requestBody = {
      <span class="hljs-attr">endpoint</span>: getEndpoint(organization),
      <span class="hljs-attr">user</span>: input.secondaryApiParams?.user,
      <span class="hljs-attr">password</span>: input.secondaryApiParams?.password,
      <span class="hljs-attr">agentID</span>: input.secondaryApiParams?.agentID,
      <span class="hljs-attr">policies</span>: policies,
      <span class="hljs-attr">cpls</span>: cpls,
      <span class="hljs-attr">property</span>: getUndertakerProperty(input),
    };

    <span class="hljs-keyword">const</span> feesResult: Record&lt;<span class="hljs-built_in">string</span>, UndertakerFeesResult&gt; = (<span class="hljs-keyword">await</span> makeRequest(
      <span class="hljs-string">&#x27;jacket/fees&#x27;</span>,
      requestBody,
      context
    )) <span class="hljs-keyword">as</span> Record&lt;<span class="hljs-built_in">string</span>, UndertakerFeesResult&gt;;

    <span class="hljs-keyword">const</span> policyIDs = <span class="hljs-built_in">Object</span>.keys(feesResult);
    <span class="hljs-keyword">const</span> fees = policyIDs.map(<span class="hljs-function">(<span class="hljs-params">policyID, i</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> policyFees: Fee[] = feesResult[policyID].map(
        <span class="hljs-function">(<span class="hljs-params">fee: UndertakerFee</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">effectiveCalculatorDate</span>: fee.effective_calculator_date,
            <span class="hljs-attr">attachedTo</span>: fee.attached_to,
            <span class="hljs-attr">price</span>: <span class="hljs-built_in">parseFloat</span>(fee.price.toString()),
            <span class="hljs-attr">internal</span>: fee.internal,
            <span class="hljs-attr">allowOverride</span>: fee.allow_override,
            <span class="hljs-attr">howToDisclose</span>: fee.how_to_disclose,
            <span class="hljs-attr">id</span>: fee.id,
            <span class="hljs-attr">charge</span>: fee.charge,
            <span class="hljs-attr">required</span>: fee.required,
            <span class="hljs-attr">description</span>: fee.description,
            <span class="hljs-attr">paidTo</span>: fee.paid_to,
            <span class="hljs-attr">municipality</span>: fee.municipality,
          };
        }
      );

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">policyFormName</span>: policyID.toUpperCase(),
        <span class="hljs-attr">fees</span>: policyFees,
      };
    });

    <span class="hljs-keyword">return</span> fees <span class="hljs-keyword">as</span> [FeesPayload];
  }
};

</code></pre>
<h4 id=/resolvers/helpers/rateManual.ts anchor=true>/resolvers/helpers/rateManual.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { StateType, Status } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/prisma&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> findRateManual = <span class="hljs-keyword">async</span> (
  uwName: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">state</span>: StateType,
  <span class="hljs-attr">effectiveDate</span>: <span class="hljs-built_in">Date</span>,
  <span class="hljs-attr">allowedStatus</span>: Status[] = [Status.PROD]
) =&gt; {
  <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
    <span class="hljs-attr">where</span>: {
      <span class="hljs-attr">underwriter</span>: {
        <span class="hljs-attr">name</span>: uwName,
      },
      state,
      <span class="hljs-attr">status</span>: {
        <span class="hljs-attr">in</span>: allowedStatus,
      },
      <span class="hljs-attr">effectiveDate</span>: {
        <span class="hljs-attr">lte</span>: effectiveDate,
      },
    },
    <span class="hljs-attr">include</span>: {
      <span class="hljs-attr">endorsementShortRates</span>: {
        <span class="hljs-attr">include</span>: {
          <span class="hljs-attr">baseRateTable</span>: <span class="hljs-literal">true</span>,
        },
      },
      <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">policyRates</span>: {
        <span class="hljs-attr">include</span>: {
          <span class="hljs-attr">rateTable</span>: {
            <span class="hljs-attr">select</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
            },
          },
          <span class="hljs-attr">simultaneousPremiumTable</span>: {
            <span class="hljs-attr">select</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
            },
          },
          <span class="hljs-attr">reissueRateTable</span>: {
            <span class="hljs-attr">select</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
            },
          },
          <span class="hljs-attr">excessRateTable</span>: {
            <span class="hljs-attr">select</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
            },
          },
        },
      },
      <span class="hljs-attr">endorsementRates</span>: {
        <span class="hljs-attr">include</span>: {
          <span class="hljs-attr">baseRateTableName</span>: {
            <span class="hljs-attr">select</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
            },
          },
        },
      },
      <span class="hljs-attr">cplRates</span>: {
        <span class="hljs-attr">include</span>: { <span class="hljs-attr">rateTable</span>: { <span class="hljs-attr">select</span>: { <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span> } } },
      },
    },
    <span class="hljs-attr">orderBy</span>: {
      <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span>,
    },
  });
  <span class="hljs-keyword">if</span> (!rateManual) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
      <span class="hljs-string">`No rate manual found for <span class="hljs-subst">${uwName}</span> in <span class="hljs-subst">${state}</span> for effective date <span class="hljs-subst">${effectiveDate}</span>`</span>
    );
  }
  <span class="hljs-keyword">return</span> rateManual;
};

</code></pre>
<h4 id=/resolvers/helpers/rates.ts anchor=true>/resolvers/helpers/rates.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> Decimal <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;decimal.js&#x27;</span>;
<span class="hljs-comment">// Copied from src/qualia/services/assure/app/imports/title-api/server/rates.ts</span>
<span class="hljs-keyword">import</span> {
  propertyTypes,
  purposes,
  RatesInput,
  RatesInputPolicy,
  RatesPayload,
  RatesPayloadDocument,
  RateTypesInput,
  RateTypesPayload,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  PropertyType <span class="hljs-keyword">as</span> QualiaPropertyType,
  TestPolicyRateInput,
  TestRateConfigurationResponse,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { is } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/is&#x27;</span>;
<span class="hljs-keyword">import</span> {
  isPolicyForRates,
  isTitleRates2Supported,
  calculateRates,
  getRateTypes,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/title-rates&#x27;</span>;
<span class="hljs-keyword">import</span> { ExtractGuardedType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/util&#x27;</span>;
<span class="hljs-keyword">import</span> {
  centsToDollars,
  getMoney,
  Money,
  getEndpoint,
  makeRequest,
  getUndertakerProperty,
  getUndertakerExtendedCoverageStatus,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utilities&#x27;</span>;
<span class="hljs-keyword">import</span> { unmapPropertyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utilities/propertyTypes&#x27;</span>;
<span class="hljs-keyword">import</span> { hasMultipleLandUseTypes } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utilities/propertyTypes&#x27;</span>;
<span class="hljs-keyword">import</span> { underwriters } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/title-rates/underwriters&#x27;</span>;
<span class="hljs-keyword">import</span> { findRateManual } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rateManual&#x27;</span>;
<span class="hljs-keyword">import</span> { calculateRatesWithRateManual } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/title-rates/calculate-rates&#x27;</span>;
<span class="hljs-keyword">import</span> {
  matchPolicyConfig,
  calculateRatesInternal,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/title-rates/calculate-rates-internal&#x27;</span>;
<span class="hljs-keyword">import</span> { parseDBRatesConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/util/mongoUtils&#x27;</span>;
<span class="hljs-keyword">import</span> { logger } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../logger&#x27;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  CalculateRatesResult,
  PolicyForRates,
  RateResult,
  RatesConfig,
  RoundingType,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/title-rates/data-structures&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  StateType,
  PolicyCategory,
  PolicyType,
  PropertyType,
  TransactionType,
  RateManual,
  PolicyRate,
  EndorsementRate,
  EndorsementShortRate,
  RateTable,
  CplRate,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { Formula, Status } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;

<span class="hljs-keyword">const</span> isUndertakerRatesResult = is.array(
  is.obj(
    {
      <span class="hljs-attr">agent_premium</span>: is.number,
      <span class="hljs-attr">endorsements</span>: is.array(
        is.obj(
          {
            <span class="hljs-attr">agent_premium</span>: is.number,
            <span class="hljs-attr">endorsement_id</span>: is.string,
            <span class="hljs-attr">underwriter_premium</span>: is.number,
          },
          <span class="hljs-literal">true</span>
        )
      ),
      <span class="hljs-attr">id</span>: is.string,
      <span class="hljs-attr">underwriter_premium</span>: is.number,
      <span class="hljs-attr">trid</span>: is.number,
    },
    <span class="hljs-literal">true</span>
  )
);

<span class="hljs-keyword">const</span> isUndertakerStatusResult = is.obj(
  {
    <span class="hljs-attr">status</span>: is.array(is.string),
  },
  <span class="hljs-literal">true</span>
);

<span class="hljs-keyword">type</span> UndertakerRatesResult = ExtractGuardedType&lt;<span class="hljs-keyword">typeof</span> isUndertakerRatesResult&gt;;
<span class="hljs-keyword">type</span> UndertakerStatusResult = ExtractGuardedType&lt;
  <span class="hljs-keyword">typeof</span> isUndertakerStatusResult
&gt;;
<span class="hljs-keyword">type</span> UndertakerBlackBoxResult = <span class="hljs-built_in">string</span>;

<span class="hljs-keyword">const</span> calculateSplit = <span class="hljs-function">(<span class="hljs-params">totalCents: Money, agentSplitPercentage: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> agentSplitFraction = <span class="hljs-built_in">parseFloat</span>(agentSplitPercentage) / <span class="hljs-number">100</span>;
  <span class="hljs-keyword">const</span> agentPremium = getMoney(<span class="hljs-built_in">Math</span>.round(totalCents * agentSplitFraction));
  <span class="hljs-keyword">const</span> underwriterPremium = getMoney(totalCents - agentPremium);
  <span class="hljs-keyword">return</span> {
    agentPremium,
    underwriterPremium,
  };
};

<span class="hljs-keyword">const</span> getUndertakerPolicies = <span class="hljs-function">(<span class="hljs-params">
  { policies }: RatesInput,
  policySplit: <span class="hljs-built_in">string</span>,
  endorsementSplit: <span class="hljs-built_in">string</span>
</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> policies.map(<span class="hljs-function">(<span class="hljs-params">policy</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: policy.id,
    <span class="hljs-attr">policy_id</span>: policy.policyFormName.split(<span class="hljs-string">&#x27; &#x27;</span>).join(<span class="hljs-string">&#x27;_&#x27;</span>),
    <span class="hljs-attr">file_number</span>: policy.fileNumber,
    <span class="hljs-comment">// Undertaker uses lowercase policy category IDs</span>
    <span class="hljs-attr">policy_category</span>: policy.policyCategory.toLowerCase(),
    <span class="hljs-attr">split</span>: policySplit,
    <span class="hljs-attr">rate_type</span>: policy.rateType.split(<span class="hljs-string">&#x27; &#x27;</span>).join(<span class="hljs-string">&#x27;_&#x27;</span>),
    ...(<span class="hljs-keyword">typeof</span> policy.previousCoverageAmount === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp; {
      <span class="hljs-attr">old_loan_amount</span>: policy.previousCoverageAmount / <span class="hljs-number">100</span>,
    }),
    <span class="hljs-attr">old_loan_age</span>: policy.previousLoanAge,
    <span class="hljs-attr">endorsements</span>: (policy?.endorsements || []).map(<span class="hljs-function">(<span class="hljs-params">endorsement</span>) =&gt;</span> ({
      <span class="hljs-attr">endorsement_id</span>: endorsement.id,
      <span class="hljs-attr">split</span>: endorsementSplit,
      <span class="hljs-attr">is_override</span>: endorsement.secondaryApiParams?.isOverride,
      <span class="hljs-attr">override_reason</span>: endorsement.secondaryApiParams?.overrideReason,
      <span class="hljs-attr">price</span>: endorsement.secondaryApiParams?.price,
    })),
    <span class="hljs-attr">insurance_amount</span>: policy.coverageAmount / <span class="hljs-number">100</span>,
    <span class="hljs-attr">prior_policy_type</span>: policy.previousPolicyFormName ?? policy.policyFormName,
    <span class="hljs-attr">prior_rate_type</span>: (policy.previousRateType ?? policy.rateType)
      .split(<span class="hljs-string">&#x27; &#x27;</span>)
      .join(<span class="hljs-string">&#x27;_&#x27;</span>),
    <span class="hljs-attr">effective_date</span>: policy.rateEffectiveDate
      ? policy.rateEffectiveDate
      : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
    <span class="hljs-attr">fees</span>: [],
    <span class="hljs-attr">rate_type_stat_code</span>: policy.rateTypeStatCode,
    <span class="hljs-attr">junior_loan_insurance_amounts</span>: policy.juniorLoanInsuranceAmounts || [],
  }));
};

<span class="hljs-keyword">const</span> COMMERCIAL_TYPES = [
  <span class="hljs-string">&#x27;Residence (5+ Families)&#x27;</span>,
  <span class="hljs-string">&#x27;Commercial&#x27;</span>,
  <span class="hljs-string">&#x27;Commercial Leasehold&#x27;</span>,
];

<span class="hljs-keyword">const</span> isCommercial = <span class="hljs-function">(<span class="hljs-params">
  propertyType: <span class="hljs-built_in">string</span> = propertyTypes.RESIDENCE_ONE_TO_FOUR_FAMILIES
</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> COMMERCIAL_TYPES.includes(propertyType);
};

<span class="hljs-keyword">const</span> getRates = <span class="hljs-keyword">async</span> ({
  input,
  organization,
  policySplit,
  endorsementSplit,
  includeStagingRates,
  context,
}: {
  <span class="hljs-attr">input</span>: RatesInput;
  organization: <span class="hljs-built_in">string</span>;
  policySplit: <span class="hljs-built_in">string</span>;
  endorsementSplit: <span class="hljs-built_in">string</span>;
  includeStagingRates: <span class="hljs-built_in">boolean</span>;
  context: Context;
}): <span class="hljs-built_in">Promise</span>&lt;
  UndertakerRatesResult | UndertakerStatusResult | UndertakerBlackBoxResult
&gt; =&gt; {
  <span class="hljs-keyword">const</span> policies = getUndertakerPolicies(input, policySplit, endorsementSplit);

  <span class="hljs-keyword">const</span> requestBody = {
    <span class="hljs-attr">endpoint</span>: getEndpoint(organization),
    <span class="hljs-attr">user</span>: input.secondaryApiParams?.user,
    <span class="hljs-attr">password</span>: input.secondaryApiParams?.password,
    <span class="hljs-attr">agentID</span>: input.secondaryApiParams?.agentID,
    <span class="hljs-attr">policies</span>: policies,
    <span class="hljs-attr">cpls</span>: [],
    <span class="hljs-attr">property</span>: getUndertakerProperty(input),
    <span class="hljs-attr">orderNumber</span>: policies[<span class="hljs-number">0</span>].file_number,
    <span class="hljs-attr">sellers</span>: [],
    <span class="hljs-attr">borrowers</span>: [],
    <span class="hljs-attr">default_questions</span>: [],
    <span class="hljs-attr">junior_loan_insurance_amounts</span>: [], <span class="hljs-comment">// temp fix to bug introduced by PR #22469</span>
    <span class="hljs-attr">skip_purpose_validation</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">fl_simultaneous_rate</span>: input.flSimultaneousRate
      ? input.flSimultaneousRate / <span class="hljs-number">100</span>
      : <span class="hljs-number">0</span>,
    <span class="hljs-attr">fl_endorsement_rates</span>: (input.flEndorsementRates ?? []).map(
      <span class="hljs-function">(<span class="hljs-params">endorsement</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> {
          ...endorsement,
          <span class="hljs-attr">rate</span>: endorsement.rate / <span class="hljs-number">100</span>,
        };
      }
    ),
    <span class="hljs-comment">// SSRM-<span class="hljs-doctag">TODO:</span> need to address this for MTUT rates, probably as an optional parameter</span>
    <span class="hljs-comment">// qualia_deployment_name: getQualiaDeploymentName(input.agentID), // title-2507 - need this to calculate ctc-swltic company rates</span>
  };

  <span class="hljs-keyword">let</span> responseBody;
  <span class="hljs-comment">// state will be non-null in https://github.com/qualialabs/title-rates-api/pull/17</span>
  <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span>
  <span class="hljs-keyword">const</span> state = input.property.address.state!;
  <span class="hljs-comment">// lowercase county names are saved here, but capitalized county names are used in Undertaker</span>
  <span class="hljs-keyword">const</span> counties = input.property.address.counties?.map(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> c.toLowerCase());
  <span class="hljs-keyword">const</span> county = counties?.[<span class="hljs-number">0</span>] ?? <span class="hljs-string">&#x27;&#x27;</span>;

  <span class="hljs-keyword">const</span> requestBlackBox = input?.requestBlackBox;
  <span class="hljs-keyword">const</span> hasUndertakerBlackBox = !!requestBlackBox;
  <span class="hljs-keyword">const</span> parsedRequestBlackBox = ((
    rawRequest: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>
  ): { assure_url?: <span class="hljs-built_in">string</span> } =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (!rawRequest) {
        <span class="hljs-keyword">return</span> {};
      }
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(rawRequest);
    } <span class="hljs-keyword">catch</span> (e) {
      logger.error(<span class="hljs-string">`Failed to parse legacy Undertaker request: <span class="hljs-subst">${rawRequest}</span>`</span>, {
        <span class="hljs-attr">sourceId</span>: <span class="hljs-string">&#x27;title-rates-api::parseRequestBlackBox&#x27;</span>,
      });
      <span class="hljs-keyword">return</span> {};
    }
  })(requestBlackBox);
  <span class="hljs-keyword">const</span> isAssureProxyRequest =
    parsedRequestBlackBox.hasOwnProperty(<span class="hljs-string">&#x27;assure_url&#x27;</span>) &amp;&amp;
    parsedRequestBlackBox.assure_url;

  <span class="hljs-keyword">const</span> shouldUseSSR =
    !isAssureProxyRequest &amp;&amp;
    (<span class="hljs-keyword">await</span> isTitleRates2Supported(organization, state, includeStagingRates));

  <span class="hljs-keyword">if</span> (shouldUseSSR) {
    <span class="hljs-keyword">const</span> policies = requestBody.policies.map(<span class="hljs-function">(<span class="hljs-params">policy</span>) =&gt;</span> {
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> unify the rates library and rest of codebase to use same values</span>
      <span class="hljs-comment">// so that we can just use PolicyForRates here and not isPolicyForRates.</span>

      <span class="hljs-keyword">let</span> insuranceAmount = policy.insurance_amount;
      <span class="hljs-keyword">const</span> lenderPolicyCategory: PolicyCategory = <span class="hljs-string">&#x27;LENDER&#x27;</span>;
      <span class="hljs-keyword">if</span> (policy.policy_category.toUpperCase() == lenderPolicyCategory) {
        <span class="hljs-keyword">if</span> (policy.junior_loan_insurance_amounts?.length) {
          <span class="hljs-keyword">let</span> junior_loan_insurance_amounts_total = <span class="hljs-number">0</span>;
          policy.junior_loan_insurance_amounts.forEach(<span class="hljs-function">(<span class="hljs-params">insuranceAmountObj</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> insuranceAmountObj.insuranceAmount === <span class="hljs-string">&#x27;string&#x27;</span>) {
              junior_loan_insurance_amounts_total += <span class="hljs-built_in">parseFloat</span>(
                insuranceAmountObj.insuranceAmount
              );
            } <span class="hljs-keyword">else</span> {
              junior_loan_insurance_amounts_total +=
                insuranceAmountObj.insuranceAmount;
            }
          });

          insuranceAmount += junior_loan_insurance_amounts_total;
        }
      }

      <span class="hljs-keyword">const</span> policyForRates = {
        state,
        county,
        <span class="hljs-attr">policy_type</span>: policy.policy_id.split(<span class="hljs-string">&#x27;_&#x27;</span>).join(<span class="hljs-string">&#x27; &#x27;</span>),
        <span class="hljs-attr">policy_category</span>: policy.policy_category,
        <span class="hljs-attr">rate_type</span>: policy.rate_type.split(<span class="hljs-string">&#x27;_&#x27;</span>).join(<span class="hljs-string">&#x27; &#x27;</span>),
        <span class="hljs-attr">property_type</span>: isCommercial(requestBody.property.property_type)
          ? <span class="hljs-string">&#x27;commercial&#x27;</span>
          : <span class="hljs-string">&#x27;residential&#x27;</span>,
        <span class="hljs-attr">insurance_amount</span>: insuranceAmount,
        <span class="hljs-attr">old_loan_age</span>: policy.old_loan_age ?? <span class="hljs-number">0</span>,
        <span class="hljs-attr">old_loan_amount</span>: policy.old_loan_amount ?? <span class="hljs-number">0</span>,
        <span class="hljs-attr">crr_orders</span>: policy.old_loan_age ?? <span class="hljs-number">0</span>, <span class="hljs-comment">// qualia core reuses old_loan_age as crr_orders</span>
        <span class="hljs-attr">endorsements</span>: policy.endorsements.map(
          <span class="hljs-function">(<span class="hljs-params">{ endorsement_id }</span>) =&gt;</span> endorsement_id
        ),
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> make this required when deployed on both core and assure https://qualialabs.atlassian.net/browse/ASSURE-1171</span>
        <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span>
        <span class="hljs-attr">transaction_type</span>: purposes[input.purpose!].toLowerCase(),
        <span class="hljs-attr">underwriter_split</span>: (<span class="hljs-number">100</span> - <span class="hljs-built_in">parseFloat</span>(policy.split)) / <span class="hljs-number">100</span>,
        <span class="hljs-attr">prior_policy_type</span>: policy.prior_policy_type.split(<span class="hljs-string">&#x27;_&#x27;</span>).join(<span class="hljs-string">&#x27; &#x27;</span>),
        <span class="hljs-attr">prior_rate_type</span>: policy.prior_rate_type.split(<span class="hljs-string">&#x27;_&#x27;</span>).join(<span class="hljs-string">&#x27; &#x27;</span>),
        <span class="hljs-attr">effective_date</span>: policy.effective_date,
      };
      <span class="hljs-keyword">if</span> (!isPolicyForRates(policyForRates)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
          <span class="hljs-string">`unexpected-policy-for-rates-format: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(
            policyForRates
          )}</span>`</span>
        );
      }
      <span class="hljs-keyword">return</span> policyForRates;
    });

    <span class="hljs-keyword">const</span> calculateRatesArguments = {
      <span class="hljs-attr">uwName</span>: organization <span class="hljs-keyword">as</span> keyof <span class="hljs-keyword">typeof</span> underwriters,
      state,
      policies,
      includeStagingRates,
    };

    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> calculateRates(calculateRatesArguments);

    <span class="hljs-keyword">let</span> simplifiedRates: CalculateRatesResult;
    <span class="hljs-comment">// ========= simplified rates that removes spreadsheet code ===========</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> policyForSimplifiedCalculation = getPoliciesForCalculation(
        input,
        policySplit,
        endorsementSplit
      );
      <span class="hljs-keyword">const</span> effectiveDate = input.policies[<span class="hljs-number">0</span>].rateEffectiveDate ?? <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
      simplifiedRates = <span class="hljs-keyword">await</span> calculateSimplifiedRates({
        result,
        policies,
        <span class="hljs-attr">policiesWithDBFields</span>: policyForSimplifiedCalculation,
        effectiveDate,
        <span class="hljs-attr">underwriter</span>: organization,
        state,
      });
      <span class="hljs-comment">// verify the new calculation matches the old calculation</span>
      simplifiedRates.policies.map(<span class="hljs-function">(<span class="hljs-params">{ endorsement_rates }, i</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (
          <span class="hljs-built_in">JSON</span>.stringify(result.policies[i].endorsement_rates) !==
          <span class="hljs-built_in">JSON</span>.stringify(endorsement_rates)
        ) {
          logger.error(
            <span class="hljs-string">`simplified rates on policy <span class="hljs-subst">${i}</span> do not match, expected:<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(
              result.policies[i].endorsement_rates
            )}</span> actual:<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(
              endorsement_rates
            )}</span>, input: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(input)}</span>`</span>
          );
        }
      });
    } <span class="hljs-keyword">catch</span> (e) {
      logger.error(<span class="hljs-string">&#x27;simplified rates error&#x27;</span>, { <span class="hljs-attr">error</span>: e <span class="hljs-keyword">as</span> <span class="hljs-built_in">Error</span> });
      simplifiedRates = result;
    }
    <span class="hljs-comment">// ====================================================================</span>

    <span class="hljs-keyword">const</span> ratesResult = result.policies;

    <span class="hljs-comment">// the result will come back in the same order</span>
    responseBody = ratesResult.map(<span class="hljs-function">(<span class="hljs-params">rates, i</span>) =&gt;</span> ({
      ...rates,
      <span class="hljs-attr">id</span>: requestBody.policies[i].id,
      <span class="hljs-attr">endorsements</span>: simplifiedRates.policies[i].endorsement_rates.map(
        <span class="hljs-function">(<span class="hljs-params">premium, j</span>) =&gt;</span> ({
          <span class="hljs-attr">endorsement_id</span>: policies[i].endorsements[j],
          <span class="hljs-attr">agent_premium</span>: premium.agent_premium,
          <span class="hljs-attr">underwriter_premium</span>: premium.underwriter_premium,
        })
      ),
    }));

    <span class="hljs-keyword">if</span> (
      !(
        isUndertakerRatesResult(responseBody) ||
        isUndertakerStatusResult(responseBody)
      )
    ) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
        <span class="hljs-string">`unexpected-rates-format: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(responseBody)}</span>`</span>
      );
    }

    <span class="hljs-keyword">return</span> responseBody;
  }

  <span class="hljs-keyword">if</span> (hasUndertakerBlackBox) {
    <span class="hljs-keyword">const</span> ratesResult = <span class="hljs-keyword">await</span> makeRequest(
      <span class="hljs-string">&#x27;jacket/calculateRates&#x27;</span>,
      parsedRequestBlackBox,
      context
    );
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(ratesResult);
  }

  <span class="hljs-comment">// Fall back to original MTUT fallback with defined schemas</span>
  <span class="hljs-keyword">const</span> ratesResult = (<span class="hljs-keyword">await</span> makeRequest(
    <span class="hljs-string">&#x27;jacket/calculateRates&#x27;</span>,
    requestBody,
    context
  )) <span class="hljs-keyword">as</span> UndertakerRatesResult | UndertakerStatusResult;
  <span class="hljs-comment">// the field &#x27;id&#x27; only exists in Assure underwriter rates, so we need to add it to all</span>
  <span class="hljs-comment">// see AssureJacket::get_policies_with_ids in Undertaker</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(ratesResult)) {
    responseBody = ratesResult.map(<span class="hljs-function">(<span class="hljs-params">rates, i</span>) =&gt;</span> ({
      ...rates,
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> parseFloat(String(x))) because currently Undertaker returns premiums as either strings or numbers,</span>
      <span class="hljs-attr">agent_premium</span>: <span class="hljs-built_in">parseFloat</span>(<span class="hljs-built_in">String</span>(rates.agent_premium)),
      <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-built_in">parseFloat</span>(<span class="hljs-built_in">String</span>(rates.underwriter_premium)),
      <span class="hljs-attr">trid</span>: <span class="hljs-built_in">parseFloat</span>(<span class="hljs-built_in">String</span>(rates.trid)),
      <span class="hljs-attr">id</span>: requestBody.policies[i].id,
      <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>
      <span class="hljs-attr">endorsements</span>: rates.endorsements.map(<span class="hljs-function">(<span class="hljs-params">endorsement: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> {
          ...endorsement,
          <span class="hljs-attr">agent_premium</span>: <span class="hljs-built_in">parseFloat</span>(endorsement.agent_premium),
          <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-built_in">parseFloat</span>(endorsement.underwriter_premium),
        };
      }),
    }));
  } <span class="hljs-keyword">else</span> {
    responseBody = ratesResult;
  }

  <span class="hljs-keyword">if</span> (
    !(
      isUndertakerRatesResult(responseBody) ||
      isUndertakerStatusResult(responseBody)
    )
  ) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`unexpected-rates-format: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(responseBody)}</span>`</span>);
  }

  <span class="hljs-keyword">return</span> responseBody;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> dollarsToCents = (dollars: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">Money</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> cents = <span class="hljs-built_in">Math</span>.round(<span class="hljs-keyword">new</span> Decimal(dollars).mul(<span class="hljs-number">100</span>).toNumber());
  <span class="hljs-keyword">return</span> getMoney(cents);
};

<span class="hljs-keyword">const</span> getPolicyPayload = ({
  organization,
  state,
  inputPolicy,
  getPolicyRates,
  policySplit,
  endorsementSplit,
  overrideSplit,
  includeStagingRates,
}: {
  <span class="hljs-attr">organization</span>: <span class="hljs-built_in">string</span>;
  state: StateType;
  inputPolicy: RatesInputPolicy;
  getPolicyRates: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Promise</span>&lt;UndertakerRatesResult[<span class="hljs-built_in">number</span>]&gt;;
  policySplit: <span class="hljs-built_in">string</span>;
  endorsementSplit: <span class="hljs-built_in">string</span>;
  overrideSplit: <span class="hljs-built_in">boolean</span>;
  includeStagingRates: <span class="hljs-built_in">boolean</span>;
}): <span class="hljs-function"><span class="hljs-params">RatesPayloadDocument</span> =&gt;</span> {
  <span class="hljs-comment">// What&#x27;s up with these fields being defined as async functions?</span>
  <span class="hljs-comment">// Well, if the client only wants rates or only wants fees, then we can avoid</span>
  <span class="hljs-comment">// making calls for both.</span>
  <span class="hljs-comment">// Apollo intelligently resolves fields (or doesn&#x27;t) based on whether they</span>
  <span class="hljs-comment">// were called or not by the client.</span>
  <span class="hljs-comment">// What kind of client would call for rates and fees separately? Core! Core</span>
  <span class="hljs-comment">// has two entirely separate code paths for rates and fees.</span>

  <span class="hljs-keyword">const</span> getSplits = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Recompute the split and ignore undertaker to force custom splits even in promulgated states</span>
    <span class="hljs-keyword">const</span> rates = <span class="hljs-keyword">await</span> getPolicyRates();
    <span class="hljs-keyword">const</span> totalPremium = getMoney(
      dollarsToCents(rates.underwriter_premium) +
        dollarsToCents(rates.agent_premium)
    );
    <span class="hljs-keyword">const</span> { agentPremium, underwriterPremium } = (<span class="hljs-keyword">await</span> isTitleRates2Supported(
      organization,
      state,
      includeStagingRates
    ))
      ? {
          <span class="hljs-attr">agentPremium</span>: dollarsToCents(rates.agent_premium),
          <span class="hljs-attr">underwriterPremium</span>: dollarsToCents(rates.underwriter_premium),
        }
      : overrideSplit
      ? calculateSplit(totalPremium, policySplit)
      : {
          <span class="hljs-attr">agentPremium</span>: dollarsToCents(rates.agent_premium),
          <span class="hljs-attr">underwriterPremium</span>: dollarsToCents(rates.underwriter_premium),
        };
    <span class="hljs-keyword">return</span> { totalPremium, agentPremium, underwriterPremium };
  };

  <span class="hljs-keyword">const</span> getEndorsementSplits = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> supportedInApi = <span class="hljs-keyword">await</span> isTitleRates2Supported(
      organization,
      state,
      includeStagingRates
    );
    <span class="hljs-keyword">const</span> rates = <span class="hljs-keyword">await</span> getPolicyRates();
    <span class="hljs-keyword">const</span> endorsements = rates.endorsements;
    <span class="hljs-keyword">return</span> endorsements.map(<span class="hljs-function">(<span class="hljs-params">endorsement</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> totalPremium = getMoney(
        dollarsToCents(endorsement.underwriter_premium) +
          dollarsToCents(endorsement.agent_premium)
      );

      <span class="hljs-keyword">const</span> { agentPremium, underwriterPremium } = supportedInApi
        ? calculateSplit(totalPremium, endorsementSplit)
        : overrideSplit
        ? calculateSplit(totalPremium, endorsementSplit)
        : {
            <span class="hljs-attr">agentPremium</span>: dollarsToCents(endorsement.agent_premium),
            <span class="hljs-attr">underwriterPremium</span>: dollarsToCents(endorsement.underwriter_premium),
          };

      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">id</span>: endorsement.endorsement_id,
        underwriterPremium,
        agentPremium,
        totalPremium,
        <span class="hljs-attr">disclosedTotalPremium</span>: totalPremium,
      };
    });
  };

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RatesPayloadDocument({
    <span class="hljs-attr">id</span>: inputPolicy.id,
    <span class="hljs-attr">underwriterPremium</span>: <span class="hljs-keyword">async</span> () =&gt; (<span class="hljs-keyword">await</span> getSplits()).underwriterPremium,
    <span class="hljs-attr">agentPremium</span>: <span class="hljs-keyword">async</span> () =&gt; (<span class="hljs-keyword">await</span> getSplits()).agentPremium,
    <span class="hljs-attr">totalPremium</span>: <span class="hljs-keyword">async</span> () =&gt; (<span class="hljs-keyword">await</span> getSplits()).totalPremium,
    <span class="hljs-attr">disclosedTotalPremium</span>: <span class="hljs-keyword">async</span> () =&gt;
      dollarsToCents((<span class="hljs-keyword">await</span> getPolicyRates()).trid),
    <span class="hljs-attr">endorsements</span>: <span class="hljs-keyword">async</span> () =&gt; <span class="hljs-keyword">await</span> getEndorsementSplits(),
  });
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getRatesResolverResult = <span class="hljs-keyword">async</span> (
  input: RatesInput,
  <span class="hljs-attr">context</span>: Context
): <span class="hljs-built_in">Promise</span>&lt;RatesPayload&gt; =&gt; {
  <span class="hljs-keyword">const</span> property = input.property;
  <span class="hljs-comment">// state will be non-null in https://github.com/qualialabs/title-rates-api/pull/17</span>
  <span class="hljs-comment">// eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span>
  <span class="hljs-keyword">const</span> state = property.address.state!;
  <span class="hljs-keyword">let</span> cachedRatesPromise: <span class="hljs-literal">null</span> | <span class="hljs-built_in">Promise</span>&lt;
    UndertakerRatesResult | UndertakerStatusResult | UndertakerBlackBoxResult
  &gt; = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> organization = input.underwriter;
  <span class="hljs-keyword">const</span> policySplit: <span class="hljs-built_in">string</span> = input.policySplit ? input.policySplit : <span class="hljs-string">&#x27;100&#x27;</span>;
  <span class="hljs-keyword">const</span> overrideSplit: <span class="hljs-built_in">boolean</span> =
    input.overrideSplit === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">const</span> endorsementSplit: <span class="hljs-built_in">string</span> = input.endorsementSplit
    ? input.endorsementSplit
    : <span class="hljs-string">&#x27;100&#x27;</span>;
  <span class="hljs-keyword">const</span> includeStagingRates = input.includeStagingRates || <span class="hljs-literal">false</span>;

  <span class="hljs-comment">// There&#x27;s currently no point in calculating without a policy, but</span>
  <span class="hljs-comment">// we accept it anyway</span>
  <span class="hljs-keyword">if</span> (input.policies.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">policies</span>: [] };
  }

  <span class="hljs-keyword">const</span> getRatesResult = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!cachedRatesPromise) {
      cachedRatesPromise = getRates({
        input,
        organization,
        policySplit,
        endorsementSplit,
        includeStagingRates,
        context,
      });
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> cachedRatesPromise;
  };

  <span class="hljs-keyword">const</span> ratesResult = <span class="hljs-keyword">await</span> getRatesResult();
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ratesResult === <span class="hljs-string">&#x27;string&#x27;</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">responseBlackBox</span>: ratesResult,
    };
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;status&#x27;</span> <span class="hljs-keyword">in</span> ratesResult) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">status</span>: ratesResult.status,
    };
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> policies = input.policies.map(<span class="hljs-function">(<span class="hljs-params">inputPolicy</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> getPolicyRates = <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">const</span> policyRates = ratesResult.find(<span class="hljs-function">(<span class="hljs-params">{ id }</span>) =&gt;</span> id === inputPolicy.id);
        <span class="hljs-keyword">if</span> (!policyRates) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;missing-policy-rates-result&#x27;</span>);
        }

        <span class="hljs-keyword">return</span> policyRates;
      };

      <span class="hljs-keyword">return</span> getPolicyPayload({
        organization,
        state,
        inputPolicy,
        getPolicyRates,
        policySplit,
        endorsementSplit,
        overrideSplit,
        includeStagingRates,
      });
    });

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">policies</span>: policies.map(
        <span class="hljs-function">(<span class="hljs-params">policy</span>) =&gt;</span>
          <span class="hljs-keyword">new</span> RatesPayloadDocument({
            <span class="hljs-attr">id</span>: policy.id,
            <span class="hljs-attr">underwriterPremium</span>: <span class="hljs-keyword">async</span> () =&gt; policy.underwriterPremium(policy),
            <span class="hljs-attr">agentPremium</span>: <span class="hljs-keyword">async</span> () =&gt; policy.agentPremium(policy),
            <span class="hljs-attr">totalPremium</span>: <span class="hljs-keyword">async</span> () =&gt; policy.totalPremium(policy),
            <span class="hljs-attr">disclosedTotalPremium</span>: <span class="hljs-keyword">async</span> () =&gt;
              policy.disclosedTotalPremium(policy),
            <span class="hljs-attr">endorsements</span>: <span class="hljs-keyword">async</span> () =&gt; policy.endorsements(policy),
          })
      ),
    };
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getRateTypesResolverResult = <span class="hljs-keyword">async</span> (
  input: RateTypesInput,
  <span class="hljs-attr">context</span>: Context
): <span class="hljs-built_in">Promise</span>&lt;[RateTypesPayload]&gt; =&gt; {
  <span class="hljs-keyword">const</span> state = input.property.address.state;
  <span class="hljs-keyword">const</span> county = input.property.address.counties?.[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">const</span> underwriter = input.underwriter;
  <span class="hljs-keyword">const</span> includeStagingRates = input.includeStagingRates || <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">let</span> responseBody;

  <span class="hljs-keyword">const</span> shouldUseSSR = <span class="hljs-keyword">await</span> isTitleRates2Supported(
    underwriter,
    state,
    includeStagingRates
  );
  <span class="hljs-keyword">const</span> requestBlackBox = input?.requestBlackBox;
  <span class="hljs-keyword">const</span> shouldUseBlackBoxUndertakerRates = !!requestBlackBox;

  <span class="hljs-keyword">if</span> (shouldUseSSR) {
    <span class="hljs-keyword">const</span> rateTypes = <span class="hljs-keyword">await</span> getRateTypes({
      <span class="hljs-attr">uwName</span>: underwriter <span class="hljs-keyword">as</span> keyof <span class="hljs-keyword">typeof</span> underwriters,
      <span class="hljs-attr">policyIDs</span>: input.policyFormNames,
      includeStagingRates,
      <span class="hljs-attr">property</span>: {
        state,
        county,
        <span class="hljs-attr">is_residential</span>: !isCommercial(
          unmapPropertyType(
            input.property.propertyType ?? <span class="hljs-string">&#x27;RESIDENCE_ONE_TO_FOUR_FAMILIES&#x27;</span>
          )
        ),
        <span class="hljs-attr">is_commercial</span>: isCommercial(
          unmapPropertyType(
            input.property.propertyType ?? <span class="hljs-string">&#x27;RESIDENCE_ONE_TO_FOUR_FAMILIES&#x27;</span>
          )
        ),
        <span class="hljs-attr">ignore_land_use_type</span>: hasMultipleLandUseTypes(
          input.property.propertyType <span class="hljs-keyword">as</span> QualiaPropertyType
        ),
        <span class="hljs-attr">purpose</span>: input.property.purpose ?? <span class="hljs-string">&#x27;Purchase&#x27;</span>,
      },
      <span class="hljs-attr">rateEffectiveDate</span>: input.rateEffectiveDate,
      <span class="hljs-attr">extraRates</span>: input.secondaryApiParams?.extraRates || [],
    });

    responseBody = input.policyFormNames.map(<span class="hljs-function">(<span class="hljs-params">policyFormName, idx</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        policyFormName,
        <span class="hljs-attr">rateTypes</span>: <span class="hljs-built_in">Object</span>.entries(rateTypes[idx]).map(<span class="hljs-function">(<span class="hljs-params">[id, label]</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> { id, <span class="hljs-attr">label</span>: label <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span> };
        }),
      };
    });

    <span class="hljs-keyword">return</span> responseBody <span class="hljs-keyword">as</span> [RateTypesPayload];
  }

  <span class="hljs-comment">// Fall back to MTUT with black box request if it is present.</span>
  <span class="hljs-keyword">if</span> (shouldUseBlackBoxUndertakerRates) {
    <span class="hljs-keyword">const</span> undertakerResult = (<span class="hljs-keyword">await</span> makeRequest(
      <span class="hljs-string">&#x27;jacket/rateTypes&#x27;</span>,
      <span class="hljs-built_in">JSON</span>.parse(requestBlackBox),
      context
    )) <span class="hljs-keyword">as</span> [Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;];

    <span class="hljs-comment">// If Undertaker returns null, use this default result.</span>
    <span class="hljs-comment">// This works for single or simultaneous policies because</span>
    <span class="hljs-comment">// it resolves as null eventually in the core-side package.</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Update the core side package to handle `null` and</span>
    <span class="hljs-comment">// forward null as the result here.</span>
    <span class="hljs-keyword">const</span> DEFAULT_RESULT = [{}, {}];

    <span class="hljs-keyword">return</span> (undertakerResult || DEFAULT_RESULT).map(<span class="hljs-function">(<span class="hljs-params">rateTypes</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">responseBlackBox</span>: <span class="hljs-built_in">JSON</span>.stringify(rateTypes),
      };
    }) <span class="hljs-keyword">as</span> [RateTypesPayload];
  }

  <span class="hljs-comment">// Fall back to MTUT</span>
  <span class="hljs-keyword">const</span> requestBody = {
    <span class="hljs-attr">user</span>: input.secondaryApiParams?.user,
    <span class="hljs-attr">password</span>: input.secondaryApiParams?.password,
    <span class="hljs-attr">endpoint</span>: getEndpoint(underwriter),
    <span class="hljs-comment">// skip assure_url because Assure rate types are fetched above</span>
    <span class="hljs-attr">agentID</span>: input.secondaryApiParams?.agentID,
    <span class="hljs-attr">policyIDs</span>: input.policyFormNames.map(<span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> name.toLowerCase()),
    <span class="hljs-attr">otherPolicyTypes</span>: input.otherPolicyFormNames, <span class="hljs-comment">// Fidelity only</span>
    <span class="hljs-attr">property</span>: getUndertakerProperty(input),
    <span class="hljs-attr">underwriter_subsidiary</span>: getEndpoint(underwriter),
    <span class="hljs-attr">extended_coverage_status</span>: getUndertakerExtendedCoverageStatus(
      input.secondaryApiParams?.extendedCoverageStatusList || []
    ),
    <span class="hljs-attr">extraRates</span>: input.secondaryApiParams?.extraRates || [],
    <span class="hljs-attr">rate_effective_date</span>: input.rateEffectiveDate,
  };
  <span class="hljs-keyword">const</span> undertakerResult: [Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;] = (<span class="hljs-keyword">await</span> makeRequest(
    <span class="hljs-string">&#x27;jacket/rateTypes&#x27;</span>,
    requestBody,
    context
  )) <span class="hljs-keyword">as</span> [Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;];

  responseBody = input.policyFormNames.map(<span class="hljs-function">(<span class="hljs-params">policyFormName, idx</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> rateTypes =
      undertakerResult &amp;&amp; undertakerResult[idx]
        ? <span class="hljs-built_in">Object</span>.entries(undertakerResult[idx]).map(<span class="hljs-function">(<span class="hljs-params">[id, label]</span>) =&gt;</span> {
            <span class="hljs-keyword">return</span> { id, label };
          })
        : [];
    <span class="hljs-keyword">return</span> {
      policyFormName,
      rateTypes,
    };
  });

  <span class="hljs-keyword">return</span> responseBody <span class="hljs-keyword">as</span> [RateTypesPayload];
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> PolicyForSimplifiedCalculation = {
  <span class="hljs-attr">state</span>: StateType;
  county: <span class="hljs-built_in">string</span>;
  policyType: PolicyType;
  priorPolicyType: PolicyType;
  policyCategory: PolicyCategory;
  rateType: <span class="hljs-built_in">string</span>;
  priorRateType: <span class="hljs-built_in">string</span>;
  propertyType: PropertyType;
  insuranceAmount: <span class="hljs-built_in">number</span>;
  oldLoanAge: <span class="hljs-built_in">number</span>;
  oldLoanAmount: <span class="hljs-built_in">number</span>;
  crrOrders: <span class="hljs-built_in">number</span>;
  endorsements: EndorsementForSimplifiedCalculation[];
  transactionType: TransactionType;
  underwriterSplit: <span class="hljs-built_in">number</span>;
  effectiveDate: <span class="hljs-built_in">Date</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> EndorsementForSimplifiedCalculation = {
  <span class="hljs-attr">endorsementId</span>: <span class="hljs-built_in">string</span>;
  split: <span class="hljs-built_in">string</span>;
  isOverride: <span class="hljs-built_in">boolean</span>;
  overrideReason: <span class="hljs-built_in">string</span>;
  price: <span class="hljs-built_in">string</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPoliciesForCalculation</span>(<span class="hljs-params">
  input: RatesInput,
  policySplit: <span class="hljs-built_in">string</span>,
  endorsementSplit: <span class="hljs-built_in">string</span>
</span>): <span class="hljs-title">PolicyForSimplifiedCalculation</span>[] </span>{
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> both &#x27;alta loan&#x27; and &#x27;alta_loan&#x27; can come in, so we need to normalize</span>
  <span class="hljs-comment">// however &#x27;alta loan&#x27; is wrong and needs to be fixed in Core SDK</span>
  <span class="hljs-keyword">const</span> maybeNormalizePolicyType = (policyType: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">PolicyType</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> normalized = policyType || <span class="hljs-string">&#x27;alta loan&#x27;</span>;
    normalized = normalized.split(<span class="hljs-string">&#x27; &#x27;</span>).join(<span class="hljs-string">&#x27;_&#x27;</span>);
    normalized = normalized.toUpperCase();
    <span class="hljs-keyword">return</span> normalized <span class="hljs-keyword">as</span> PolicyType;
  };
  <span class="hljs-keyword">return</span> input.policies.map(<span class="hljs-function">(<span class="hljs-params">policy</span>) =&gt;</span> ({
    <span class="hljs-attr">state</span>: input.property.address.state,
    <span class="hljs-attr">county</span>: input.property.address.counties?.[<span class="hljs-number">0</span>] ?? <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">policyType</span>: maybeNormalizePolicyType(policy.policyFormName),
    <span class="hljs-attr">policyCategory</span>: policy.policyCategory,
    <span class="hljs-attr">rateType</span>: policy.rateType,
    <span class="hljs-attr">propertyType</span>: isCommercial(input.property.propertyType)
      ? <span class="hljs-string">&#x27;COMMERCIAL&#x27;</span>
      : <span class="hljs-string">&#x27;RESIDENTIAL&#x27;</span>,
    <span class="hljs-attr">insuranceAmount</span>: policy.coverageAmount / <span class="hljs-number">100</span>,
    <span class="hljs-attr">oldLoanAge</span>: policy.previousLoanAge ?? <span class="hljs-number">0</span>,
    <span class="hljs-attr">oldLoanAmount</span>: (policy.previousCoverageAmount ?? <span class="hljs-number">0</span>) / <span class="hljs-number">100</span>,
    <span class="hljs-attr">crrOrders</span>: policy.previousLoanAge ?? <span class="hljs-number">0</span>, <span class="hljs-comment">// qualia core reuses old_loan_age as crr_orders</span>
    <span class="hljs-attr">endorsements</span>: (policy?.endorsements || []).map(<span class="hljs-function">(<span class="hljs-params">endorsement</span>) =&gt;</span> ({
      <span class="hljs-attr">endorsementId</span>: endorsement.id,
      <span class="hljs-attr">split</span>: endorsementSplit,
      <span class="hljs-attr">isOverride</span>: endorsement.secondaryApiParams?.isOverride ?? <span class="hljs-literal">false</span>,
      <span class="hljs-attr">overrideReason</span>: endorsement.secondaryApiParams?.overrideReason ?? <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">price</span>: endorsement.secondaryApiParams?.price ?? <span class="hljs-string">&#x27;0&#x27;</span>,
    })),
    <span class="hljs-attr">transactionType</span>: input.purpose ?? <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
    <span class="hljs-attr">underwriterSplit</span>: (<span class="hljs-number">100</span> - <span class="hljs-built_in">parseFloat</span>(policySplit)) / <span class="hljs-number">100</span>,
    <span class="hljs-attr">priorPolicyType</span>: (
      policy.previousPolicyFormName ?? policy.policyFormName
    ).toUpperCase() <span class="hljs-keyword">as</span> PolicyType,
    <span class="hljs-attr">priorRateType</span>: policy.previousRateType ?? policy.rateType,
    <span class="hljs-attr">effectiveDate</span>: policy.rateEffectiveDate ?? <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
  }));
}

<span class="hljs-comment">// equivalent to calculateRates but removes Spreadsheet code</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> calculateSimplifiedRates = <span class="hljs-keyword">async</span> ({
  result,
  policies,
  policiesWithDBFields,
  <span class="hljs-attr">underwriter</span>: underwriter,
  effectiveDate,
  state,
}: {
  <span class="hljs-attr">result</span>: CalculateRatesResult;
  policies: PolicyForRates[];
  policiesWithDBFields: PolicyForSimplifiedCalculation[];
  underwriter: <span class="hljs-built_in">string</span>;
  effectiveDate: <span class="hljs-built_in">Date</span>;
  state: StateType;
}): <span class="hljs-built_in">Promise</span>&lt;CalculateRatesResult&gt; =&gt; {
  <span class="hljs-comment">// ========= new calculation that directly uses DB fields ==========</span>

  <span class="hljs-keyword">const</span> individualRates = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all(
    policies.map(<span class="hljs-keyword">async</span> (policy) =&gt; {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> calculateRates({
        <span class="hljs-attr">uwName</span>: underwriter <span class="hljs-keyword">as</span> keyof <span class="hljs-keyword">typeof</span> underwriters,
        state,
        <span class="hljs-attr">policies</span>: [policy],
        <span class="hljs-attr">includeStagingRates</span>: <span class="hljs-literal">false</span>,
      });
    })
  );

  <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> findRateManual(underwriter, state, effectiveDate);

  <span class="hljs-keyword">const</span> policiesForMatching = policiesWithDBFields;
  <span class="hljs-keyword">const</span> policyConfigs = (<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> ratesConfig = {
      ...parseDBRatesConfig([rateManual]),
    };
    <span class="hljs-keyword">const</span> fullPolicies = policies.map(<span class="hljs-function">(<span class="hljs-params">policy, i</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> isSimultaneous = policies.length === <span class="hljs-number">2</span>;
      <span class="hljs-keyword">return</span> {
        ...policy,
        <span class="hljs-attr">other_policy_type</span>: isSimultaneous
          ? policies[(i + <span class="hljs-number">1</span>) % policies.length].policy_type
          : <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">other_rate_type</span>: isSimultaneous
          ? policies[(i + <span class="hljs-number">1</span>) % policies.length].rate_type
          : <span class="hljs-literal">undefined</span>,
      };
    });
    <span class="hljs-keyword">return</span> fullPolicies.map(<span class="hljs-function">(<span class="hljs-params">policy</span>) =&gt;</span>
      matchPolicyConfig(policy, ratesConfig.policyConfigs)
    );
  })();
  <span class="hljs-keyword">const</span> simplifiedRates = calculateRatesWithRateManual(
    policiesForMatching,
    rateManual,
    <span class="hljs-comment">// params to help the migration</span>
    {
      policyConfigs, <span class="hljs-comment">// because we need policyConfig.premium_rounding in endorsement calculation</span>
      <span class="hljs-attr">rates</span>: result, <span class="hljs-comment">// because we need policy premiums, especially lender&#x27;s actual</span>
      individualRates, <span class="hljs-comment">// because we need individual policy premiums</span>
    }
  );
  <span class="hljs-comment">// verify the new calculation matches the old calculation</span>
  simplifiedRates.policies.map(<span class="hljs-function">(<span class="hljs-params">{ endorsement_rates }, i</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (
      <span class="hljs-built_in">JSON</span>.stringify(result.policies[i].endorsement_rates) !==
      <span class="hljs-built_in">JSON</span>.stringify(endorsement_rates)
    ) {
      <span class="hljs-built_in">console</span>.error(
        <span class="hljs-string">`============= endorsement_rates on policy <span class="hljs-subst">${i}</span> do not match =================`</span>
      );
      <span class="hljs-built_in">console</span>.log(result.policies[i].endorsement_rates);
      <span class="hljs-built_in">console</span>.log(endorsement_rates);
    }
  });
  <span class="hljs-keyword">return</span> simplifiedRates;
};

<span class="hljs-comment">// This function uses input data as if it were already present in the DB</span>
<span class="hljs-comment">// to calculate rates.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getConfigurationTestResult = <span class="hljs-keyword">async</span> (
  input: TestPolicyRateInput,
  <span class="hljs-attr">context</span>: Context
): <span class="hljs-built_in">Promise</span>&lt;TestRateConfigurationResponse&gt; =&gt; {
  <span class="hljs-keyword">const</span> testPolicyType = <span class="hljs-string">&#x27;alta owner&#x27;</span>;
  <span class="hljs-keyword">const</span> testPolicyCategory = <span class="hljs-string">&#x27;owner&#x27;</span>;
  <span class="hljs-keyword">const</span> testTransactionType = <span class="hljs-string">&#x27;purchase&#x27;</span>;
  <span class="hljs-keyword">const</span> testPropertyType = <span class="hljs-string">&#x27;residential&#x27;</span>;
  <span class="hljs-keyword">const</span> isReissue = input.formula === Formula.REISSUE;

  <span class="hljs-comment">// We do this because we currently search the rate type for the string &quot;reissue&quot;</span>
  <span class="hljs-keyword">const</span> testRateType = isReissue ? <span class="hljs-string">&#x27;reissue&#x27;</span> : <span class="hljs-string">&#x27;basic&#x27;</span>;

  <span class="hljs-keyword">const</span> { prisma, orgUser } = context;

  <span class="hljs-keyword">const</span> rateTablesQuery = [{ <span class="hljs-attr">id</span>: input.rateTableId }];

  <span class="hljs-keyword">if</span> (isReissue) {
    rateTablesQuery.push({ <span class="hljs-attr">id</span>: input.reissueRateTableId });
  }

  <span class="hljs-keyword">const</span> rateTables = <span class="hljs-keyword">await</span> prisma.rateTable.findMany({
    <span class="hljs-attr">where</span>: {
      <span class="hljs-attr">OR</span>: rateTablesQuery,
    },
  });

  <span class="hljs-keyword">const</span> rateTable = rateTables.find(
    <span class="hljs-function">(<span class="hljs-params">rateTable</span>) =&gt;</span> rateTable.id === input.rateTableId
  );

  <span class="hljs-keyword">if</span> (!rateTable) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Rate table not found.&#x27;</span>);
  }

  <span class="hljs-keyword">const</span> reissueRateTable = rateTables.find(
    <span class="hljs-function">(<span class="hljs-params">rateTable</span>) =&gt;</span> rateTable.id === input.reissueRateTableId
  );

  <span class="hljs-keyword">if</span> (isReissue &amp;&amp; !reissueRateTable) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Reissue rate table not found.&#x27;</span>);
  }

  <span class="hljs-keyword">const</span> DEFAULT_DISCOUNT = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">const</span> DEFAULT_NUMERIC_VALUE = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> DEFAULT_RANGE_VALUES: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] = [<span class="hljs-number">0</span>, <span class="hljs-literal">Infinity</span>];
  <span class="hljs-keyword">const</span> DEFAULT_RATE_TABLE_NAME = <span class="hljs-string">&#x27;N/A&#x27;</span>;
  <span class="hljs-keyword">const</span> DEFAULT_ROUNDING = <span class="hljs-string">&#x27;to_nearest_cent&#x27;</span>;

  <span class="hljs-keyword">const</span> policies: PolicyForRates[] = [
    {
      <span class="hljs-comment">// Input fields</span>
      <span class="hljs-attr">state</span>: input.state,
      <span class="hljs-attr">insurance_amount</span>: input.testCoverageAmount,
      <span class="hljs-attr">effective_date</span>: input.rateEffectiveDate,
      <span class="hljs-attr">old_loan_amount</span>: input.testOldLoanAmount,

      <span class="hljs-comment">// Default fields used for matching.</span>
      <span class="hljs-comment">// We&#x27;ll be using the same fields in the fake</span>
      <span class="hljs-comment">// policy rate config below.</span>
      <span class="hljs-attr">county</span>: <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">policy_type</span>: testPolicyType,
      <span class="hljs-attr">policy_category</span>: testPolicyCategory,
      <span class="hljs-attr">rate_type</span>: testRateType,
      <span class="hljs-attr">property_type</span>: testPropertyType,
      <span class="hljs-attr">endorsements</span>: [],
      <span class="hljs-attr">transaction_type</span>: testTransactionType,
      <span class="hljs-attr">underwriter_split</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">old_loan_age</span>: DEFAULT_NUMERIC_VALUE,
      <span class="hljs-attr">prior_rate_type</span>: testRateType,
      <span class="hljs-attr">prior_policy_type</span>: testPolicyType,
      <span class="hljs-attr">crr_orders</span>: DEFAULT_NUMERIC_VALUE,
    },
  ];

  <span class="hljs-keyword">const</span> rateManual: RateManual &amp; {
    <span class="hljs-attr">policyRates</span>: PolicyRate[];
    endorsementRates: EndorsementRate[];
    endorsementShortRates: EndorsementShortRate[];
    rateTables: RateTable[];
    cplRates: CplRate[];
  } = <span class="hljs-keyword">await</span> findRateManual(
    input.underwriter,
    input.state,
    input.rateEffectiveDate,
    [Status.PROD, Status.STAGING, Status.DRAFT]
  );

  <span class="hljs-keyword">const</span> formatRounding = (inputRounding: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>): <span class="hljs-function"><span class="hljs-params">RoundingType</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> formattedRounding = inputRounding;
    <span class="hljs-keyword">if</span> (formattedRounding === <span class="hljs-string">&#x27;NO_ROUNDING&#x27;</span>) {
      formattedRounding = <span class="hljs-string">&#x27;N/A&#x27;</span>;
    } <span class="hljs-keyword">else</span> {
      formattedRounding = formattedRounding?.toLowerCase() || DEFAULT_ROUNDING;
    }

    <span class="hljs-keyword">return</span> formattedRounding <span class="hljs-keyword">as</span> RoundingType;
  };

  <span class="hljs-keyword">const</span> ratesConfig: RatesConfig = {
    ...parseDBRatesConfig([rateManual]),
    <span class="hljs-comment">// substitute the DB policy configs with the input config that</span>
    <span class="hljs-comment">// we are testing.</span>
    <span class="hljs-attr">policyConfigs</span>: [
      {
        <span class="hljs-comment">// matching fields</span>
        <span class="hljs-attr">state</span>: input.state,
        <span class="hljs-attr">policy_type</span>: [testPolicyType],
        <span class="hljs-attr">rate_type</span>: [testRateType],
        <span class="hljs-attr">policy_category</span>: testPolicyCategory,
        <span class="hljs-attr">transaction_type</span>: [testTransactionType],
        <span class="hljs-attr">property_type</span>: [testPropertyType],
        <span class="hljs-attr">prior_policy_type</span>: [testPolicyType],
        <span class="hljs-attr">prior_rate_type</span>: [testRateType],
        <span class="hljs-attr">other_policy_type</span>: [],
        <span class="hljs-attr">other_rate_type</span>: [],
        <span class="hljs-attr">county</span>: [],

        <span class="hljs-comment">// inputs</span>
        <span class="hljs-attr">rate_table_discount</span>: input.rateTableDiscount ?? DEFAULT_DISCOUNT,
        <span class="hljs-attr">rate_type_discount</span>: input.rateTypeDiscount ?? DEFAULT_DISCOUNT,
        <span class="hljs-attr">policy_discount</span>: input.policyDiscount ?? DEFAULT_DISCOUNT,
        <span class="hljs-attr">reissue_discount</span>: input.reissueDiscount ?? DEFAULT_DISCOUNT,
        <span class="hljs-attr">simultaneous_premium_table_discount</span>: DEFAULT_DISCOUNT,
        <span class="hljs-attr">simultaneous_base_premium_discount</span>: DEFAULT_DISCOUNT,

        <span class="hljs-attr">policy_amount_minimum</span>: input.policyAmountMin ?? DEFAULT_NUMERIC_VALUE,
        <span class="hljs-attr">additional_fee_amount</span>:
          input.additionalFeeAmount ?? DEFAULT_NUMERIC_VALUE,
        <span class="hljs-attr">simultaneous_premium</span>:
          input.simultaneousPremium ?? DEFAULT_NUMERIC_VALUE,
        <span class="hljs-attr">min_premium</span>: input.minPremium ?? DEFAULT_NUMERIC_VALUE,

        <span class="hljs-attr">reissue_min_premium</span>: input.reissueMinPremium ?? DEFAULT_NUMERIC_VALUE,

        <span class="hljs-attr">insurance_amount_range</span>: input.insuranceAmountRange
          ? [
              input.insuranceAmountRange[<span class="hljs-number">0</span>],
              input.insuranceAmountRange[<span class="hljs-number">1</span>] === -<span class="hljs-number">1</span>
                ? <span class="hljs-literal">Infinity</span>
                : input.insuranceAmountRange[<span class="hljs-number">1</span>],
            ]
          : DEFAULT_RANGE_VALUES,
        <span class="hljs-attr">old_loan_age_range</span>: input.oldLoanAgeRange
          ? [
              input.oldLoanAgeRange[<span class="hljs-number">0</span>],
              input.oldLoanAgeRange[<span class="hljs-number">1</span>] === -<span class="hljs-number">1</span>
                ? <span class="hljs-literal">Infinity</span>
                : input.oldLoanAgeRange[<span class="hljs-number">1</span>],
            ]
          : DEFAULT_RANGE_VALUES,

        <span class="hljs-attr">premium_rounding</span>: formatRounding(input.premiumRounding),
        <span class="hljs-attr">discount_rounding</span>: formatRounding(input.discountRounding),

        <span class="hljs-attr">rate_table_name</span>: rateTable.name,
        <span class="hljs-attr">reissue_rate_table_name</span>: reissueRateTable
          ? reissueRateTable.name
          : DEFAULT_RATE_TABLE_NAME,

        <span class="hljs-attr">use_lender_actual_as_disclosed</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">aggressive_rounding</span>: <span class="hljs-literal">false</span>,

        <span class="hljs-attr">effective_date</span>: input.rateEffectiveDate,

        <span class="hljs-comment">// Note: These aren&#x27;t supported in the front end,</span>
        <span class="hljs-comment">// so we give them defaults to satisfy the RatesConfig type</span>
        <span class="hljs-attr">excess_discount</span>: DEFAULT_DISCOUNT,
        <span class="hljs-comment">// Discount set to 0 instead of 1 here because this discount is applied to the</span>
        <span class="hljs-comment">// base premium, and by default we don&#x27;t want any additional fee.</span>
        <span class="hljs-attr">additional_fee_discount</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">simultaneous_premium_table</span>: DEFAULT_RATE_TABLE_NAME,
        <span class="hljs-attr">crr_orders_range</span>: DEFAULT_RANGE_VALUES,
      },
    ],
  };

  <span class="hljs-comment">// Decided not to use calcPolicyRates because that isn&#x27;t exported.</span>
  <span class="hljs-comment">// calculateRatesInternal is closer to the public endpoint.</span>
  <span class="hljs-keyword">const</span> rates: { <span class="hljs-attr">policies</span>: RateResult[] } = calculateRatesInternal(
    policies,
    ratesConfig
  );

  <span class="hljs-keyword">return</span> { <span class="hljs-attr">totalPremium</span>: rates.policies[<span class="hljs-number">0</span>].trid <span class="hljs-keyword">as</span> Money };
};

</code></pre>
<h4 id=/resolvers/index.ts anchor=true>/resolvers/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { resolvers <span class="hljs-keyword">as</span> queryResolvers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./queries&#x27;</span>;
<span class="hljs-keyword">import</span> { resolvers <span class="hljs-keyword">as</span> mutationResolvers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./mutations&#x27;</span>;

<span class="hljs-comment">/**
 * NOTE - we have a number of resolvers that are automatically generated in
 * /src/gql/generated, but are not using them currently since we do not see
 * a way to inject custom authorization/validation code into them.
 * **/</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> resolvers = [...queryResolvers, ...mutationResolvers] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

</code></pre>
<h4 id=/resolvers/mutations/__tests__/cplRate.test.ts anchor=true>/resolvers/mutations/<strong>tests</strong>/cplRate.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> faker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@faker-js/faker&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;

<span class="hljs-keyword">const</span> devUnderwriterName = <span class="hljs-string">&#x27;Qualia Dev UW&#x27;</span>;
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

describe(<span class="hljs-string">&#x27;Graph / Mutation / UpdateCPLRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  it(<span class="hljs-string">&#x27;can update flat rate&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> UPDATE_MUTATION = gql<span class="hljs-string">`
      mutation UpdateCPLRate($input: UpdateCPLRateInput!) {
        updateCPLRate(input: $input) {
          status
        }
      }
    `</span>;
    <span class="hljs-keyword">const</span> exampleRateManualWithCPL = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
      },
      <span class="hljs-attr">include</span>: { <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span> },
    });
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> newFlatRate = <span class="hljs-built_in">Number</span>(faker.random.numeric(<span class="hljs-number">3</span>));
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${exampleRateManualWithCPL?.cplRates[<span class="hljs-number">0</span>]?.id}</span>`</span>,
        <span class="hljs-attr">protectedParty</span>: <span class="hljs-string">`<span class="hljs-subst">${exampleRateManualWithCPL?.cplRates[<span class="hljs-number">0</span>]?.protectedParty}</span>`</span>,
        <span class="hljs-attr">flatRate</span>: newFlatRate,
      },
    };
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: UPDATE_MUTATION,
        variables,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.updateCPLRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.cplRate.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: exampleRateManualWithCPL?.cplRates[<span class="hljs-number">0</span>]?.id },
    });
    expect(updatedRate?.flatRate).toEqual(newFlatRate);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / CreateCPLRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.cplRate.deleteMany({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: tmpRateManual.id },
      });
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can create a new CPL rate with unique protected party&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> CREATE_MUTATION = gql<span class="hljs-string">`
      mutation CreateCPLRate($input: CreateCPLRateInput!) {
        createCPLRate(input: $input) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables1 = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">rateManualId</span>: <span class="hljs-string">`<span class="hljs-subst">${tmpRateManual.id}</span>`</span>,
        <span class="hljs-attr">protectedParty</span>: <span class="hljs-string">&#x27;BUYER&#x27;</span>,
        <span class="hljs-attr">flatRate</span>: <span class="hljs-number">0</span>,
      },
    };
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.createCPLRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    <span class="hljs-comment">// Create a new CPL rate with the same protected party fails</span>
    <span class="hljs-comment">// with &#x27;Unique constraint failed&#x27;</span>
    <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    expect(result2.errors).toHaveLength(<span class="hljs-number">1</span>); <span class="hljs-comment">// Unique constraint failed</span>
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / DeleteCPLRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpCPLRate: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
    tmpCPLRate = <span class="hljs-keyword">await</span> prisma.cplRate.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">protectedParty</span>: <span class="hljs-string">&#x27;BUYER&#x27;</span>,
        <span class="hljs-attr">flatRate</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">rateManualId</span>: tmpRateManual.id,
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.cplRate.deleteMany({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: tmpRateManual.id },
      });
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can remove a CPL rate&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> REMOVE_MUTATION = gql<span class="hljs-string">`
      mutation RemoveCPLRate {
        removeCPLRate(id: &quot;<span class="hljs-subst">${tmpCPLRate.id}</span>&quot;) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: REMOVE_MUTATION,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.removeCPLRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    expect(
      <span class="hljs-keyword">await</span> prisma.cplRate.findFirst({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpCPLRate.id } })
    ).toBeNull();
  });
});

</code></pre>
<h4 id=/resolvers/mutations/__tests__/endorsementRate.test.ts anchor=true>/resolvers/mutations/<strong>tests</strong>/endorsementRate.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;

<span class="hljs-keyword">const</span> devUnderwriterName = <span class="hljs-string">&#x27;Qualia Dev UW&#x27;</span>;
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

describe(<span class="hljs-string">&#x27;Graph / Mutation / UpdateEndorsementRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  it(<span class="hljs-string">&#x27;can update an endorsement rate&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> UPDATE_MUTATION = gql<span class="hljs-string">`
      mutation UpdateEndorsementRate($input: UpdateEndorsementRateInput!) {
        updateEndorsementRate(input: $input) {
          status
        }
      }
    `</span>;
    <span class="hljs-keyword">const</span> exampleRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
      },
      <span class="hljs-attr">include</span>: { <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span> },
    });
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${exampleRateManual?.endorsementRates[<span class="hljs-number">0</span>]?.id}</span>`</span>,
        <span class="hljs-attr">ownerFlatRate</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">lenderFlatRate</span>: <span class="hljs-number">120</span>,
      },
    };
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: UPDATE_MUTATION,
        variables,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.updateEndorsementRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.endorsementRate.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: exampleRateManual?.endorsementRates[<span class="hljs-number">0</span>]?.id },
    });
    expect(updatedRate?.ownerFlatRate).toEqual(<span class="hljs-number">100</span>);
    expect(updatedRate?.lenderFlatRate).toEqual(<span class="hljs-number">120</span>);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / CreateEndorsementRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can create a new endorsement rate with basic fields&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> CREATE_MUTATION = gql<span class="hljs-string">`
      mutation CreateEndorsementRate($input: CreateEndorsementRateInput!) {
        createEndorsementRate(input: $input) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables1 = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">rateManualId</span>: <span class="hljs-string">`<span class="hljs-subst">${tmpRateManual.id}</span>`</span>,
        <span class="hljs-attr">endorsementId</span>: <span class="hljs-string">&#x27;ALTA 1000&#x27;</span>,
        <span class="hljs-attr">ownerFlatRate</span>: <span class="hljs-number">40</span>,
        <span class="hljs-attr">lenderFlatRate</span>: <span class="hljs-number">50</span>,
      },
    };
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.createEndorsementRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.endorsementRate.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">endorsementId</span>: <span class="hljs-string">&#x27;ALTA 1000&#x27;</span> },
    });
    expect(updatedRate?.ownerFlatRate).toEqual(<span class="hljs-number">40</span>);
    expect(updatedRate?.lenderFlatRate).toEqual(<span class="hljs-number">50</span>);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / DeleteEndorsementRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpRate: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
    tmpRate = <span class="hljs-keyword">await</span> prisma.endorsementRate.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">endorsementId</span>: <span class="hljs-string">&#x27;ALTA 1000&#x27;</span>,
        <span class="hljs-attr">ownerFlatRate</span>: <span class="hljs-number">40</span>,
        <span class="hljs-attr">lenderFlatRate</span>: <span class="hljs-number">50</span>,
        <span class="hljs-attr">rateManualId</span>: tmpRateManual.id,
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.endorsementRate.deleteMany({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: tmpRateManual.id },
      });
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can remove an endorsement rate&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> REMOVE_MUTATION = gql<span class="hljs-string">`
      mutation RemoveEndorsementRate {
        removeEndorsementRate(id: &quot;<span class="hljs-subst">${tmpRate.id}</span>&quot;) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: REMOVE_MUTATION,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.removeEndorsementRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    expect(
      <span class="hljs-keyword">await</span> prisma.endorsementRate.findFirst({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRate.id } })
    ).toBeNull();
  });
});

</code></pre>
<h4 id=/resolvers/mutations/__tests__/policyRate.test.ts anchor=true>/resolvers/mutations/<strong>tests</strong>/policyRate.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;

<span class="hljs-keyword">const</span> devUnderwriterName = <span class="hljs-string">&#x27;Qualia Dev UW&#x27;</span>;
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

describe(<span class="hljs-string">&#x27;Graph / Mutation / UpdatePolicyRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  it(<span class="hljs-string">&#x27;can update a policy rates rate type&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> UPDATE_MUTATION = gql<span class="hljs-string">`
      mutation UpdatePolicyRate($input: UpdatePolicyRateInput!) {
        updatePolicyRate(input: $input) {
          status
        }
      }
    `</span>;
    <span class="hljs-keyword">const</span> exampleRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
      },
      <span class="hljs-attr">include</span>: { <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span> },
    });
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${exampleRateManual?.policyRates[<span class="hljs-number">0</span>]?.id}</span>`</span>,
        <span class="hljs-attr">rateType</span>: [<span class="hljs-string">&#x27;test rate type&#x27;</span>],
      },
    };
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: UPDATE_MUTATION,
        variables,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.updatePolicyRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.policyRate.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: exampleRateManual?.policyRates[<span class="hljs-number">0</span>]?.id },
    });
    expect(updatedRate?.rateType).toEqual([<span class="hljs-string">&#x27;test rate type&#x27;</span>]);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / CreatePolicyRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can create a new policy rate with basic fields&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> CREATE_MUTATION = gql<span class="hljs-string">`
      mutation CreatePolicyRate($input: CreatePolicyRateInput!) {
        createPolicyRate(input: $input) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables1 = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">rateManualId</span>: <span class="hljs-string">`<span class="hljs-subst">${tmpRateManual.id}</span>`</span>,
        <span class="hljs-attr">rateType</span>: [<span class="hljs-string">&#x27;test rate type&#x27;</span>],
        <span class="hljs-attr">policyType</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">policyCategory</span>: <span class="hljs-string">&#x27;LENDER&#x27;</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test policy rate&#x27;</span>,
      },
    };
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.createPolicyRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.policyRate.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">rateManualId</span>: tmpRateManual.id,
      },
    });
    expect(updatedRate?.policyType).toEqual([<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>]);
    expect(updatedRate?.policyCategory).toEqual(<span class="hljs-string">&#x27;LENDER&#x27;</span>);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / DeletePolicyRate&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpRate: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
    tmpRate = <span class="hljs-keyword">await</span> prisma.policyRate.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">rateType</span>: [<span class="hljs-string">&#x27;test rate type&#x27;</span>],
        <span class="hljs-attr">policyType</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">policyCategory</span>: <span class="hljs-string">&#x27;LENDER&#x27;</span>,
        <span class="hljs-attr">rateManualId</span>: tmpRateManual.id,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test policy rate&#x27;</span>,
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.policyRate.deleteMany({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: tmpRateManual.id },
      });
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can remove a policy rate&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> REMOVE_MUTATION = gql<span class="hljs-string">`
      mutation RemovePolicyRate {
        removePolicyRate(id: &quot;<span class="hljs-subst">${tmpRate.id}</span>&quot;) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: REMOVE_MUTATION,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.removePolicyRate.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    expect(
      <span class="hljs-keyword">await</span> prisma.policyRate.findFirst({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRate.id } })
    ).toBeNull();
  });
});

</code></pre>
<h4 id=/resolvers/mutations/__tests__/rateManual.test.ts anchor=true>/resolvers/mutations/<strong>tests</strong>/rateManual.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> faker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@faker-js/faker&#x27;</span>;
<span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;

jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

<span class="hljs-keyword">const</span> testUnderwriterName = <span class="hljs-string">&#x27;Qualia Dev UW&#x27;</span>;
<span class="hljs-keyword">const</span> testState = <span class="hljs-string">&#x27;OK&#x27;</span>;
<span class="hljs-keyword">const</span> testEffectiveDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2023-01-27&#x27;</span>);

describe(<span class="hljs-string">&#x27;Graph / Mutation / UpdateRateManualMeta&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: testState,
        <span class="hljs-attr">effectiveDate</span>: testEffectiveDate,
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: testUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can update rate manual meta&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> UPDATE_MUTATION = gql<span class="hljs-string">`
      mutation UpdateRateManualMeta($input: UpdateRateManualMetaInput!) {
        updateRateManualMeta(input: $input) {
          status
        }
      }
    `</span>;
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${tmpRateManual?.id}</span>`</span>,
        <span class="hljs-attr">underwriter</span>: testUnderwriterName,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;2033-01-27&#x27;</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;PROD&#x27;</span>,
      },
    };
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: UPDATE_MUTATION,
        variables,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.updateRateManualMeta.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual?.id },
    });
    expect(updatedRateManual?.status).toEqual(<span class="hljs-string">&#x27;PROD&#x27;</span>);
    expect(updatedRateManual?.effectiveDate).toEqual(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2033-01-27&#x27;</span>));
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / CreateRateManual&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: testState,
        <span class="hljs-attr">effectiveDate</span>: testEffectiveDate,
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: testUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
    <span class="hljs-keyword">await</span> prisma.rateManual.deleteMany({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: testUnderwriterName },
        <span class="hljs-attr">state</span>: testState,
      },
    });
  });

  it(<span class="hljs-string">&#x27;can create a new rate manual with only meta data&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> CREATE_MUTATION = gql<span class="hljs-string">`
      mutation CreateRateManual($input: CreateRateManualInput!) {
        createRateManual(input: $input) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables1 = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">state</span>: testState,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;2033-01-27&#x27;</span>, <span class="hljs-comment">// an obvious future date</span>
        <span class="hljs-attr">underwriter</span>: testUnderwriterName,
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
      },
    };
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.createRateManual.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> newRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: testUnderwriterName },
        <span class="hljs-attr">state</span>: testState,
      },
      <span class="hljs-attr">orderBy</span>: { <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span> },
      <span class="hljs-attr">select</span>: {
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
      },
    });
    expect(newRateManual?.effectiveDate).toEqual(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2033-01-27&#x27;</span>));
    expect(newRateManual?.status).toEqual(<span class="hljs-string">&#x27;DRAFT&#x27;</span>);
    expect(newRateManual?.policyRates.length).toEqual(<span class="hljs-number">0</span>);
    expect(newRateManual?.endorsementRates.length).toEqual(<span class="hljs-number">0</span>);
    expect(newRateManual?.rateTables.length).toEqual(<span class="hljs-number">0</span>);

    <span class="hljs-comment">// Creating a new rate manual with the same state-underwriter-effectiveDate combo fails</span>
    <span class="hljs-comment">// with &#x27;Unique constraint failed&#x27;</span>
    <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    expect(result2.errors).toHaveLength(<span class="hljs-number">1</span>); <span class="hljs-comment">// Unique constraint failed</span>
  });

  it(<span class="hljs-string">&#x27;can create a new rate manual with meta data and latest rates (e.g. latest AmTrust AK rates)&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> latestRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;AK&#x27;</span>,
      },
      <span class="hljs-attr">orderBy</span>: { <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span> },
      <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
      },
    });
    <span class="hljs-keyword">const</span> allRateManuals = <span class="hljs-keyword">await</span> prisma.rateManual.findMany({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;AK&#x27;</span>,
      },
      <span class="hljs-attr">orderBy</span>: { <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span> },
      <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
      },
    });

    <span class="hljs-keyword">const</span> CREATE_MUTATION = gql<span class="hljs-string">`
      mutation CreateRateManual($input: CreateRateManualInput!) {
        createRateManual(input: $input) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables1 = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;AK&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;2033-01-27&#x27;</span>, <span class="hljs-comment">// an obvious future date</span>
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">copyLatest</span>: <span class="hljs-literal">true</span>,
      },
    };
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.createRateManual.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    <span class="hljs-keyword">const</span> allAfterRateManuals = <span class="hljs-keyword">await</span> prisma.rateManual.findMany({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;AK&#x27;</span>,
      },
      <span class="hljs-attr">orderBy</span>: { <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span> },
      <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
      },
    });
    expect(allAfterRateManuals.length - allRateManuals.length).toBe(<span class="hljs-number">1</span>);
    expect(allAfterRateManuals[<span class="hljs-number">0</span>].policyRates.length).toBe(
      latestRateManual?.policyRates.length
    );
    expect(allAfterRateManuals[<span class="hljs-number">0</span>].endorsementRates.length).toBe(
      latestRateManual?.endorsementRates.length
    );
    expect(allAfterRateManuals[<span class="hljs-number">0</span>].rateTables.length).toBe(
      latestRateManual?.rateTables.length
    );
    expect(
      allAfterRateManuals[<span class="hljs-number">0</span>].policyRates.map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span>
        _.omit(r, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;rateManualId&#x27;</span>])
      )
    ).toEqual(
      latestRateManual?.policyRates.map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span>
        _.omit(r, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;rateManualId&#x27;</span>])
      )
    );
    expect(
      allAfterRateManuals[<span class="hljs-number">0</span>].endorsementRates.map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span>
        _.omit(r, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;rateManualId&#x27;</span>])
      )
    ).toEqual(
      latestRateManual?.endorsementRates.map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span>
        _.omit(r, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;rateManualId&#x27;</span>])
      )
    );
    expect(
      allAfterRateManuals[<span class="hljs-number">0</span>].rateTables.map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span>
        _.omit(r, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;rateManualId&#x27;</span>])
      )
    ).toEqual(
      latestRateManual?.rateTables.map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> _.omit(r, [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;rateManualId&#x27;</span>]))
    );
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / DeleteRateManual&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: testState,
        <span class="hljs-attr">effectiveDate</span>: testEffectiveDate,
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: testUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (
      <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id } })
    ) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can remove a rate manual&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> REMOVE_MUTATION = gql<span class="hljs-string">`
      mutation RemoveRateManual {
        removeRateManual(id: &quot;<span class="hljs-subst">${tmpRateManual?.id}</span>&quot;) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: REMOVE_MUTATION,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.removeRateManual.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    expect(
      <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id } })
    ).toBeNull();
  });
});

</code></pre>
<h4 id=/resolvers/mutations/__tests__/rateTable.test.ts anchor=true>/resolvers/mutations/<strong>tests</strong>/rateTable.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;

<span class="hljs-keyword">const</span> devUnderwriterName = <span class="hljs-string">&#x27;Qualia Dev UW&#x27;</span>;
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

describe(<span class="hljs-string">&#x27;Graph / Mutation / UpdateRateTable&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  it(<span class="hljs-string">&#x27;can update a rate table&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> UPDATE_MUTATION = gql<span class="hljs-string">`
      mutation UpdateRateTable($input: UpdateRateTableInput!) {
        updateRateTable(input: $input) {
          status
        }
      }
    `</span>;
    <span class="hljs-keyword">const</span> exampleRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
      },
      <span class="hljs-attr">include</span>: { <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span> },
    });
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${exampleRateManual?.rateTables[<span class="hljs-number">0</span>]?.id}</span>`</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASIC_TEST&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">100</span>,
          },
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">200</span>,
          },
        ],
      },
    };
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: UPDATE_MUTATION,
        variables,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.updateRateTable.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.rateTable.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: exampleRateManual?.rateTables[<span class="hljs-number">0</span>]?.id },
    });
    expect(updatedRate?.name).toEqual(<span class="hljs-string">&#x27;BASIC_TEST&#x27;</span>);
    expect(
      updatedRate?.tiers.map(
        <span class="hljs-function">(<span class="hljs-params">{
          baseTableDiscount,
          flatRate,
          lowerBound,
          upperBound,
          perAmount,
          ratePerAmount,
          tierType,
        }</span>) =&gt;</span> ({
          baseTableDiscount,
          flatRate,
          lowerBound,
          upperBound,
          perAmount,
          ratePerAmount,
          tierType,
        })
      )
    ).toEqual([
      {
        <span class="hljs-attr">baseTableDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">upperBound</span>: <span class="hljs-number">100000</span>,
        <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
        <span class="hljs-attr">flatRate</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">perAmount</span>: <span class="hljs-number">1000</span>,
        <span class="hljs-attr">ratePerAmount</span>: <span class="hljs-number">0</span>,
      },
      {
        <span class="hljs-attr">baseTableDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">100000</span>,
        <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
        <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
        <span class="hljs-attr">flatRate</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">perAmount</span>: <span class="hljs-number">1000</span>,
        <span class="hljs-attr">ratePerAmount</span>: <span class="hljs-number">0</span>,
      },
    ]);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / CreateRateTable&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can create a new rate table&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> CREATE_MUTATION = gql<span class="hljs-string">`
      mutation CreateRateTable($input: CreateRateTableInput!) {
        createRateTable(input: $input) {
          id
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables1 = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">rateManualId</span>: <span class="hljs-string">`<span class="hljs-subst">${tmpRateManual.id}</span>`</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASIC_TEST_NEW&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">100</span>,
          },
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">200</span>,
          },
        ],
      },
    };
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: CREATE_MUTATION,
        <span class="hljs-attr">variables</span>: variables1,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.createRateTable.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);
    expect(result1.data.createRateTable.id).toBeDefined();
    <span class="hljs-keyword">const</span> updatedRate = <span class="hljs-keyword">await</span> prisma.rateTable.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASIC_TEST_NEW&#x27;</span> },
    });
    expect(
      updatedRate?.tiers.map(
        <span class="hljs-function">(<span class="hljs-params">{
          baseTableDiscount,
          flatRate,
          lowerBound,
          upperBound,
          perAmount,
          ratePerAmount,
          tierType,
        }</span>) =&gt;</span> ({
          baseTableDiscount,
          flatRate,
          lowerBound,
          upperBound,
          perAmount,
          ratePerAmount,
          tierType,
        })
      )
    ).toEqual([
      {
        <span class="hljs-attr">baseTableDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">upperBound</span>: <span class="hljs-number">100000</span>,
        <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
        <span class="hljs-attr">flatRate</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">perAmount</span>: <span class="hljs-number">1000</span>,
        <span class="hljs-attr">ratePerAmount</span>: <span class="hljs-number">0</span>,
      },
      {
        <span class="hljs-attr">baseTableDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">100000</span>,
        <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
        <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
        <span class="hljs-attr">flatRate</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">perAmount</span>: <span class="hljs-number">1000</span>,
        <span class="hljs-attr">ratePerAmount</span>: <span class="hljs-number">0</span>,
      },
    ]);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Mutation / DeleteRateTable&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpRate: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
    tmpRate = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASIC_TEST&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">100</span>,
          },
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">200</span>,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManual.id,
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual) {
      <span class="hljs-keyword">await</span> prisma.rateTable.deleteMany({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: tmpRateManual.id },
      });
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can remove a rate table&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> REMOVE_MUTATION = gql<span class="hljs-string">`
      mutation RemoveRateTable {
        removeRateTable(id: &quot;<span class="hljs-subst">${tmpRate.id}</span>&quot;) {
          status
        }
      }
    `</span>;

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: REMOVE_MUTATION,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_WRITE_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );
    <span class="hljs-keyword">if</span> (!result1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result1.data.removeRateTable.status).toEqual(<span class="hljs-string">&#x27;ok&#x27;</span>);

    expect(
      <span class="hljs-keyword">await</span> prisma.rateTable.findFirst({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRate.id } })
    ).toBeNull();
  });
});

</code></pre>
<h4 id=/resolvers/mutations/cplRate.ts anchor=true>/resolvers/mutations/cplRate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Mutation, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> {
  UpdateCPLRateInput,
  CreateCPLRateInput,
  MutateCPLRateResponse,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { RatesNotFoundError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../errors&#x27;</span>;
<span class="hljs-keyword">import</span> { writeRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;

<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CPLRateMutation</span> </span>{
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= UPDATE CPL RATE ================</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateCPLRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;update CPL rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> updateCPLRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: UpdateCPLRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateCPLRateResponse&gt; {
    <span class="hljs-keyword">const</span> { id, protectedParty, rateSource, flatRate, rateTableId } = input;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> cplRate = <span class="hljs-keyword">await</span> prisma.cplRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!cplRate) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.cplRate.update({
      <span class="hljs-attr">where</span>: { id },
      <span class="hljs-attr">data</span>: {
        ...(flatRate !== <span class="hljs-literal">null</span> ? { flatRate } : {}),
        ...(rateTableId !== <span class="hljs-literal">null</span> ? { rateTableId } : {}),
        protectedParty,
        rateSource,
      },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= CREATE CPL RATE ================</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateCPLRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;create a new CPL rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> createCPLRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: CreateCPLRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateCPLRateResponse&gt; {
    <span class="hljs-keyword">const</span> { rateManualId, protectedParty, rateSource, flatRate, rateTableId } =
      input;

    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: rateManualId, <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }

    <span class="hljs-keyword">await</span> prisma.cplRate.create({
      <span class="hljs-attr">data</span>: {
        protectedParty,
        ...(flatRate !== <span class="hljs-literal">null</span> ? { flatRate } : {}),
        ...(rateTableId !== <span class="hljs-literal">null</span> ? { rateTableId } : {}),
        rateManualId,
        rateSource,
      },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= REMOVE CPL RATE =============</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateCPLRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Remove a CPL Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> removeCPLRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateCPLRateResponse&gt; {
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> cplRate = <span class="hljs-keyword">await</span> prisma.cplRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!cplRate) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.cplRate.delete({ <span class="hljs-attr">where</span>: { id } });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }
}

</code></pre>
<h4 id=/resolvers/mutations/endorsementRate.ts anchor=true>/resolvers/mutations/endorsementRate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Mutation, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;

<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { RatesNotFoundError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../errors&#x27;</span>;
<span class="hljs-keyword">import</span> {
  UpdateEndorsementRateInput,
  CreateEndorsementRateInput,
  MutateEndorsementRateResponse,
  UpdateEndorsementShortRateInput,
  CreateEndorsementShortRateInput,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { writeRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;

<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EndorsementRateMutation</span> </span>{
  <span class="hljs-comment">// ===================================================</span>
  <span class="hljs-comment">// ============= UPDATE ENDORSEMENT RATE =============</span>
  <span class="hljs-comment">// ===================================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateEndorsementRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Update an Endorsement Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> updateEndorsementRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: UpdateEndorsementRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateEndorsementRateResponse&gt; {
    <span class="hljs-keyword">const</span> { id, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.endorsementRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.endorsementRate.update({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: id },
      <span class="hljs-attr">data</span>: inputWithoutRateManualIdAndId,
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateEndorsementRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Update an Endorsement Short Rates&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> updateEndorsementShortRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: UpdateEndorsementShortRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateEndorsementRateResponse&gt; {
    <span class="hljs-keyword">const</span> { id, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.endorsementShortRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.endorsementShortRate.update({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: id },
      <span class="hljs-attr">data</span>: inputWithoutRateManualIdAndId,
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ===================================================</span>
  <span class="hljs-comment">// ============= CREATE ENDORSEMENT RATE =============</span>
  <span class="hljs-comment">// ===================================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateEndorsementRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Create an Endorsement Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> createEndorsementRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: CreateEndorsementRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateEndorsementRateResponse&gt; {
    <span class="hljs-keyword">const</span> { rateManualId, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: rateManualId, <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.endorsementRate.create({
      <span class="hljs-attr">data</span>: { rateManualId, ...inputWithoutRateManualIdAndId },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateEndorsementRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Create an Endorsement Short Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> createEndorsementShortRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: CreateEndorsementShortRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateEndorsementRateResponse&gt; {
    <span class="hljs-keyword">const</span> { rateManualId, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: rateManualId, <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.endorsementShortRate.create({
      <span class="hljs-attr">data</span>: { rateManualId, ...inputWithoutRateManualIdAndId },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ===================================================</span>
  <span class="hljs-comment">// ============= REMOVE ENDORSEMENT RATE =============</span>
  <span class="hljs-comment">// ===================================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateEndorsementRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Remove an Endorsement Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> removeEndorsementRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateEndorsementRateResponse&gt; {
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> endorsementRate = <span class="hljs-keyword">await</span> prisma.endorsementRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!endorsementRate) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.endorsementRate.delete({ <span class="hljs-attr">where</span>: { id } });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateEndorsementRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Remove an Endorsement Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> removeEndorsementShortRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateEndorsementRateResponse&gt; {
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> endorsementRate = <span class="hljs-keyword">await</span> prisma.endorsementShortRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!endorsementRate) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.endorsementShortRate.delete({ <span class="hljs-attr">where</span>: { id } });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }
}

</code></pre>
<h4 id=/resolvers/mutations/index.ts anchor=true>/resolvers/mutations/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { CPLRateMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./cplRate&#x27;</span>;
<span class="hljs-keyword">import</span> { RateManualMetaMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rateManualMeta&#x27;</span>;
<span class="hljs-keyword">import</span> { PolicyRateMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./policyRate&#x27;</span>;
<span class="hljs-keyword">import</span> { EndorsementRateMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./endorsementRate&#x27;</span>;
<span class="hljs-keyword">import</span> { RateTableMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rateTable&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> resolvers = [
  CPLRateMutation,
  RateManualMetaMutation,
  PolicyRateMutation,
  EndorsementRateMutation,
  RateTableMutation,
] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

</code></pre>
<h4 id=/resolvers/mutations/policyRate.ts anchor=true>/resolvers/mutations/policyRate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Mutation, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;

<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { RatesNotFoundError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../errors&#x27;</span>;
<span class="hljs-keyword">import</span> {
  UpdatePolicyRateInput,
  CreatePolicyRateInput,
  MutatePolicyRateResponse,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { writeRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;
<span class="hljs-keyword">import</span> { Formula } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/title-rates/prisma&#x27;</span>;
<span class="hljs-keyword">import</span> { Prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PolicyRateMutation</span> </span>{
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= UPDATE POLICY RATE =============</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutatePolicyRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Update a Policy Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> updatePolicyRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: UpdatePolicyRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutatePolicyRateResponse&gt; {
    <span class="hljs-keyword">const</span> { id, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.policyRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }

    <span class="hljs-keyword">let</span> data: Prisma.PolicyRateUncheckedUpdateInput;

    <span class="hljs-keyword">if</span> (inputWithoutRateManualIdAndId.formula !== Formula.REISSUE) {
      <span class="hljs-comment">// Reset reissue-related fields if the submitted policy rate</span>
      <span class="hljs-comment">// is not a reissue rate.</span>
      data = {
        ...inputWithoutRateManualIdAndId,
        <span class="hljs-attr">reissueDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">reissueMinPremium</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">reissueRateTableId</span>: {
          <span class="hljs-attr">unset</span>: <span class="hljs-literal">true</span>,
        },
      };
    } <span class="hljs-keyword">else</span> {
      data = inputWithoutRateManualIdAndId;
    }

    <span class="hljs-keyword">await</span> prisma.policyRate.update({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: id },
      <span class="hljs-attr">data</span>: data,
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= CREATE POLICY RATE =============</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutatePolicyRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Create a Policy Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> createPolicyRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: CreatePolicyRateInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutatePolicyRateResponse&gt; {
    <span class="hljs-keyword">const</span> { rateManualId, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: rateManualId, <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.policyRate.create({
      <span class="hljs-attr">data</span>: { rateManualId, ...inputWithoutRateManualIdAndId },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= REMOVE POLICY RATE =============</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutatePolicyRateResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Remove a Policy Rate&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> removePolicyRate(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutatePolicyRateResponse&gt; {
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> policyRate = <span class="hljs-keyword">await</span> prisma.policyRate.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!policyRate) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.policyRate.delete({ <span class="hljs-attr">where</span>: { id } });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }
}

</code></pre>
<h4 id=/resolvers/mutations/rateManualMeta.ts anchor=true>/resolvers/mutations/rateManualMeta.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Mutation, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { writeRoles, allRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;
<span class="hljs-keyword">import</span> { RatesNotFoundError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../errors&#x27;</span>;
<span class="hljs-keyword">import</span> {
  UpdateRateManualMetaInput,
  UpdateRateManualMetaResponse,
  CreateRateManualInput,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { PrismaClient } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;

<span class="hljs-keyword">const</span> copyRateManual = <span class="hljs-keyword">async</span> (
  sourceId: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">targetId</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-attr">prisma</span>: PrismaClient
): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> sourceRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findUnique({
    <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: sourceId },
    <span class="hljs-attr">select</span>: {
      <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
    },
  });
  <span class="hljs-keyword">if</span> (!sourceRateManual) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">const</span> { policyRates, endorsementRates, rateTables, cplRates } =
    sourceRateManual;
  policyRates.length &gt; <span class="hljs-number">0</span> &amp;&amp;
    (<span class="hljs-keyword">await</span> prisma.policyRate.createMany({
      <span class="hljs-attr">data</span>: policyRates.map(<span class="hljs-function">(<span class="hljs-params">{ id, ...ps }</span>) =&gt;</span> ({
        ...ps,
        <span class="hljs-attr">rateManualId</span>: targetId,
      })),
    }));
  endorsementRates.length &gt; <span class="hljs-number">0</span> &amp;&amp;
    (<span class="hljs-keyword">await</span> prisma.endorsementRate.createMany({
      <span class="hljs-attr">data</span>: endorsementRates.map(<span class="hljs-function">(<span class="hljs-params">{ id, ...es }</span>) =&gt;</span> ({
        ...es,
        <span class="hljs-attr">rateManualId</span>: targetId,
      })),
    }));
  rateTables.length &gt; <span class="hljs-number">0</span> &amp;&amp;
    (<span class="hljs-keyword">await</span> prisma.rateTable.createMany({
      <span class="hljs-attr">data</span>: rateTables.map(<span class="hljs-function">(<span class="hljs-params">{ id, ...rs }</span>) =&gt;</span> ({
        ...rs,
        <span class="hljs-attr">rateManualId</span>: targetId,
      })),
    }));
  cplRates.length &gt; <span class="hljs-number">0</span> &amp;&amp;
    (<span class="hljs-keyword">await</span> prisma.cplRate.createMany({
      <span class="hljs-attr">data</span>: cplRates.map(<span class="hljs-function">(<span class="hljs-params">{ id, ...cs }</span>) =&gt;</span> ({
        ...cs,
        <span class="hljs-attr">rateManualId</span>: targetId,
      })),
    }));
};

<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateManualMetaMutation</span> </span>{
  <span class="hljs-meta">@Authorized</span>(writeRoles)
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> UpdateRateManualMetaResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;update rate manual meta data&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> updateRateManualMeta(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: UpdateRateManualMetaInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;UpdateRateManualMetaResponse&gt; {
    <span class="hljs-keyword">const</span> { id, effectiveDate, status } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access.map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.rateManual.update({
      <span class="hljs-attr">where</span>: { id },
      <span class="hljs-attr">data</span>: {
        ...(effectiveDate ? { effectiveDate } : {}),
        status,
      },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= CREATE RATE MANUAL =============</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>(writeRoles)
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> UpdateRateManualMetaResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Create a Rate Manual&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> createRateManual(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: CreateRateManualInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;UpdateRateManualMetaResponse&gt; {
    <span class="hljs-keyword">const</span> { underwriter, copyLatest, ...metaDataInput } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access.map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> targetUnderwriter = <span class="hljs-keyword">await</span> prisma.underwriter.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">name</span>: underwriter },
    });
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
    <span class="hljs-keyword">if</span> (
      !targetUnderwriter ||
      !allowedUnderwriters.includes(targetUnderwriter.id)
    ) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">const</span> latestRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">orderBy</span>: {
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span>,
      },
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: underwriter },
        <span class="hljs-attr">state</span>: metaDataInput.state,
        <span class="hljs-attr">underwriterId</span>: {
          <span class="hljs-attr">in</span>: allowedUnderwriters,
        },
      },
      <span class="hljs-attr">select</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-literal">true</span>,
      },
    });
    <span class="hljs-keyword">const</span> newRateManual = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: { <span class="hljs-attr">underwriterId</span>: targetUnderwriter.id, ...metaDataInput },
    });
    <span class="hljs-keyword">if</span> (copyLatest &amp;&amp; latestRateManual &amp;&amp; newRateManual) {
      <span class="hljs-keyword">await</span> copyRateManual(latestRateManual.id, newRateManual.id, prisma);
    }
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }

  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-comment">// ============= REMOVE RATE MANUAL =============</span>
  <span class="hljs-comment">// ==============================================</span>
  <span class="hljs-meta">@Authorized</span>() <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> add writeRoles</span>
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> UpdateRateManualMetaResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Remove a Rate Manual&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> removeRateManual(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;UpdateRateManualMetaResponse&gt; {
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      <span class="hljs-comment">// TS doesn&#x27;t handle includes signature as expected</span>
      <span class="hljs-comment">// https://github.com/microsoft/TypeScript/issues/14520#issuecomment-904915610</span>
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> targetUnderwriter = <span class="hljs-keyword">await</span> prisma.underwriter.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManuals</span>: { <span class="hljs-attr">some</span>: { id } } },
    });
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> this underwriter check needs be moved to checkUWAccess</span>
    <span class="hljs-keyword">if</span> (
      !targetUnderwriter ||
      !allowedUnderwriters.includes(targetUnderwriter.id)
    ) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }

    <span class="hljs-keyword">await</span> prisma.rateManual.delete({ <span class="hljs-attr">where</span>: { id } });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span> };
  }
}

</code></pre>
<h4 id=/resolvers/mutations/rateTable.ts anchor=true>/resolvers/mutations/rateTable.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Mutation, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;

<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { RatesNotFoundError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../errors&#x27;</span>;
<span class="hljs-keyword">import</span> {
  UpdateRateTableInput,
  CreateRateTableInput,
  MutateRateTableResponse,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { writeRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;
<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableMutation</span> </span>{
  <span class="hljs-comment">// =============================================</span>
  <span class="hljs-comment">// ============= UPDATE RATE TABLE =============</span>
  <span class="hljs-comment">// =============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateRateTableResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Update a Rate Table&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> updateRateTable(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: UpdateRateTableInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateRateTableResponse&gt; {
    <span class="hljs-keyword">const</span> { id, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateTable.findFirst({
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.rateTable.update({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: id },
      <span class="hljs-attr">data</span>: inputWithoutRateManualIdAndId,
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span>, id };
  }

  <span class="hljs-comment">// =============================================</span>
  <span class="hljs-comment">// ============= CREATE RATE TABLE =============</span>
  <span class="hljs-comment">// =============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateRateTableResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Create a Rate Table&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> createRateTable(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: CreateRateTableInput,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateRateTableResponse&gt; {
    <span class="hljs-keyword">const</span> { rateManualId, ...inputWithoutRateManualIdAndId } = input;
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: rateManualId, <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } },
    });
    <span class="hljs-keyword">if</span> (!rateManual) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">const</span> createdRateTable = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: { rateManualId, ...inputWithoutRateManualIdAndId },
    });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span>, <span class="hljs-attr">id</span>: createdRateTable.id };
  }

  <span class="hljs-comment">// =============================================</span>
  <span class="hljs-comment">// ============= REMOVE RATE TABLE =============</span>
  <span class="hljs-comment">// =============================================</span>
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Mutation</span>(<span class="hljs-function">() =&gt;</span> MutateRateTableResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Remove a Rate Table&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> removeRateTable(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Ctx</span>() ctx: Context
  ): <span class="hljs-built_in">Promise</span>&lt;MutateRateTableResponse&gt; {
    <span class="hljs-keyword">const</span> { prisma } = ctx;
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access
      .filter(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> writeRoles.some(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r === a.role))
      .map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> RateTable = <span class="hljs-keyword">await</span> prisma.rateTable.findFirst({
      <span class="hljs-attr">where</span>: { id, <span class="hljs-attr">rateManual</span>: { <span class="hljs-attr">underwriterId</span>: { <span class="hljs-attr">in</span>: allowedUnderwriters } } },
    });
    <span class="hljs-keyword">if</span> (!RateTable) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RatesNotFoundError();
    }
    <span class="hljs-keyword">await</span> prisma.rateTable.delete({ <span class="hljs-attr">where</span>: { id } });
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;ok&#x27;</span>, id };
  }
}

</code></pre>
<h4 id=/resolvers/queries/__tests__/fees.test.ts anchor=true>/resolvers/queries/<strong>tests</strong>/fees.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> faker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@faker-js/faker&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;
<span class="hljs-keyword">import</span> { OrganizationUser } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../interfaces&#x27;</span>;
<span class="hljs-keyword">import</span> nock <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;nock&#x27;</span>;

<span class="hljs-keyword">const</span> expectedOrgId = faker.random.alphaNumeric(<span class="hljs-number">12</span>);
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">validateBasicAuthToken</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;OrganizationUser&gt; =&gt; {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">orgId</span>: expectedOrgId,
      <span class="hljs-attr">access</span>: [],
      <span class="hljs-attr">isAuthenticated</span>: <span class="hljs-literal">true</span>,
    };
  },
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

<span class="hljs-keyword">const</span> FEES_QUERY = gql<span class="hljs-string">`
  query fees($input: FeesInput!) {
    fees(input: $input) {
      policyFormName
      fees {
        id
        allowOverride
        charge
        description
        howToDisclose
        paidTo
        required
        price
        municipality
        attachedTo
        effectiveCalculatorDate
        internal {
          FeeAmount
          FeeCode
          FeeDescription
          FeeType
          KYTaxID
        }
      }
      responseBlackBox
    }
  }
`</span>;

describe(<span class="hljs-string">&#x27;Graph / Queries / Fees&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  it(<span class="hljs-string">&#x27;Forwards fee requests to undertaker&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;KY&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;Allen&#x27;</span>],
            <span class="hljs-attr">address1</span>: <span class="hljs-string">&#x27;West Main Street&#x27;</span>,
            <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;Scottsville&#x27;</span>,
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;OWNER&#x27;</span>,
            <span class="hljs-attr">policyCategory</span>: <span class="hljs-string">&#x27;OWNER&#x27;</span>,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta owner&#x27;</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2023-04-26T07:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">policyPremium</span>: <span class="hljs-number">308</span>,
            <span class="hljs-attr">fees</span>: [],
          },
          {
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;LENDER&#x27;</span>,
            <span class="hljs-attr">policyCategory</span>: <span class="hljs-string">&#x27;LENDER&#x27;</span>,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta loan&#x27;</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2023-04-26T07:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">policyPremium</span>: <span class="hljs-number">450</span>,
            <span class="hljs-attr">fees</span>: [],
          },
        ],
        <span class="hljs-attr">settlementAgencyAddress</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;San Francisco&#x27;</span>],
            <span class="hljs-attr">address1</span>: <span class="hljs-string">&#x27;564 Market Street&#x27;</span>,
            <span class="hljs-attr">address2</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">city</span>: <span class="hljs-string">&#x27;San Francisco&#x27;</span>,
          },
        },
        <span class="hljs-attr">titleCompanyAddress</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;westcor&#x27;</span>,
        <span class="hljs-attr">cpls</span>: [
          {
            <span class="hljs-attr">premiumTotal</span>: <span class="hljs-string">&#x27;50.00&#x27;</span>,
            <span class="hljs-attr">underwriterPremium</span>: <span class="hljs-string">&#x27;50&#x27;</span>,
            <span class="hljs-attr">agentPremium</span>: <span class="hljs-string">&#x27;0&#x27;</span>,
            <span class="hljs-attr">cplID</span>: <span class="hljs-string">&#x27;549&#x27;</span>,
            <span class="hljs-attr">issuedCplID</span>: <span class="hljs-string">&#x27;3569707&#x27;</span>,
            <span class="hljs-attr">protectedPartyType</span>: <span class="hljs-string">&#x27;lender&#x27;</span>,
            <span class="hljs-attr">charge</span>: <span class="hljs-literal">true</span>,
          },
        ],
        <span class="hljs-attr">secondaryApiParams</span>: {},
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/fees&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, {
        <span class="hljs-attr">alta_owner</span>: [
          {
            <span class="hljs-attr">allow_override</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">charge</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;KY Municipal Tax Scottsville&#x27;</span>,
            <span class="hljs-attr">how_to_disclose</span>: <span class="hljs-string">&#x27;Separate line in same section as policy&#x27;</span>,
            <span class="hljs-attr">internal</span>: {},
            <span class="hljs-attr">paid_to</span>: <span class="hljs-string">&#x27;underwriter&#x27;</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;KY Scottsville&#x27;</span>,
            <span class="hljs-attr">price</span>: <span class="hljs-number">21.56</span>,
            <span class="hljs-attr">municipality</span>: <span class="hljs-string">&#x27;Scottsville&#x27;</span>,
            <span class="hljs-attr">effective_calculator_date</span>: <span class="hljs-string">&#x27;02/01/2023&#x27;</span>,
          },
        ],
        <span class="hljs-attr">alta_loan</span>: [
          {
            <span class="hljs-attr">allow_override</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">charge</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;KY Municipal Tax Scottsville&#x27;</span>,
            <span class="hljs-attr">how_to_disclose</span>: <span class="hljs-string">&#x27;Separate line in same section as policy&#x27;</span>,
            <span class="hljs-attr">internal</span>: {},
            <span class="hljs-attr">paid_to</span>: <span class="hljs-string">&#x27;underwriter&#x27;</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;KY Scottsville&#x27;</span>,
            <span class="hljs-attr">price</span>: <span class="hljs-number">31.5</span>,
            <span class="hljs-attr">municipality</span>: <span class="hljs-string">&#x27;Scottsville&#x27;</span>,
            <span class="hljs-attr">effective_calculator_date</span>: <span class="hljs-string">&#x27;02/01/2023&#x27;</span>,
          },
          {
            <span class="hljs-attr">allow_override</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">charge</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;KY Municipal Tax (CPL) Scottsville&#x27;</span>,
            <span class="hljs-attr">how_to_disclose</span>: <span class="hljs-string">&#x27;Separate line in same section as policy&#x27;</span>,
            <span class="hljs-attr">internal</span>: {},
            <span class="hljs-attr">paid_to</span>: <span class="hljs-string">&#x27;underwriter&#x27;</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;KY-CITY-CPL-L3569707&#x27;</span>,
            <span class="hljs-attr">price</span>: <span class="hljs-number">3.5</span>,
            <span class="hljs-attr">attached_to</span>: <span class="hljs-string">&#x27;cpl&#x27;</span>,
            <span class="hljs-attr">municipality</span>: <span class="hljs-string">&#x27;Scottsville&#x27;</span>,
          },
        ],
      });

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: FEES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    <span class="hljs-comment">// One for each policy, and one for CPL (in KY)</span>
    expect(queryResult.data.fees.length).toEqual(<span class="hljs-number">2</span>);

    expect(queryResult.data.fees[<span class="hljs-number">0</span>].policyFormName).toBe(<span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>);
    expect(queryResult.data.fees[<span class="hljs-number">0</span>].fees[<span class="hljs-number">0</span>].description).toBe(
      <span class="hljs-string">&#x27;KY Municipal Tax Scottsville&#x27;</span>
    );

    expect(queryResult.data.fees[<span class="hljs-number">1</span>].policyFormName).toBe(<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>);
    expect(queryResult.data.fees[<span class="hljs-number">1</span>].fees[<span class="hljs-number">0</span>].description).toBe(
      <span class="hljs-string">&#x27;KY Municipal Tax Scottsville&#x27;</span>
    );

    expect(queryResult.data.fees[<span class="hljs-number">1</span>].policyFormName).toBe(<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>);
    expect(queryResult.data.fees[<span class="hljs-number">1</span>].fees[<span class="hljs-number">1</span>].description).toBe(
      <span class="hljs-string">&#x27;KY Municipal Tax (CPL) Scottsville&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;Forwards fee requests to undertaker and reads black box request if present&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;westcor&#x27;</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/fees&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, {
        <span class="hljs-attr">alta_homeowner</span>: [
          {
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;WA Sales Tax&#x27;</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;WA Sales Tax&#x27;</span>,
            <span class="hljs-attr">sales_tax_rate</span>: <span class="hljs-number">10.5</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">charge</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">price</span>: <span class="hljs-number">77.6</span>,
            <span class="hljs-attr">how_to_disclose</span>: <span class="hljs-string">&#x27;Separate line in same section as policy&#x27;</span>,
            <span class="hljs-attr">paid_to</span>: <span class="hljs-string">&#x27;agent&#x27;</span>,
            <span class="hljs-attr">endorsement_taxes</span>: [],
            <span class="hljs-attr">effective_calculator_date</span>: <span class="hljs-string">&#x27;01/01/1970&#x27;</span>,
          },
        ],
        <span class="hljs-attr">alta_loan</span>: [
          {
            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;WA Sales Tax&#x27;</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;WA Sales Tax&#x27;</span>,
            <span class="hljs-attr">sales_tax_rate</span>: <span class="hljs-number">10.5</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">charge</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">price</span>: <span class="hljs-number">21</span>,
            <span class="hljs-attr">how_to_disclose</span>: <span class="hljs-string">&#x27;Separate line in same section as policy&#x27;</span>,
            <span class="hljs-attr">paid_to</span>: <span class="hljs-string">&#x27;agent&#x27;</span>,
            <span class="hljs-attr">endorsement_taxes</span>: [],
            <span class="hljs-attr">effective_calculator_date</span>: <span class="hljs-string">&#x27;01/01/1970&#x27;</span>,
          },
        ],
      });

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: FEES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    <span class="hljs-comment">// One for each policy, and one for CPL (in KY)</span>
    expect(queryResult.data.fees.length).toEqual(<span class="hljs-number">2</span>);

    expect(queryResult.data.fees[<span class="hljs-number">0</span>].responseBlackBox).toBe(
      <span class="hljs-string">&#x27;{&quot;alta_homeowner&quot;:[{&quot;id&quot;:&quot;WA Sales Tax&quot;,&quot;description&quot;:&quot;WA Sales Tax&quot;,&quot;sales_tax_rate&quot;:10.5,&quot;required&quot;:true,&quot;charge&quot;:true,&quot;price&quot;:77.6,&quot;how_to_disclose&quot;:&quot;Separate line in same section as policy&quot;,&quot;paid_to&quot;:&quot;agent&quot;,&quot;endorsement_taxes&quot;:[],&quot;effective_calculator_date&quot;:&quot;01/01/1970&quot;}]}&#x27;</span>
    );

    expect(queryResult.data.fees[<span class="hljs-number">1</span>].responseBlackBox).toBe(
      <span class="hljs-string">&#x27;{&quot;alta_loan&quot;:[{&quot;id&quot;:&quot;WA Sales Tax&quot;,&quot;description&quot;:&quot;WA Sales Tax&quot;,&quot;sales_tax_rate&quot;:10.5,&quot;required&quot;:true,&quot;charge&quot;:true,&quot;price&quot;:21,&quot;how_to_disclose&quot;:&quot;Separate line in same section as policy&quot;,&quot;paid_to&quot;:&quot;agent&quot;,&quot;endorsement_taxes&quot;:[],&quot;effective_calculator_date&quot;:&quot;01/01/1970&quot;}]}&#x27;</span>
    );
  });
});

</code></pre>
<h4 id=/resolvers/queries/__tests__/rateManual.test.ts anchor=true>/resolvers/queries/<strong>tests</strong>/rateManual.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;
<span class="hljs-keyword">import</span> { PolicyCategory, PropertyType, Status } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLResponse } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-plugin-base&#x27;</span>;

<span class="hljs-keyword">const</span> devUnderwriterName = <span class="hljs-string">&#x27;Qualia Dev UW&#x27;</span>;
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

describe(<span class="hljs-string">&#x27;Graph / Queries / RateManual&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManual1: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpRateManual2: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpRateTable1: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  <span class="hljs-keyword">let</span> tmpRateTable2: { <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> };
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManual1 = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2023-01-28&#x27;</span>),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
    tmpRateManual2 = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2023-02-28&#x27;</span>),
        <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;DRAFT&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: devUnderwriterName },
        },
      },
    });
    tmpRateTable1 = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASICSTATUSTESTPROD&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">1111</span>,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManual1.id,
      },
    });
    tmpRateTable2 = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASICSTATUSTESTPROD&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: <span class="hljs-number">2222</span>,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManual1.id,
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateManual1) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual1.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManual2) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManual2.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTable1) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTable1.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTable2) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTable2.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;can get rate manuals by state&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> RATE_MANUALS_QUERY = gql<span class="hljs-string">`
    query RateManualStates {
      rateManualStates(underwriter: &quot;<span class="hljs-subst">${devUnderwriterName}</span>&quot;, take: 10, skip: 0) {
        id
        state
        effectiveDate
        status
        updatedAt
      }
    }
    `</span>;
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_MANUALS_QUERY,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_READ_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.rateManualStates.length).toEqual(<span class="hljs-number">1</span>);
  });

  it(<span class="hljs-string">&#x27;can get rate manuals with state and underwriter filter&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> RATE_MANUALS_QUERY = gql<span class="hljs-string">`
    query RateManualsFiltered {
      rateManuals(state: &quot;HI&quot;, underwriter: &quot;<span class="hljs-subst">${devUnderwriterName}</span>&quot;, take: 10, skip: 0) {
        id
        state
        effectiveDate
        status
      }
    }
    `</span>;
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_MANUALS_QUERY,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_READ_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(result.data.rateManuals.length).toEqual(<span class="hljs-number">2</span>);
  });

  it(<span class="hljs-string">&#x27;can get a full size rate manual by id&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> exampleRateManualWithCPL = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
      },
      <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
      },
    });

    <span class="hljs-keyword">const</span> RATE_MANUAL_QUERY = gql<span class="hljs-string">`
    query fullRateManual {
      rateManual(id: &quot;<span class="hljs-subst">${exampleRateManualWithCPL?.id}</span>&quot;) {
        id
        state
        effectiveDate
        status
        policyRatesCount
        endorsementRatesCount
        rateTablesCount
        policyRates {
          id
          policyType
        }
        endorsementRates {
          id
          endorsementId
        }
        rateTables {
          id
          name
        }
        cplRates {
          id
          protectedParty
        }
      }
    }`</span>;
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_MANUAL_QUERY,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_READ_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result.data.rateManual.id).toEqual(exampleRateManualWithCPL?.id);
    expect(result.data.rateManual.policyRates.length).toBe(
      exampleRateManualWithCPL?.policyRates.length
    );
    expect(result.data.rateManual.endorsementRates.length).toBe(
      exampleRateManualWithCPL?.endorsementRates.length
    );
    expect(result.data.rateManual.rateTables.length).toBe(
      exampleRateManualWithCPL?.rateTables.length
    );
    expect(result.data.rateManual.cplRates.length).toBe(
      exampleRateManualWithCPL?.cplRates.length
    );
  });

  it(<span class="hljs-string">&#x27;can get a rate manual with specific rate table filtered by rate_table_id&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> executeGetQuery = <span class="hljs-keyword">async</span> (
      rateTableClause: <span class="hljs-built_in">string</span>
    ): <span class="hljs-built_in">Promise</span>&lt;GraphQLResponse&gt; =&gt; {
      <span class="hljs-keyword">const</span> RATE_MANUAL_QUERY = gql<span class="hljs-string">`
      query fullRateManual {
        rateManual(id: &quot;<span class="hljs-subst">${tmpRateManual1?.id}</span>&quot;) {
          id
          state
          rateTablesCount
          rateTables <span class="hljs-subst">${rateTableClause}</span> {
            id
            name
          }
        }
      }`</span>;
      <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
        {
          <span class="hljs-attr">query</span>: RATE_MANUAL_QUERY,
        },
        generateExecuteOperationContext(
          process.env.TITLE_RATES_API_QUALIA_READ_API_KEY
        ) <span class="hljs-keyword">as</span> ExpressContext
      );
      <span class="hljs-keyword">if</span> (result.errors) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(result.errors, <span class="hljs-literal">undefined</span>, <span class="hljs-number">2</span>));
      }
      <span class="hljs-keyword">if</span> (!result.data) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
      }
      <span class="hljs-keyword">return</span> result;
    };

    <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> executeGetQuery(<span class="hljs-string">``</span>);
    expect(result1.data?.rateManual.id).toEqual(tmpRateManual1?.id);
    expect(result1.data?.rateManual.rateTables.length).toBe(<span class="hljs-number">2</span>);
    expect(result1.data?.rateManual.rateTables[<span class="hljs-number">0</span>].id).toBe(tmpRateTable1.id);
    expect(result1.data?.rateManual.rateTables[<span class="hljs-number">1</span>].id).toBe(tmpRateTable2.id);

    <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">await</span> executeGetQuery(
      <span class="hljs-string">`(where: { id: { equals: &quot;<span class="hljs-subst">${tmpRateTable1.id}</span>&quot;}})`</span>
    );
    expect(result2.data?.rateManual.id).toEqual(tmpRateManual1?.id);
    expect(result2.data?.rateManual.rateTables.length).toBe(<span class="hljs-number">1</span>);
    expect(result2.data?.rateManual.rateTables[<span class="hljs-number">0</span>].id).toBe(tmpRateTable1.id);

    <span class="hljs-keyword">const</span> result3 = <span class="hljs-keyword">await</span> executeGetQuery(
      <span class="hljs-string">`(where: { id: { equals: &quot;<span class="hljs-subst">${tmpRateTable2.id}</span>&quot;}})`</span>
    );
    expect(result3.data?.rateManual.id).toEqual(tmpRateManual1?.id);
    expect(result3.data?.rateManual.rateTables.length).toBe(<span class="hljs-number">1</span>);
    expect(result3.data?.rateManual.rateTables[<span class="hljs-number">0</span>].id).toBe(tmpRateTable2.id);

    <span class="hljs-keyword">const</span> result4 = <span class="hljs-keyword">await</span> executeGetQuery(
      <span class="hljs-string">`(where: { id: { in: [&quot;<span class="hljs-subst">${tmpRateTable1.id}</span>&quot;, &quot;<span class="hljs-subst">${tmpRateTable2.id}</span>&quot;]}})`</span>
    );
    expect(result4.data?.rateManual.id).toEqual(tmpRateManual1?.id);
    expect(result4.data?.rateManual.rateTables.length).toBe(<span class="hljs-number">2</span>);
    expect(result4.data?.rateManual.rateTables[<span class="hljs-number">0</span>].id).toBe(tmpRateTable1.id);
    expect(result4.data?.rateManual.rateTables[<span class="hljs-number">1</span>].id).toBe(tmpRateTable2.id);
  });

  it(<span class="hljs-string">&#x27;can return null if rate manual not found&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// random ID that doesn&#x27;t exist</span>
    <span class="hljs-keyword">const</span> RATE_MANUAL_QUERY = gql<span class="hljs-string">`
      query fullRateManual {
        rateManual(id: &quot;64511c61fc0a7dadfa14e15f&quot;) {
          id
          state
          effectiveDate
          status
          policyRatesCount
          endorsementRatesCount
          rateTablesCount
          policyRates {
            id
            policyType
          }
          endorsementRates {
            id
            endorsementId
          }
          rateTables {
            id
            name
          }
          cplRates {
            id
            protectedParty
          }
        }
      }
    `</span>;
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_MANUAL_QUERY,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_READ_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result.data.rateManual).toBeNull();
  });

  it(<span class="hljs-string">&#x27;can get a rate manual using skip, take and orderBy&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> exampleRateManualWithCPL = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;natic&#x27;</span> },
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;HI&#x27;</span>,
      },
      <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">policyRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">endorsementRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rateTables</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">cplRates</span>: <span class="hljs-literal">true</span>,
      },
    });

    <span class="hljs-keyword">const</span> RATE_MANUAL_QUERY = gql<span class="hljs-string">`
    query fullRateManual {
      rateManual(id: &quot;<span class="hljs-subst">${exampleRateManualWithCPL?.id}</span>&quot;) {
        id
        state
        effectiveDate
        status
        policyRatesCount
        endorsementRatesCount
        rateTablesCount
        policyRates(skip: 0, take: 2, orderBy: { policyType: &quot;asc&quot; }) {
          id
          policyType
        }
        endorsementRates(skip: 0, take: 2, orderBy: { endorsementId: &quot;asc&quot; }) {
          id
          endorsementId
        }
        rateTables(skip: 0, take: 2, orderBy: { name: &quot;asc&quot; }) {
          id
          name
        }
        cplRates(skip: 0, take: 2, orderBy: { protectedParty: &quot;asc&quot; }) {
          id
          protectedParty
        }
      }
    }`</span>;
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_MANUAL_QUERY,
      },
      generateExecuteOperationContext(
        process.env.TITLE_RATES_API_QUALIA_READ_API_KEY
      ) <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!result.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }
    expect(result.data.rateManual.id).toEqual(exampleRateManualWithCPL?.id);
    expect(result.data.rateManual.policyRates.length).toBe(<span class="hljs-number">2</span>);
    expect(result.data.rateManual.endorsementRates.length).toBe(<span class="hljs-number">2</span>);
    expect(result.data.rateManual.rateTables.length).toBe(<span class="hljs-number">2</span>);
    expect(result.data.rateManual.cplRates.length).toBe(<span class="hljs-number">2</span>);
    expect(
      result.data.rateManual.policyRates
        .map(<span class="hljs-function">(<span class="hljs-params">r: { policyType: <span class="hljs-built_in">string</span>[] }</span>) =&gt;</span> r.policyType)
        .sort()
    ).toEqual(
      exampleRateManualWithCPL?.policyRates
        .map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.policyType)
        .sort()
        .slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
    );
    expect(
      result.data.rateManual.endorsementRates
        .map(<span class="hljs-function">(<span class="hljs-params">r: { endorsementId: <span class="hljs-built_in">string</span>[] }</span>) =&gt;</span> r.endorsementId)
        .sort()
    ).toEqual(
      exampleRateManualWithCPL?.endorsementRates
        .map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.endorsementId)
        .sort()
        .slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
    );
    expect(
      result.data.rateManual.rateTables
        .map(<span class="hljs-function">(<span class="hljs-params">r: { name: <span class="hljs-built_in">string</span>[] }</span>) =&gt;</span> r.name)
        .sort()
    ).toEqual(
      exampleRateManualWithCPL?.rateTables
        .map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.name)
        .sort()
        .slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
    );
    expect(
      result.data.rateManual.cplRates
        .map(<span class="hljs-function">(<span class="hljs-params">r: { protectedParty: <span class="hljs-built_in">string</span>[] }</span>) =&gt;</span> r.protectedParty)
        .sort()
    ).toEqual(
      exampleRateManualWithCPL?.cplRates
        .map(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> r.protectedParty)
        .sort()
        .slice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)
    );

    expect(result.data.rateManual.policyRatesCount).toBe(
      exampleRateManualWithCPL?.policyRates.length
    );
    expect(result.data.rateManual.endorsementRatesCount).toBe(
      exampleRateManualWithCPL?.endorsementRates.length
    );
    expect(result.data.rateManual.rateTablesCount).toBe(
      exampleRateManualWithCPL?.rateTables.length
    );
  });
});

</code></pre>
<h4 id=/resolvers/queries/__tests__/rates.test.ts anchor=true>/resolvers/queries/<strong>tests</strong>/rates.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> faker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@faker-js/faker&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;
<span class="hljs-keyword">import</span> { OrganizationUser } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../interfaces&#x27;</span>;
<span class="hljs-keyword">import</span> { PolicyCategory } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../generated/type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { createTestPolicyRate } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> nock <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;nock&#x27;</span>;
<span class="hljs-keyword">import</span> {
  PolicyRate,
  PropertyType,
  RateManual,
  RateTable,
  Status,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { propertyTypes } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../types&#x27;</span>;
<span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;
<span class="hljs-keyword">import</span> { ErrorMessage } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../errors&#x27;</span>;

<span class="hljs-keyword">const</span> expectedOrgId = faker.random.alphaNumeric(<span class="hljs-number">12</span>);
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">validateBasicAuthToken</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;OrganizationUser&gt; =&gt; {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">orgId</span>: expectedOrgId,
      <span class="hljs-attr">access</span>: [],
      <span class="hljs-attr">isAuthenticated</span>: <span class="hljs-literal">true</span>,
    };
  },
  <span class="hljs-attr">checkUWAccess</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
  <span class="hljs-attr">authChecker</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
}));

<span class="hljs-keyword">const</span> RATES_QUERY = gql<span class="hljs-string">`
  query rates($input: RatesInput!) {
    rates(input: $input) {
      policies {
        id
        underwriterPremium
        agentPremium
        totalPremium
        disclosedTotalPremium
        endorsements {
          totalPremium
        }
      }
      status
      responseBlackBox
    }
  }
`</span>;

<span class="hljs-keyword">const</span> RATE_TYPES_QUERY = gql<span class="hljs-string">`
  query rateTypes($input: RateTypesInput!) {
    rateTypes(input: $input) {
      policyFormName
      rateTypes {
        label
        id
      }
      responseBlackBox
    }
  }
`</span>;

<span class="hljs-keyword">const</span> TEST_RATE_CONFIGURATION_QUERY = gql<span class="hljs-string">`
  query TestRateConfiguration($input: TestPolicyRateInput!) {
    testRateConfiguration(input: $input) {
      totalPremium
    }
  }
`</span>;

describe(<span class="hljs-string">&#x27;Graph / Queries / Rates&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  afterAll(<span class="hljs-function">() =&gt;</span> {
    nock.cleanAll();
  });

  it(<span class="hljs-string">&#x27;can accept zero policy and return empty result&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };
    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies.length).toBe(<span class="hljs-number">0</span>);
  });

  it(<span class="hljs-string">&#x27;returns rates for one policy with a default split of 100%&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].underwriterPremium).toEqual(<span class="hljs-number">0</span>); <span class="hljs-comment">// 100% split by default</span>
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">80900</span>);
  });

  it(<span class="hljs-string">&#x27;does not throw an error when a number is passed in for junior loan insurance amount&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_loan&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">juniorLoanInsuranceAmounts</span>: [
              {
                <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">insuranceAmount</span>: <span class="hljs-number">0</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;REFINANCE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].underwriterPremium).toEqual(<span class="hljs-number">0</span>); <span class="hljs-comment">// 100% split by default</span>
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">80900</span>);
  });

  it(<span class="hljs-string">&#x27;returns premiums with junior loan policy insurance amounts included in calculation as number&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_loan&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">juniorLoanInsuranceAmounts</span>: [
              {
                <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">insuranceAmount</span>: <span class="hljs-number">1000000</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;REFINANCE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].underwriterPremium).toEqual(<span class="hljs-number">0</span>); <span class="hljs-comment">// 100% split by default</span>
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">277300</span>);
  });

  it(<span class="hljs-string">&#x27;returns premiums with junior loan policy insurance amounts included in calculation as string&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_loan&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">juniorLoanInsuranceAmounts</span>: [
              {
                <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">insuranceAmount</span>: <span class="hljs-string">&#x27;10000.00&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;REFINANCE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].underwriterPremium).toEqual(<span class="hljs-number">0</span>); <span class="hljs-comment">// 100% split by default</span>
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">277300</span>);
  });

  it(<span class="hljs-string">&#x27;returns correct rates for simultaneous policies with endorsements&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;summit&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_loan&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;bundled lenders purchase loan&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">74000000</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;CO FORM 130&#x27;</span>,
              },
            ],
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01&#x27;</span>,
          },
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">6</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">92500000</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 17&#x27;</span>,
              },
            ],
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">65000</span>);
    expect(
      queryResult.data.rates.policies[<span class="hljs-number">0</span>].endorsements[<span class="hljs-number">0</span>].totalPremium
    ).toEqual(<span class="hljs-number">1000</span>);
    expect(queryResult.data.rates.policies[<span class="hljs-number">1</span>].totalPremium).toEqual(<span class="hljs-number">228500</span>);
    expect(
      queryResult.data.rates.policies[<span class="hljs-number">1</span>].endorsements[<span class="hljs-number">0</span>].totalPremium
    ).toEqual(<span class="hljs-number">5000</span>);
  });

  it(<span class="hljs-string">&#x27;returns rates for reissue policy&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;NV&#x27;</span>,
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;reissue&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">50000000</span>,
            <span class="hljs-attr">previousPolicyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">previousRateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">previousCoverageAmount</span>: <span class="hljs-number">40000000</span>,
            <span class="hljs-attr">endorsements</span>: [],
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">60388</span>);
  });

  it(<span class="hljs-string">&#x27;county name is case insensitive&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult1 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult1.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult1.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult1.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toBeGreaterThan(<span class="hljs-number">0</span>);

    variables.input.property.address.counties = [<span class="hljs-string">&#x27;Jefferson&#x27;</span>];
    <span class="hljs-keyword">const</span> queryResult2 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult2.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult2.data.rates.policies.length).toBe(
      variables.input.policies.length
    );
    expect(queryResult2.data.rates.policies[<span class="hljs-number">0</span>].totalPremium).toBe(
      queryResult1.data.rates.policies[<span class="hljs-number">0</span>].totalPremium
    );
  });

  it(<span class="hljs-string">&#x27;falls back to undertaker for rates when state/uw is not supported&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/calculateRates&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">800</span>,
          <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">200</span>,
          <span class="hljs-attr">trid</span>: <span class="hljs-number">1000</span>,
          <span class="hljs-attr">endorsements</span>: [
            {
              <span class="hljs-attr">endorsement_id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">80</span>,
              <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">20</span>,
            },
          ],
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.status).toBe(<span class="hljs-literal">null</span>);

    expect(queryResult.data.rates.policies.length).toBe(
      variables.input.policies.length
    );

    <span class="hljs-keyword">const</span> policy = queryResult.data.rates.policies[<span class="hljs-number">0</span>];
    expect(policy.underwriterPremium).toEqual(<span class="hljs-number">20000</span>);
    expect(policy.agentPremium).toEqual(<span class="hljs-number">80000</span>);
    expect(policy.totalPremium).toEqual(<span class="hljs-number">100000</span>);

    expect(policy.endorsements[<span class="hljs-number">0</span>].totalPremium).toEqual(<span class="hljs-number">10000</span>);
  });

  it(<span class="hljs-string">&#x27;falls back to undertaker when request black box is present&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/calculateRates&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">800</span>,
          <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">200</span>,
          <span class="hljs-attr">trid</span>: <span class="hljs-number">1000</span>,
          <span class="hljs-attr">endorsements</span>: [
            {
              <span class="hljs-attr">endorsement_id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">80</span>,
              <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">20</span>,
            },
          ],
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.responseBlackBox).toBe(
      <span class="hljs-string">&#x27;[{&quot;agent_premium&quot;:800,&quot;underwriter_premium&quot;:200,&quot;trid&quot;:1000,&quot;endorsements&quot;:[{&quot;endorsement_id&quot;:&quot;ALTA 3-06&quot;,&quot;agent_premium&quot;:80,&quot;underwriter_premium&quot;:20}]}]&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;checks for rate calculation failure information in the &quot;status&quot; field of an undertaker response&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/calculateRates&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, {
        <span class="hljs-attr">status</span>: [
          <span class="hljs-string">&#x27;(s:Server) Server was unable to process request. ---&gt; Coverage amount must be greater than $1,000,000.00. Please adjust the coverage amount.&#x27;</span>,
        ],
      });

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.policies).toBe(<span class="hljs-literal">null</span>);
    expect(queryResult.data.rates.status[<span class="hljs-number">0</span>]).toBe(
      <span class="hljs-string">&#x27;(s:Server) Server was unable to process request. ---&gt; Coverage amount must be greater than $1,000,000.00. Please adjust the coverage amount.&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;accepts string representation with dollars and cents for `rate` field of flEndorsementRates&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">flEndorsementRates</span>: [
          {
            <span class="hljs-attr">rate</span>: <span class="hljs-string">&#x27;75.00&#x27;</span>,
            <span class="hljs-attr">calculation</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">endorsement</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          },
        ],
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };
  });

  it(<span class="hljs-string">&#x27;accepts string representation with only dollars for `rate` field of flEndorsementRates&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">flEndorsementRates</span>: [
          {
            <span class="hljs-attr">rate</span>: <span class="hljs-string">&#x27;75&#x27;</span>,
            <span class="hljs-attr">calculation</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">endorsement</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          },
        ],
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/calculateRates&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">800</span>,
          <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">200</span>,
          <span class="hljs-attr">trid</span>: <span class="hljs-number">1000</span>,
          <span class="hljs-attr">endorsements</span>: [
            {
              <span class="hljs-attr">endorsement_id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">80</span>,
              <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">20</span>,
            },
          ],
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.responseBlackBox).toBe(
      <span class="hljs-string">&#x27;[{&quot;agent_premium&quot;:800,&quot;underwriter_premium&quot;:200,&quot;trid&quot;:1000,&quot;endorsements&quot;:[{&quot;endorsement_id&quot;:&quot;ALTA 3-06&quot;,&quot;agent_premium&quot;:80,&quot;underwriter_premium&quot;:20}]}]&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;accepts numeric representation of `rate` field of flEndorsementRates&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">flEndorsementRates</span>: [
          {
            <span class="hljs-attr">rate</span>: <span class="hljs-number">7500</span>,
            <span class="hljs-attr">calculation</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">endorsement</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          },
        ],
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/calculateRates&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">800</span>,
          <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">200</span>,
          <span class="hljs-attr">trid</span>: <span class="hljs-number">1000</span>,
          <span class="hljs-attr">endorsements</span>: [
            {
              <span class="hljs-attr">endorsement_id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">80</span>,
              <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">20</span>,
            },
          ],
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rates.responseBlackBox).toBe(
      <span class="hljs-string">&#x27;[{&quot;agent_premium&quot;:800,&quot;underwriter_premium&quot;:200,&quot;trid&quot;:1000,&quot;endorsements&quot;:[{&quot;endorsement_id&quot;:&quot;ALTA 3-06&quot;,&quot;agent_premium&quot;:80,&quot;underwriter_premium&quot;:20}]}]&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;throws an error if `rate` field of flEndorsementRates is a string that cannot be parsed as a float&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
            <span class="hljs-attr">counties</span>: [<span class="hljs-string">&#x27;jefferson&#x27;</span>],
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.OWNER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_owner&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;basic&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
            <span class="hljs-attr">endorsements</span>: [
              {
                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              },
            ],
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">secondaryApiParams</span>: {
          <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">user</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
          <span class="hljs-attr">password</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        },
        <span class="hljs-attr">flEndorsementRates</span>: [
          {
            <span class="hljs-attr">rate</span>: <span class="hljs-string">&#x27;not a parseable number&#x27;</span>,
            <span class="hljs-attr">calculation</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">endorsement</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          },
        ],
        <span class="hljs-attr">overrideSplit</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/calculateRates&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">800</span>,
          <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">200</span>,
          <span class="hljs-attr">trid</span>: <span class="hljs-number">1000</span>,
          <span class="hljs-attr">endorsements</span>: [
            {
              <span class="hljs-attr">endorsement_id</span>: <span class="hljs-string">&#x27;ALTA 3-06&#x27;</span>,
              <span class="hljs-attr">agent_premium</span>: <span class="hljs-number">80</span>,
              <span class="hljs-attr">underwriter_premium</span>: <span class="hljs-number">20</span>,
            },
          ],
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    expect(queryResult.errors &amp;&amp; queryResult.errors[<span class="hljs-number">0</span>].message).toBe(
      <span class="hljs-string">`Variable &quot;$input&quot; got invalid value &quot;not a parseable number&quot; at &quot;input.flEndorsementRates[0].rate&quot;; Expected type &quot;Money&quot;. <span class="hljs-subst">${ErrorMessage.INVALID_MONEY_VALUE}</span> Received: not a parseable number, type: string`</span>
    );
  });
});

describe(<span class="hljs-string">&#x27;Graph / Queries / Rates / Status&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">/**
   * These tests ensure that status=STAGING rates are only
   * included during rate calculation when appropriate
   */</span>
  <span class="hljs-keyword">const</span> tmpRateManulProdFlatRate = <span class="hljs-number">444</span>;
  <span class="hljs-keyword">const</span> tmpRateManulStagingFlatRate = <span class="hljs-number">999999</span>;
  <span class="hljs-keyword">let</span> tmpRateManualProd: RateManual;
  <span class="hljs-keyword">let</span> tmpPolicyRateProd: PolicyRate;
  <span class="hljs-keyword">let</span> tmpRateTableProd: RateTable;
  <span class="hljs-keyword">let</span> tmpRateManualStaging: RateManual;
  <span class="hljs-keyword">let</span> tmpPolicyRateStaging: PolicyRate;
  <span class="hljs-keyword">let</span> tmpRateTableStaging: RateTable;
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManualProd = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2093-01-29&#x27;</span>),
        <span class="hljs-attr">status</span>: Status.PROD,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;first_american&#x27;</span> },
        },
      },
    });
    tmpRateTableProd = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASICSTATUSTESTPROD&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: tmpRateManulProdFlatRate,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManualProd.id,
      },
    });
    tmpPolicyRateProd = <span class="hljs-keyword">await</span> createTestPolicyRate(
      tmpRateManualProd,
      tmpRateTableProd,
      {
        <span class="hljs-attr">policyType</span>: <span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>,
        <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
        <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;stagingtestratetype&#x27;</span>,
        <span class="hljs-attr">transactionType</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">insuranceAmountRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">oldLoanAgeRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">crrOrdersRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">propertyType</span>: PropertyType.RESIDENTIAL,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test policy rate&#x27;</span>,
      }
    );
    tmpRateManualStaging = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2093-03-28&#x27;</span>),
        <span class="hljs-attr">status</span>: Status.STAGING,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;first_american&#x27;</span> },
        },
      },
    });
    tmpRateTableStaging = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASICSTATUSTESTSTAGE&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: tmpRateManulStagingFlatRate,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManualStaging.id,
      },
    });
    tmpPolicyRateStaging = <span class="hljs-keyword">await</span> createTestPolicyRate(
      tmpRateManualStaging,
      tmpRateTableStaging,
      {
        <span class="hljs-attr">policyType</span>: <span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>,
        <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
        <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;stagingtestratetype&#x27;</span>,
        <span class="hljs-attr">transactionType</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test policy rate&#x27;</span>,
        <span class="hljs-attr">insuranceAmountRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">oldLoanAgeRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">crrOrdersRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">propertyType</span>: PropertyType.RESIDENTIAL,
      }
    );
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpPolicyRateProd) {
      <span class="hljs-keyword">await</span> prisma.policyRate.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpPolicyRateProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTableProd) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTableProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManualProd) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManualProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpPolicyRateStaging) {
      <span class="hljs-keyword">await</span> prisma.policyRate.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpPolicyRateStaging.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTableStaging) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTableStaging.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManualStaging) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManualStaging.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;should calulate rates using PROD rate manuals&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_loan&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;stagingtestratetype&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2099-01-01T00:00:00.000Z&#x27;</span>,
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data || _.isEmpty(queryResult.data?.rates)) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Error: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(queryResult.errors, <span class="hljs-literal">undefined</span>, <span class="hljs-number">2</span>)}</span>`</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    <span class="hljs-keyword">const</span> actualPremium = queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium;
    <span class="hljs-keyword">const</span> expectedPremium = tmpRateManulProdFlatRate * <span class="hljs-number">100</span>;
    expect(actualPremium).toEqual(expectedPremium);
  });

  it(<span class="hljs-string">&#x27;should calulate rates using STAGING rate manuals if includeStagingRates param provided&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">includeStagingRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
          },
        },
        <span class="hljs-attr">policies</span>: [
          {
            <span class="hljs-attr">id</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
            <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
            <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;alta_loan&#x27;</span>,
            <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;stagingtestratetype&#x27;</span>,
            <span class="hljs-attr">coverageAmount</span>: <span class="hljs-number">100000</span>,
            <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2099-01-01T00:00:00.000Z&#x27;</span>,
          },
        ],
        <span class="hljs-attr">purpose</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data || _.isEmpty(queryResult.data?.rates)) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Error: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(queryResult.errors, <span class="hljs-literal">undefined</span>, <span class="hljs-number">2</span>)}</span>`</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    <span class="hljs-keyword">const</span> actualPremium = queryResult.data.rates.policies[<span class="hljs-number">0</span>].totalPremium;
    <span class="hljs-keyword">const</span> expectedPremium = tmpRateManulStagingFlatRate * <span class="hljs-number">100</span>;
    expect(actualPremium).toEqual(expectedPremium);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Queries / RateTypes&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });
  it(<span class="hljs-string">&#x27;returns rate types&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;wfg&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;ME&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].policyFormName).toEqual(
      variables.input.policyFormNames[<span class="hljs-number">0</span>]
    );
    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes[<span class="hljs-number">0</span>].label).toEqual(<span class="hljs-string">&#x27;Basic&#x27;</span>);
  });

  it(<span class="hljs-string">&#x27;falls back to undertaker for rate types when state/uw is not supported&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/rateTypes&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-string">&#x27;1&#x27;</span>: <span class="hljs-string">&#x27;Test Rate Type&#x27;</span>,
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].policyFormName).toEqual(
      variables.input.policyFormNames[<span class="hljs-number">0</span>]
    );
    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes[<span class="hljs-number">0</span>].label).toEqual(
      <span class="hljs-string">&#x27;Test Rate Type&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;falls back to undertaker for rate types when requestBlackBox is used&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/rateTypes&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, [
        {
          <span class="hljs-string">&#x27;1&#x27;</span>: <span class="hljs-string">&#x27;Test Rate Type&#x27;</span>,
        },
      ]);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].responseBlackBox).toEqual(
      <span class="hljs-string">&#x27;{&quot;1&quot;:&quot;Test Rate Type&quot;}&#x27;</span>
    );
  });

  it(<span class="hljs-string">&#x27;handles null responses when using requestBlackBox&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Undertaker may return a null response for certain rateTypes requests</span>
    <span class="hljs-comment">// This test ensures we handle that situation gracefully</span>

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
        <span class="hljs-comment">// Fake request data, we&#x27;ll use mocked undertaker output for testing.</span>
        <span class="hljs-attr">requestBlackBox</span>: <span class="hljs-string">&#x27;{}&#x27;</span>,
      },
    };

    <span class="hljs-comment">// Hack: Undertaker returns null, but we can&#x27;t use null in `.reply`.</span>
    <span class="hljs-comment">// Tyoe casting `null as unknown as Body` allows us to simulate real behavior.</span>
    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/rateTypes&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> Body);

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].responseBlackBox).toEqual(<span class="hljs-string">&#x27;{}&#x27;</span>);
    expect(queryResult.data.rateTypes[<span class="hljs-number">1</span>].responseBlackBox).toEqual(<span class="hljs-string">&#x27;{}&#x27;</span>);
  });

  it(<span class="hljs-string">&#x27;handles null responses when falling back to undertaker for rate types&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Undertaker may return a null response for certain rateTypes requests</span>
    <span class="hljs-comment">// This test ensures we handle that situation gracefully</span>

    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CA&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
      },
    };

    nock(<span class="hljs-string">`<span class="hljs-subst">${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}</span>`</span>)
      .post(<span class="hljs-string">&#x27;/jacket/rateTypes&#x27;</span>)
      .reply(<span class="hljs-number">200</span>, {}); <span class="hljs-comment">// Mock empty response from server</span>

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    <span class="hljs-keyword">const</span> expected = [
      { <span class="hljs-attr">policyFormName</span>: <span class="hljs-string">&#x27;ALTA_OWNER&#x27;</span>, <span class="hljs-attr">rateTypes</span>: [], <span class="hljs-attr">responseBlackBox</span>: <span class="hljs-literal">null</span> },
    ];
    expect(queryResult.data.rateTypes).toEqual(expected);
  });

  it(<span class="hljs-string">&#x27;rate types should depend on whether the property type corresponds to commercial&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> commercialVariables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;WI&#x27;</span>,
          },
          <span class="hljs-attr">propertyType</span>: <span class="hljs-string">&#x27;COMMERCIAL&#x27;</span>, <span class="hljs-comment">// commercial only</span>
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> commercialQueryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        <span class="hljs-attr">variables</span>: commercialVariables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!commercialQueryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(
      commercialQueryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes.map(
        <span class="hljs-function">(<span class="hljs-params">r: { id: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> r.id
      )
    ).toEqual([<span class="hljs-string">&#x27;basic&#x27;</span>, <span class="hljs-string">&#x27;reissue&#x27;</span>, <span class="hljs-string">&#x27;non simultaneous issue&#x27;</span>]);
  });

  it(<span class="hljs-string">&#x27;rate types should depend on whether the property type corresponds to residential&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> residentialVariables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;WI&#x27;</span>,
          },
          <span class="hljs-attr">propertyType</span>: <span class="hljs-string">&#x27;RESIDENCE_ONE_TO_FOUR_FAMILIES&#x27;</span>, <span class="hljs-comment">// residential only</span>
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
      },
    };
    <span class="hljs-keyword">const</span> residentialQueryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        <span class="hljs-attr">variables</span>: residentialVariables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!residentialQueryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(
      residentialQueryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes.map(
        <span class="hljs-function">(<span class="hljs-params">r: { id: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> r.id
      )
    ).toEqual([<span class="hljs-string">&#x27;basic&#x27;</span>, <span class="hljs-string">&#x27;purchase money&#x27;</span>]);
  });

  it(<span class="hljs-string">&#x27;rate types should depend on whether the property type corresponds to both residential and commercial&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> residentialOrCommercialVariables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;amtrust&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;WI&#x27;</span>,
          },
          <span class="hljs-attr">propertyType</span>: <span class="hljs-string">&#x27;CONDOMINIUM&#x27;</span>, <span class="hljs-comment">// can be commercial or residential</span>
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2022-01-01T00:00:00.000Z&#x27;</span>,
      },
    };
    <span class="hljs-keyword">const</span> residentialOrCommercialQueryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        <span class="hljs-attr">variables</span>: residentialOrCommercialVariables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!residentialOrCommercialQueryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(
      residentialOrCommercialQueryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes.map(
        <span class="hljs-function">(<span class="hljs-params">r: { id: <span class="hljs-built_in">string</span> }</span>) =&gt;</span> r.id
      )
    ).toEqual([<span class="hljs-string">&#x27;basic&#x27;</span>, <span class="hljs-string">&#x27;purchase money&#x27;</span>, <span class="hljs-string">&#x27;reissue&#x27;</span>, <span class="hljs-string">&#x27;non simultaneous issue&#x27;</span>]);
  });
});

describe(<span class="hljs-string">&#x27;Graph / Queries / RateTypes / Status&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">/**
   * These tests ensure that status=STAGING rates are only
   * included when fetching rate types when appropriate
   */</span>
  <span class="hljs-keyword">const</span> tmpRateManulProdFlatRate = <span class="hljs-number">123</span>;
  <span class="hljs-keyword">const</span> tmpRateManulStagingFlatRate = <span class="hljs-number">999999</span>;
  <span class="hljs-keyword">let</span> tmpRateManualProd: RateManual;
  <span class="hljs-keyword">let</span> tmpPolicyRateProd: PolicyRate;
  <span class="hljs-keyword">let</span> tmpRateTableProd: RateTable;
  <span class="hljs-keyword">let</span> tmpRateManualStaging: RateManual;
  <span class="hljs-keyword">let</span> tmpPolicyRateStaging: PolicyRate;
  <span class="hljs-keyword">let</span> tmpRateTableStaging: RateTable;
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManualStaging = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2093-03-28&#x27;</span>),
        <span class="hljs-attr">status</span>: Status.STAGING,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;first_american&#x27;</span> },
        },
      },
    });
    tmpRateTableStaging = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASICSTATUSTESTSTAGE&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: tmpRateManulStagingFlatRate,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManualStaging.id,
      },
    });
    tmpPolicyRateStaging = <span class="hljs-keyword">await</span> createTestPolicyRate(
      tmpRateManualStaging,
      tmpRateTableStaging,
      {
        <span class="hljs-attr">policyType</span>: <span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>,
        <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
        <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;stagingtestratetype-this-is-the-staging-one&#x27;</span>,
        <span class="hljs-attr">transactionType</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test policy rate&#x27;</span>,
        <span class="hljs-attr">insuranceAmountRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">oldLoanAgeRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">crrOrdersRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">propertyType</span>: PropertyType.RESIDENTIAL,
      }
    );
    tmpRateManualProd = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&#x27;2093-01-28&#x27;</span>),
        <span class="hljs-attr">status</span>: Status.PROD,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;first_american&#x27;</span> },
        },
      },
    });
    tmpRateTableProd = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;BASICSTATUSTESTPROD&#x27;</span>,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: tmpRateManulProdFlatRate,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManualProd.id,
      },
    });
    tmpPolicyRateProd = <span class="hljs-keyword">await</span> createTestPolicyRate(
      tmpRateManualProd,
      tmpRateTableProd,
      {
        <span class="hljs-attr">policyType</span>: <span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>,
        <span class="hljs-attr">policyCategory</span>: PolicyCategory.LENDER,
        <span class="hljs-attr">rateType</span>: <span class="hljs-string">&#x27;stagingtestratetype-this-is-the-prod-one&#x27;</span>,
        <span class="hljs-attr">transactionType</span>: <span class="hljs-string">&#x27;PURCHASE&#x27;</span>,
        <span class="hljs-attr">insuranceAmountRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">oldLoanAgeRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">crrOrdersRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">propertyType</span>: PropertyType.RESIDENTIAL,
        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;test policy rate&#x27;</span>,
      }
    );
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpPolicyRateProd) {
      <span class="hljs-keyword">await</span> prisma.policyRate.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpPolicyRateProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTableProd) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTableProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManualProd) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManualProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpPolicyRateStaging) {
      <span class="hljs-keyword">await</span> prisma.policyRate.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpPolicyRateStaging.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTableStaging) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTableStaging.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManualStaging) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManualStaging.id },
      });
    }
  });
  it(<span class="hljs-string">&#x27;returns only rate types for PROD rate manuals by default&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2099-01-01T00:00:00.000Z&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes[<span class="hljs-number">0</span>].label).toEqual(
      <span class="hljs-string">&#x27;Stagingtestratetype-this-is-the-prod-one&#x27;</span>
    );
  });
  it(<span class="hljs-string">&#x27;returns rate types for STAGING rate manuals when includeStagingRates=true&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">agentID</span>: faker.random.alphaNumeric(<span class="hljs-number">5</span>),
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">includeStagingRates</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">property</span>: {
          <span class="hljs-attr">address</span>: {
            <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
          },
        },
        <span class="hljs-attr">policyFormNames</span>: [<span class="hljs-string">&#x27;ALTA_LOAN&#x27;</span>],
        <span class="hljs-attr">rateEffectiveDate</span>: <span class="hljs-string">&#x27;2099-01-01T00:00:00.000Z&#x27;</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: RATE_TYPES_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.rateTypes[<span class="hljs-number">0</span>].rateTypes[<span class="hljs-number">0</span>].label).toEqual(
      <span class="hljs-string">&#x27;Stagingtestratetype-this-is-the-staging-one&#x27;</span>
    );
  });
});

describe(<span class="hljs-string">&#x27;Graph / Queries / TestRateConfiguration&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">let</span> tmpRateManualProd: RateManual;
  <span class="hljs-keyword">let</span> tmpRateManualProd2022: RateManual;
  <span class="hljs-keyword">let</span> tmpRateTableProd: RateTable;
  <span class="hljs-keyword">let</span> tmpRateTableProd2022: RateTable;
  <span class="hljs-keyword">const</span> tmpRateManulProdFlatRate = <span class="hljs-number">444</span>;
  <span class="hljs-keyword">const</span> tmpRateManulProdFlatRate2022 = <span class="hljs-number">2022</span>;
  <span class="hljs-keyword">const</span> rateEffectiveDate2021 = <span class="hljs-string">&#x27;2021-05-21T07:00:00.000Z&#x27;</span>;
  <span class="hljs-keyword">const</span> rateEffectiveDate2022 = <span class="hljs-string">&#x27;2022-05-21T07:00:00.000Z&#x27;</span>;

  <span class="hljs-comment">// We use the same rate table name for multiple effective dates</span>
  <span class="hljs-comment">// to verify that the correct rate table is selected.</span>
  <span class="hljs-keyword">const</span> sharedRateTableName = <span class="hljs-string">&#x27;BASICSTATUSTESTPROD&#x27;</span>;

  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
    tmpRateManualProd = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(rateEffectiveDate2021),
        <span class="hljs-attr">status</span>: Status.PROD,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;first_american&#x27;</span> },
        },
      },
    });
    tmpRateTableProd = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: sharedRateTableName,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: tmpRateManulProdFlatRate,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManualProd.id,
      },
    });
    tmpRateManualProd2022 = <span class="hljs-keyword">await</span> prisma.rateManual.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(rateEffectiveDate2022),
        <span class="hljs-attr">status</span>: Status.PROD,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">connect</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;first_american&#x27;</span> },
        },
      },
    });
    tmpRateTableProd2022 = <span class="hljs-keyword">await</span> prisma.rateTable.create({
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">name</span>: sharedRateTableName,
        <span class="hljs-attr">tiers</span>: [
          {
            <span class="hljs-attr">lowerBound</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">upperBound</span>: -<span class="hljs-number">1</span>,
            <span class="hljs-attr">tierType</span>: <span class="hljs-string">&#x27;FIXED&#x27;</span>,
            <span class="hljs-attr">flatRate</span>: tmpRateManulProdFlatRate2022,
          },
        ],
        <span class="hljs-attr">rateManualId</span>: tmpRateManualProd2022.id,
      },
    });
  });

  afterAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (tmpRateTableProd) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTableProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManualProd) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManualProd.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateTableProd2022) {
      <span class="hljs-keyword">await</span> prisma.rateTable.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateTableProd2022.id },
      });
    }
    <span class="hljs-keyword">if</span> (tmpRateManualProd2022) {
      <span class="hljs-keyword">await</span> prisma.rateManual.delete({
        <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: tmpRateManualProd2022.id },
      });
    }
  });

  it(<span class="hljs-string">&#x27;Returns total premium when testing a rate configuration&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> variables = {
      <span class="hljs-attr">input</span>: {
        <span class="hljs-attr">rateTableId</span>: tmpRateTableProd.id,
        <span class="hljs-attr">formula</span>: <span class="hljs-string">&#x27;STANDARD&#x27;</span>,
        <span class="hljs-attr">rateTableDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">rateTypeDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">policyDiscount</span>: <span class="hljs-number">1.1</span>,
        <span class="hljs-attr">reissueDiscount</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">minPremium</span>: <span class="hljs-number">150</span>,
        <span class="hljs-attr">insuranceAmountRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">oldLoanAgeRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">premiumRounding</span>: <span class="hljs-string">&#x27;TO_NEAREST_CENT&#x27;</span>,
        <span class="hljs-attr">discountRounding</span>: <span class="hljs-string">&#x27;TO_NEAREST_CENT&#x27;</span>,
        <span class="hljs-attr">crrOrdersRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
        <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
        <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
        <span class="hljs-attr">testCoverageAmount</span>: <span class="hljs-number">212123</span>,
        <span class="hljs-attr">rateEffectiveDate</span>: rateEffectiveDate2021,
        <span class="hljs-attr">testOldLoanAmount</span>: <span class="hljs-number">0</span>,
      },
    };

    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: TEST_RATE_CONFIGURATION_QUERY,
        variables,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.testRateConfiguration.totalPremium).toEqual(<span class="hljs-number">488.4</span>);
  });

  it(<span class="hljs-string">&#x27;Calculates premium using the correct rate table, even if two rate tables with different rate effective dates have the same name&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> sharedInputVariables = {
      <span class="hljs-attr">formula</span>: <span class="hljs-string">&#x27;STANDARD&#x27;</span>,
      <span class="hljs-attr">rateTableDiscount</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">rateTypeDiscount</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">policyDiscount</span>: <span class="hljs-number">1.1</span>,
      <span class="hljs-attr">reissueDiscount</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">minPremium</span>: <span class="hljs-number">150</span>,
      <span class="hljs-attr">insuranceAmountRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
      <span class="hljs-attr">oldLoanAgeRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
      <span class="hljs-attr">premiumRounding</span>: <span class="hljs-string">&#x27;TO_NEAREST_CENT&#x27;</span>,
      <span class="hljs-attr">discountRounding</span>: <span class="hljs-string">&#x27;TO_NEAREST_CENT&#x27;</span>,
      <span class="hljs-attr">crrOrdersRange</span>: [<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>],
      <span class="hljs-attr">state</span>: <span class="hljs-string">&#x27;CO&#x27;</span>,
      <span class="hljs-attr">underwriter</span>: <span class="hljs-string">&#x27;first_american&#x27;</span>,
      <span class="hljs-attr">testCoverageAmount</span>: <span class="hljs-number">212123</span>,
      <span class="hljs-attr">testOldLoanAmount</span>: <span class="hljs-number">0</span>,
    };

    <span class="hljs-comment">// Rate table ID and rate effective date are the only differences</span>
    <span class="hljs-comment">// between the two requests in this test.</span>
    <span class="hljs-keyword">const</span> variables2022 = {
      <span class="hljs-attr">input</span>: {
        ...sharedInputVariables,
        <span class="hljs-attr">rateTableId</span>: tmpRateTableProd2022.id,
        <span class="hljs-attr">rateEffectiveDate</span>: rateEffectiveDate2022,
      },
    };

    <span class="hljs-keyword">const</span> variables2021 = {
      <span class="hljs-attr">input</span>: {
        ...sharedInputVariables,
        <span class="hljs-attr">rateTableId</span>: tmpRateTableProd.id,
        <span class="hljs-attr">rateEffectiveDate</span>: rateEffectiveDate2021,
      },
    };

    <span class="hljs-keyword">const</span> queryResult022 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: TEST_RATE_CONFIGURATION_QUERY,
        <span class="hljs-attr">variables</span>: variables2022,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult022.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult022.data.testRateConfiguration.totalPremium).toEqual(
      <span class="hljs-number">2224.2</span>
    );

    <span class="hljs-keyword">const</span> queryResult2021 = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: TEST_RATE_CONFIGURATION_QUERY,
        <span class="hljs-attr">variables</span>: variables2021,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult2021.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult2021.data.testRateConfiguration.totalPremium).toEqual(
      <span class="hljs-number">488.4</span>
    );
  });
});

</code></pre>
<h4 id=/resolvers/queries/__tests__/viewer.test.ts anchor=true>/resolvers/queries/<strong>tests</strong>/viewer.test.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { gql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/core&#x27;</span>;
<span class="hljs-keyword">import</span> faker <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@faker-js/faker&#x27;</span>;
<span class="hljs-keyword">import</span> { ExpressContext } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> {
  generateExecuteOperationContext,
  NoServerDataError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../../testing/helpers&#x27;</span>;
<span class="hljs-keyword">import</span> { getApolloServerInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../server&#x27;</span>;
<span class="hljs-keyword">import</span> { OrganizationUser } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../interfaces&#x27;</span>;

<span class="hljs-keyword">const</span> expectedOrgId = faker.random.alphaNumeric(<span class="hljs-number">12</span>);
jest.mock(<span class="hljs-string">`../../../authChecker`</span>, <span class="hljs-function">() =&gt;</span> ({
  ...jest.requireActual(<span class="hljs-string">`../../../authChecker`</span>),
  <span class="hljs-attr">validateBasicAuthToken</span>: <span class="hljs-keyword">async</span> (): <span class="hljs-built_in">Promise</span>&lt;OrganizationUser&gt; =&gt; {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">orgId</span>: expectedOrgId,
      <span class="hljs-attr">access</span>: [],
      <span class="hljs-attr">isAuthenticated</span>: <span class="hljs-literal">true</span>,
    };
  },
}));

describe(<span class="hljs-string">&#x27;Graph / Queries / Viewer&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  beforeAll(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> getApolloServerInstance();
  });

  it(<span class="hljs-string">&#x27;returns viewer details upon request&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
    <span class="hljs-keyword">const</span> queryResult = <span class="hljs-keyword">await</span> server.executeOperation(
      {
        <span class="hljs-attr">query</span>: gql<span class="hljs-string">`
          query viewer {
            viewer {
              orgId
            }
          }
        `</span>,
      },
      generateExecuteOperationContext() <span class="hljs-keyword">as</span> ExpressContext
    );

    <span class="hljs-keyword">if</span> (!queryResult.data) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NoServerDataError();
    }

    expect(queryResult.data.viewer.orgId).toBeTruthy();
    expect(queryResult.data.viewer.orgId).toEqual(expectedOrgId);
  });
});

</code></pre>
<h4 id=/resolvers/queries/fees.ts anchor=true>/resolvers/queries/fees.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Query, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { readRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;
<span class="hljs-keyword">import</span> { FeesInput, FeesPayload } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> { getFeesResolverResult } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../helpers/fees&#x27;</span>;

<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesQuery</span> </span>{
  <span class="hljs-meta">@Authorized</span>(readRoles)
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> [FeesPayload], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Compute fees for the given transaction and documents.&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> fees(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-function">() =&gt;</span> FeesInput)
    <span class="hljs-attr">input</span>: FeesInput,
    <span class="hljs-meta">@Ctx</span>()
    <span class="hljs-attr">context</span>: Context
  ): <span class="hljs-built_in">Promise</span>&lt;[FeesPayload]&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> getFeesResolverResult(input, context);
  }
}

</code></pre>
<h4 id=/resolvers/queries/index.ts anchor=true>/resolvers/queries/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { RateManualQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rateManual&#x27;</span>;
<span class="hljs-keyword">import</span> { ViewerQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./viewer&#x27;</span>;
<span class="hljs-keyword">import</span> { RatesQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rates&#x27;</span>;
<span class="hljs-keyword">import</span> { FeesQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./fees&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> resolvers = [
  ViewerQuery,
  RatesQuery,
  RateManualQuery,
  FeesQuery,
] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

</code></pre>
<h4 id=/resolvers/queries/rateManual.ts anchor=true>/resolvers/queries/rateManual.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { prisma } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../db&#x27;</span>;
<span class="hljs-keyword">import</span> {
  Ctx,
  Authorized,
  Query,
  Resolver,
  FieldResolver,
  Root,
  Arg,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> {
  CplRate,
  EndorsementRate,
  EndorsementShortRate,
  PolicyRate,
  RateManual,
  RateTable,
  RateTableScalarWhereInput,
  StateType,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../generated/type-graphql&#x27;</span>;

<span class="hljs-keyword">import</span> {
  PolicyRateOrderByInput,
  EndorsementRateOrderByInput,
  EndorsementShortRateOrderByInput,
  CPLRateOrderByInput,
  RateTableOrderByInput,
  RateManualOrderByInput,
  RateManualSummary,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;

<span class="hljs-meta">@Resolver</span>(<span class="hljs-function">() =&gt;</span> RateManual)
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateManualQuery</span> </span>{
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> [RateManual], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// If request is not authorized, will return null.</span>
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;A resolver for returning rate manuals&#x27;</span>,
  })
  rateManuals(
    <span class="hljs-meta">@Ctx</span>() ctx: Context,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;underwriter&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) underwriter: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;state&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) state: StateType,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) orderBy: RateManualOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;RateManual[] | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-comment">// Returns a list of all rate manuals available to this user</span>
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access.map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">return</span> prisma.rateManual.findMany({
      take,
      skip,
      orderBy,
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: underwriter },
        state,
        <span class="hljs-attr">underwriterId</span>: {
          <span class="hljs-attr">in</span>: allowedUnderwriters,
        },
      },
      <span class="hljs-attr">select</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">state</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">underwriter</span>: {
          <span class="hljs-attr">select</span>: {
            <span class="hljs-attr">id</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">config</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">updatedAt</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">createdAt</span>: <span class="hljs-literal">true</span>,
          },
        },
        <span class="hljs-attr">underwriterId</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">updatedAt</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">createdAt</span>: <span class="hljs-literal">true</span>,
      },
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> [RateManual], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// If request is not authorized, will return null.</span>
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Rate manuals grouped by state&#x27;</span>,
  })
  rateManualStates(
    <span class="hljs-meta">@Ctx</span>() ctx: Context,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;underwriter&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) underwriter: <span class="hljs-built_in">string</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) orderBy: RateManualOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;RateManual[] | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access.map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">return</span> prisma.rateManual.findMany({
      take,
      skip,
      <span class="hljs-attr">orderBy</span>: { <span class="hljs-attr">effectiveDate</span>: <span class="hljs-string">&#x27;desc&#x27;</span> },
      <span class="hljs-attr">distinct</span>: [<span class="hljs-string">&#x27;state&#x27;</span>],
      <span class="hljs-attr">select</span>: {
        <span class="hljs-attr">id</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">state</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">effectiveDate</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">underwriterId</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">updatedAt</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">createdAt</span>: <span class="hljs-literal">true</span>,
      },
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">underwriter</span>: { <span class="hljs-attr">name</span>: underwriter },
        <span class="hljs-attr">underwriterId</span>: {
          <span class="hljs-attr">in</span>: allowedUnderwriters,
        },
      },
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> RateManualSummary, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// If request is not authorized, will return null.</span>
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;A resolver for returning a single rate manual&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> rateManual(
    <span class="hljs-meta">@Ctx</span>() ctx: Context,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;id&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">false</span> }) id: <span class="hljs-built_in">string</span>
  ): <span class="hljs-built_in">Promise</span>&lt;RateManualSummary | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-comment">// Returns a single rate manual if found and available to this user</span>
    <span class="hljs-keyword">const</span> allowedUnderwriters = ctx.orgUser.access.map(<span class="hljs-function">(<span class="hljs-params">a</span>) =&gt;</span> a.underwriterId);
    <span class="hljs-keyword">const</span> rateManual = <span class="hljs-keyword">await</span> prisma.rateManual.findFirst({
      <span class="hljs-attr">where</span>: {
        id,
        <span class="hljs-attr">underwriterId</span>: {
          <span class="hljs-attr">in</span>: allowedUnderwriters,
        },
      },
    });
    <span class="hljs-keyword">if</span> (!rateManual) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> policyRatesCount = <span class="hljs-keyword">await</span> prisma.policyRate.count({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: id },
    });
    <span class="hljs-keyword">const</span> endorsementRatesCount = <span class="hljs-keyword">await</span> prisma.endorsementRate.count({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: id },
    });
    <span class="hljs-keyword">const</span> endorsementShortRatesCount = <span class="hljs-keyword">await</span> prisma.endorsementShortRate.count({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: id },
    });
    <span class="hljs-keyword">const</span> rateTablesCount = <span class="hljs-keyword">await</span> prisma.rateTable.count({
      <span class="hljs-attr">where</span>: { <span class="hljs-attr">rateManualId</span>: id },
    });
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.assign({}, rateManual, {
      policyRatesCount,
      endorsementRatesCount,
      endorsementShortRatesCount,
      rateTablesCount,
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@FieldResolver</span>(<span class="hljs-function">() =&gt;</span> [RateTable])
  rateTables(
    <span class="hljs-meta">@Root</span>() rateManual: RateManual,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;where&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) where: RateTableScalarWhereInput,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) orderBy: RateTableOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;RateTable[]&gt; {
    <span class="hljs-keyword">return</span> prisma.rateTable.findMany({
      take,
      skip,
      orderBy,
      <span class="hljs-attr">where</span>: {
        ...where,
        <span class="hljs-attr">rateManualId</span>: rateManual.id,
      },
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@FieldResolver</span>(<span class="hljs-function">() =&gt;</span> [PolicyRate])
  policyRates(
    <span class="hljs-meta">@Root</span>() rateManual: RateManual,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) orderBy: PolicyRateOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;PolicyRate[]&gt; {
    <span class="hljs-keyword">return</span> prisma.policyRate.findMany({
      take,
      skip,
      orderBy,
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">rateManualId</span>: rateManual.id,
      },
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@FieldResolver</span>(<span class="hljs-function">() =&gt;</span> [EndorsementRate])
  endorsementRates(
    <span class="hljs-meta">@Root</span>() rateManual: RateManual,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) orderBy: EndorsementRateOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;EndorsementRate[]&gt; {
    <span class="hljs-keyword">return</span> prisma.endorsementRate.findMany({
      <span class="hljs-attr">take</span>: take,
      <span class="hljs-attr">skip</span>: skip,
      <span class="hljs-attr">orderBy</span>: orderBy,
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">rateManualId</span>: rateManual.id,
      },
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@FieldResolver</span>(<span class="hljs-function">() =&gt;</span> [EndorsementShortRate])
  endorsementShortRates(
    <span class="hljs-meta">@Root</span>() rateManual: RateManual,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
    <span class="hljs-attr">orderBy</span>: EndorsementShortRateOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;EndorsementShortRate[]&gt; {
    <span class="hljs-keyword">return</span> prisma.endorsementShortRate.findMany({
      <span class="hljs-attr">take</span>: take,
      <span class="hljs-attr">skip</span>: skip,
      <span class="hljs-attr">orderBy</span>: orderBy,
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">rateManualId</span>: rateManual.id,
      },
    });
  }

  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@FieldResolver</span>(<span class="hljs-function">() =&gt;</span> [CplRate])
  cplRates(
    <span class="hljs-meta">@Root</span>() rateManual: RateManual,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;skip&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) skip: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;take&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) take: <span class="hljs-built_in">number</span>,
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;orderBy&#x27;</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> }) orderBy: CPLRateOrderByInput
  ): <span class="hljs-built_in">Promise</span>&lt;CplRate[]&gt; {
    <span class="hljs-keyword">return</span> prisma.cplRate.findMany({
      take,
      skip,
      orderBy,
      <span class="hljs-attr">where</span>: {
        <span class="hljs-attr">rateManualId</span>: rateManual.id,
      },
    });
  }
}

</code></pre>
<h4 id=/resolvers/queries/rates.ts anchor=true>/resolvers/queries/rates.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Arg, Authorized, Ctx, Query, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { readRoles } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../authChecker&#x27;</span>;
<span class="hljs-keyword">import</span> {
  RatesInput,
  RatesPayload,
  RateTypesInput,
  RateTypesPayload,
  TestPolicyRateInput,
  TestRateConfigurationResponse,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types&#x27;</span>;
<span class="hljs-keyword">import</span> {
  getConfigurationTestResult,
  getRatesResolverResult,
  getRateTypesResolverResult,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../helpers/rates&#x27;</span>;

<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesQuery</span> </span>{
  <span class="hljs-meta">@Authorized</span>(readRoles)
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> RatesPayload, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Compute rates for the given transaction and documents.&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> rates(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-function">() =&gt;</span> RatesInput)
    <span class="hljs-attr">input</span>: RatesInput,
    <span class="hljs-meta">@Ctx</span>()
    <span class="hljs-attr">context</span>: Context
  ): <span class="hljs-built_in">Promise</span>&lt;RatesPayload | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> getRatesResolverResult(input, context);
  }

  <span class="hljs-meta">@Authorized</span>(readRoles)
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> [RateTypesPayload], {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Get rate types&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> rateTypes(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-function">() =&gt;</span> RateTypesInput)
    <span class="hljs-attr">input</span>: RateTypesInput,
    <span class="hljs-meta">@Ctx</span>()
    <span class="hljs-attr">context</span>: Context
  ): <span class="hljs-built_in">Promise</span>&lt;[RateTypesPayload] | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> getRateTypesResolverResult(input, context);
  }

  <span class="hljs-meta">@Authorized</span>(readRoles)
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> TestRateConfigurationResponse, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Test a rate configuration&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> testRateConfiguration(
    <span class="hljs-meta">@Arg</span>(<span class="hljs-string">&#x27;input&#x27;</span>) input: TestPolicyRateInput,
    <span class="hljs-meta">@Ctx</span>() context: Context
  ): <span class="hljs-built_in">Promise</span>&lt;TestRateConfigurationResponse&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> getConfigurationTestResult(input, context);
  }
}

</code></pre>
<h4 id=/resolvers/queries/viewer.ts anchor=true>/resolvers/queries/viewer.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Authorized, Ctx, Query, Resolver } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../context&#x27;</span>;
<span class="hljs-keyword">import</span> { Viewer } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../types/viewer&#x27;</span>;

<span class="hljs-meta">@Resolver</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewerQuery</span> </span>{
  <span class="hljs-meta">@Authorized</span>()
  <span class="hljs-meta">@Query</span>(<span class="hljs-function">() =&gt;</span> Viewer, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// If request is not authorized, will return null.</span>
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;A simple reflection resolver for the user calling the API&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> viewer(<span class="hljs-meta">@Ctx</span>() ctx: Context): <span class="hljs-built_in">Promise</span>&lt;Viewer | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Viewer(ctx.orgUser.orgId);
  }
}

</code></pre>
<h4 id=/server.ts anchor=true>/server.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
  ApolloServerPluginDrainHttpServer,
  ApolloServerPluginLandingPageGraphQLPlayground,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-core&#x27;</span>;
<span class="hljs-keyword">import</span> { ApolloServer } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;apollo-server-express&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;reflect-metadata&#x27;</span>;
<span class="hljs-keyword">import</span> { buildSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { getEnvironment } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../environment&#x27;</span>;
<span class="hljs-keyword">import</span> { logger } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../logger&#x27;</span>;
<span class="hljs-keyword">import</span> { authChecker } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./authChecker&#x27;</span>;
<span class="hljs-keyword">import</span> context <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./context&#x27;</span>;
<span class="hljs-keyword">import</span> { registerEnums } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./enums&#x27;</span>;
<span class="hljs-keyword">import</span> {
  LoggingPlugin,
  PrometheusTimingPlugin,
  ErrorFormattingPlugin,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./plugins&#x27;</span>;
<span class="hljs-keyword">import</span> { resolvers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./resolvers&#x27;</span>;
<span class="hljs-keyword">import</span> { getRegistryInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../registry&#x27;</span>;
<span class="hljs-keyword">import</span> { app } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../rest&#x27;</span>;
<span class="hljs-keyword">import</span> { exampleTabs } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./plugins/examples&#x27;</span>;
<span class="hljs-keyword">import</span> { promisify } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;util&#x27;</span>;
<span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http&#x27;</span>;

<span class="hljs-keyword">let</span> serverSingleton: ApolloServer | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">let</span> httpServerSingleton: http.Server | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">const</span> getHttpServerInstance = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">if</span> (httpServerSingleton) {
    <span class="hljs-keyword">return</span> httpServerSingleton;
  }

  <span class="hljs-keyword">const</span> httpServer = http.createServer(app);
  httpServerSingleton = httpServer;
  <span class="hljs-keyword">return</span> httpServerSingleton;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getApolloServerInstance</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (serverSingleton) {
    <span class="hljs-keyword">return</span> serverSingleton;
  }

  registerEnums();
  <span class="hljs-keyword">const</span> httpServer = <span class="hljs-keyword">await</span> getHttpServerInstance();

  <span class="hljs-keyword">const</span> schema = <span class="hljs-keyword">await</span> buildSchema({
    resolvers,
    <span class="hljs-attr">emitSchemaFile</span>: <span class="hljs-literal">true</span>,
    authChecker,
    <span class="hljs-attr">authMode</span>: <span class="hljs-string">&#x27;error&#x27;</span>,
    <span class="hljs-attr">globalMiddlewares</span>: [],
  });

  <span class="hljs-keyword">const</span> registry = getRegistryInstance();

  serverSingleton = <span class="hljs-keyword">new</span> ApolloServer({
    schema,
    context,
    <span class="hljs-attr">introspection</span>: getEnvironment().introspection.enabled,
    <span class="hljs-attr">csrfPrevention</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">plugins</span>: [
      ...(getEnvironment().playground.enabled
        ? [
            ApolloServerPluginLandingPageGraphQLPlayground({
              <span class="hljs-attr">tabs</span>: <span class="hljs-keyword">await</span> exampleTabs(),
            }),
          ]
        : []),
      LoggingPlugin,
      PrometheusTimingPlugin(registry),
      ErrorFormattingPlugin(),
      ApolloServerPluginDrainHttpServer({ httpServer }),
    ],
  });

  <span class="hljs-keyword">return</span> serverSingleton;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> startServer = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
  <span class="hljs-keyword">await</span> server.start();
  server.applyMiddleware({
    app,
    <span class="hljs-attr">cors</span>: { <span class="hljs-attr">origin</span>: getEnvironment().cors.host },
    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,
  });
  <span class="hljs-keyword">const</span> httpServer = <span class="hljs-keyword">await</span> getHttpServerInstance();
  <span class="hljs-keyword">await</span> promisify(
    <span class="hljs-comment">// Docker in non-linux environments doesn&#x27;t support IPv6, so we bind on global IPv4 instead.</span>
    httpServer.listen.bind(httpServer, {
      <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,
      <span class="hljs-attr">port</span>: getEnvironment().server.port,
    })
  )();
  logger.info(
    <span class="hljs-string">`Server ready at http://localhost:<span class="hljs-subst">${getEnvironment().server.port}</span> 🚀`</span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> stopServer = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">await</span> getApolloServerInstance();
  <span class="hljs-keyword">await</span> server.stop();
};

</code></pre>
<h4 id=/types/cplRate.ts anchor=true>/types/cplRate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { InputType, ObjectType, Field } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GQL } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;
<span class="hljs-keyword">import</span> { ProtectedParty } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../generated/type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLMoney } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./scalars&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Money } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utilities&#x27;</span>;
<span class="hljs-keyword">import</span> { CplRateSource } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CPLRateMutationFields</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> ProtectedParty)
  protectedParty!: ProtectedParty;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateSource?: CplRateSource;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  flatRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateTableId?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateCPLRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CPLRateMutationFields</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateCPLRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CPLRateMutationFields</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  rateManualId!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The payload returned from the CPL Rate mutation.&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MutateCPLRateResponse</span> </span>{
  <span class="hljs-meta">@Field</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;status of the mutation&#x27;</span> })
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>;
}

</code></pre>
<h4 id=/types/endorsementRate.ts anchor=true>/types/endorsementRate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { InputType, ObjectType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GQL } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;
<span class="hljs-keyword">import</span> { PolicyType, PropertyType, RateSource } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLMoney } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./scalars&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Money } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utilities&#x27;</span>;

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The shared payload accepted by endorsement rate mutation.&#x27;</span>,
})
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EndorsementRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Optional =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateType?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  propertyType?: PropertyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  ownerFlatRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  ownerDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  ownerMinimumFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  ownerMaximumFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  lenderFlatRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  lenderDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  lenderMinimumFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  lenderMaximumFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  cltaOwnerFlatFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  cltaOwnerDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  cltaLenderFlatFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  cltaLenderDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyPremiumDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  insuranceAmountDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  lenderSimultaneous?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  ownerSimultaneous?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  county?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  baseRateTableId?: <span class="hljs-built_in">string</span>;
}
<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&#x27;The shared payload accepted by endorsement short rate mutation.&#x27;</span>,
})
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EndorsementShortRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Optional =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateType?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  propertyType?: PropertyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyType?: PolicyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  county?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateSource?: RateSource;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  flatRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  discount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  simultaneousFlatRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  insuranceAmountDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateTablePremiumDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyPremiumDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  baseRateTableId?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  minimumFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  maximumFee?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  description?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateEndorsementRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EndorsementRateMutationFields</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  endorsementId?: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateEndorsementRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EndorsementRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  rateManualId!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  endorsementId!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateEndorsementShortRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EndorsementShortRateMutationFields</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  endorsementId?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateEndorsementShortRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EndorsementShortRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  rateManualId!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>])
  endorsementId!: <span class="hljs-built_in">string</span>[];
}

<span class="hljs-meta">@ObjectType</span>({
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&#x27;The payload returned from the update endorsement rate mutation.&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MutateEndorsementRateResponse</span> </span>{
  <span class="hljs-meta">@GQL</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;status of the mutation&#x27;</span> })
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>;
}

</code></pre>
<h4 id=/types/fees.ts anchor=true>/types/fees.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { RatesInputProperty, RatesInputSecondaryApiParams } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rates&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLMoney } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./scalars&#x27;</span>;
<span class="hljs-keyword">import</span> { ObjectType, GQL, ID, InputType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;

<span class="hljs-keyword">import</span> { PolicyCategory, PolicyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../generated/type-graphql/&#x27;</span>;
<span class="hljs-keyword">import</span> { Purpose, purposesGraphQLEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;.&#x27;</span>;

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeeInternal</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeAmount?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeCode?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeDescription?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeType?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  KYTaxID?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesInputInternal</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeAmount?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeCode?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeDescription?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  FeeType?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  KYTaxID?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesInputEndorsementTax</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  name?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  taxPrice?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesInputFee</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  id?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  allowOverride?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  charge!: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  required!: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  description!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  howToDisclose!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> FeesInputInternal, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  internal?: FeesInputInternal;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  paidTo!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  price!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  municipality?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  calculatedMunicipality?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [FeesInputEndorsementTax], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  endorsementTaxes?: FeesInputEndorsementTax[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  calculatedPrice?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  isInternalFee?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  attachedTo?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  effectiveCalculatorDate?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesInputPolicy</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> ID, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;An arbitrary ID to identify this policy. Returned rates will have a matching ID.&#x27;</span>,
  })
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> PolicyCategory, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The category of the policy.&#x27;</span>,
  })
  policyCategory!: PolicyCategory;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The selected form to issue.&#x27;</span>,
  })
  policyFormName!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The effective date of the policy.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  rateEffectiveDate?: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The previously calculated premium.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  policyPremium?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [FeesInputFee], {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A stringified JSON object containing fee data, allowing for flexible input structure.&#x27;</span>,
  })
  fees!: FeesInputFee[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> FeesInputInternal, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A stringified JSON object that contains fee data from undertaker.  Originally implemented as a black box object for storing any undertaker outputs.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  internal?: FeesInputInternal;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesInputCPL</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Total premium for the CPL&#x27;</span>,
  })
  premiumTotal!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Underwriter premium for the CPL.&#x27;</span>,
  })
  underwriterPremium!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Agent premium for the CPL.&#x27;</span>,
  })
  agentPremium!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;ID of the CPL.&#x27;</span>,
  })
  cplID!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  issuedCplID!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  protectedPartyType!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  charge!: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesInput</span> </span>{
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Deprecate all fields below except for requestBlackBox when hotfix is released.</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputProperty, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  property?: RatesInputProperty;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [FeesInputPolicy], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policies?: FeesInputPolicy[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputProperty, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  settlementAgencyAddress?: RatesInputProperty;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputProperty, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  titleCompanyAddress?: RatesInputProperty;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [FeesInputCPL], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  cpls?: FeesInputCPL[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  integrationEnabled?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  underwriter?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  assureURL?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputSecondaryApiParams, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  secondaryApiParams?: RatesInputSecondaryApiParams;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> purposesGraphQLEnum, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  purpose?: Purpose;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;This can be used as a black box field to forward request payloads to Undertaker&#x27;</span>,
  })
  requestBlackBox?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FeesPayload</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> PolicyType, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyFormName?: PolicyType;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [Fee], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  fees?: [Fee];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;This can be used as a black box field to forward response payloads from Undertaker&#x27;</span>,
  })
  responseBlackBox?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fee</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  allowOverride!: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  charge!: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  required!: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  description!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  howToDisclose!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> FeeInternal, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  internal?: FeeInternal;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  paidTo!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>)
  price!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  municipality?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  attachedTo?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  effectiveCalculatorDate?: <span class="hljs-built_in">string</span>;
}

</code></pre>
<h4 id=/types/index.ts anchor=true>/types/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./issued-document&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rates&#x27;</span>;

<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rateManual&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./cplRate&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./policyRate&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./endorsementRate&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./rateTable&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./fees&#x27;</span>;

<span class="hljs-keyword">export</span> { Viewer } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./viewer&#x27;</span>;

</code></pre>
<h4 id=/types/issued-document/addressee.ts anchor=true>/types/issued-document/addressee.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { is } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib/is&#x27;</span>;
<span class="hljs-keyword">import</span> { registerEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../type-graphql-decorators&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ALL_ADDRESSEE_TYPES = [<span class="hljs-string">&#x27;BORROWER&#x27;</span>, <span class="hljs-string">&#x27;LENDER&#x27;</span>, <span class="hljs-string">&#x27;SELLER&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addresseeTypes: Record&lt;AddresseeType, <span class="hljs-built_in">string</span>&gt; = {
  <span class="hljs-attr">BORROWER</span>: <span class="hljs-string">&#x27;Borrower&#x27;</span>,
  <span class="hljs-attr">LENDER</span>: <span class="hljs-string">&#x27;Lender&#x27;</span>,
  <span class="hljs-attr">SELLER</span>: <span class="hljs-string">&#x27;Seller&#x27;</span>,
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addresseeGraphQLEnum = registerEnum(addresseeTypes, {
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;AddresseeType&#x27;</span>,
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> AddresseeType = <span class="hljs-keyword">typeof</span> ALL_ADDRESSEE_TYPES[<span class="hljs-built_in">number</span>];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isAddressee = is.value(...ALL_ADDRESSEE_TYPES);

</code></pre>
<h4 id=/types/issued-document/index.ts anchor=true>/types/issued-document/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./addressee&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./shared-document-data&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./policy&#x27;</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./property-types&#x27;</span>;

</code></pre>
<h4 id=/types/issued-document/policy.ts anchor=true>/types/issued-document/policy.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { PolicyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { registerEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../type-graphql-decorators&#x27;</span>;
<span class="hljs-comment">// import { registerEnum } from &#x27;../type-graphql-decorators&#x27;;</span>

<span class="hljs-comment">// // <span class="hljs-doctag">TODO:</span> We should really just infer the policy category from the type, and not</span>
<span class="hljs-comment">// // let the client pass it separately.</span>
<span class="hljs-comment">// export const policyCategories = {</span>
<span class="hljs-comment">//   OWNER: &#x27;Owner&#x27;,</span>
<span class="hljs-comment">//   LENDER: &#x27;Lender&#x27;,</span>
<span class="hljs-comment">// } as const;</span>

<span class="hljs-comment">// export const policyCategoryGraphQLEnum = registerEnum(policyCategories, {</span>
<span class="hljs-comment">//   name: &#x27;PolicyCategoryEnum&#x27;,</span>
<span class="hljs-comment">// });</span>

<span class="hljs-keyword">export</span> { PolicyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> policyTypeGraphQLEnum = registerEnum(PolicyType, {
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;PolicyTypeGraphQLEnum&#x27;</span>,
});
<span class="hljs-comment">// // export type PolicyCategory = keyof typeof policyCategories;</span>

</code></pre>
<h4 id=/types/issued-document/property-types.ts anchor=true>/types/issued-document/property-types.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { registerEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../type-graphql-decorators&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> propertyTypesArray = [
  <span class="hljs-string">&#x27;RESIDENCE_ONE_TO_FOUR_FAMILIES&#x27;</span>,
  <span class="hljs-string">&#x27;CONDOMINIUM&#x27;</span>,
  <span class="hljs-string">&#x27;LAND_ONLY&#x27;</span>,
  <span class="hljs-string">&#x27;MANUFACTURED_HOME&#x27;</span>,
  <span class="hljs-string">&#x27;MOBILE_HOME&#x27;</span>,
  <span class="hljs-string">&#x27;MIXED_USE&#x27;</span>,
  <span class="hljs-string">&#x27;RESIDENCE_FIVE_PLUS_FAMILIES&#x27;</span>,
  <span class="hljs-string">&#x27;WETLANDS&#x27;</span>,
  <span class="hljs-string">&#x27;AGRICULTURAL_LAND&#x27;</span>,
  <span class="hljs-string">&#x27;NATIVE_AMERICAN_LANDS&#x27;</span>,
  <span class="hljs-string">&#x27;US_FISH_AND_WILDLIFE&#x27;</span>,
  <span class="hljs-string">&#x27;COMMERCIAL&#x27;</span>,
  <span class="hljs-string">&#x27;PLANNED_UNIT_DEVELOPMENT&#x27;</span>,
] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> PropertyType = <span class="hljs-keyword">typeof</span> propertyTypesArray[<span class="hljs-built_in">number</span>];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> propertyTypes: Record&lt;PropertyType, <span class="hljs-built_in">string</span>&gt; = {
  <span class="hljs-attr">RESIDENCE_ONE_TO_FOUR_FAMILIES</span>: <span class="hljs-string">&#x27;Residence (1-4 Families)&#x27;</span>,
  <span class="hljs-attr">CONDOMINIUM</span>: <span class="hljs-string">&#x27;Condominium&#x27;</span>,
  <span class="hljs-attr">LAND_ONLY</span>: <span class="hljs-string">&#x27;Land Only&#x27;</span>,
  <span class="hljs-attr">MANUFACTURED_HOME</span>: <span class="hljs-string">&#x27;Manufactured Home&#x27;</span>,
  <span class="hljs-attr">MOBILE_HOME</span>: <span class="hljs-string">&#x27;Mobile Home&#x27;</span>,
  <span class="hljs-attr">MIXED_USE</span>: <span class="hljs-string">&#x27;Mixed Use&#x27;</span>,
  <span class="hljs-attr">RESIDENCE_FIVE_PLUS_FAMILIES</span>: <span class="hljs-string">&#x27;Residence (5+ Families)&#x27;</span>,
  <span class="hljs-attr">WETLANDS</span>: <span class="hljs-string">&#x27;Wetlands&#x27;</span>,
  <span class="hljs-attr">AGRICULTURAL_LAND</span>: <span class="hljs-string">&#x27;Agricultural Land&#x27;</span>,
  <span class="hljs-attr">NATIVE_AMERICAN_LANDS</span>: <span class="hljs-string">&#x27;Native American Lands&#x27;</span>,
  <span class="hljs-attr">US_FISH_AND_WILDLIFE</span>: <span class="hljs-string">&#x27;U.S. Fish and Wildlife&#x27;</span>,
  <span class="hljs-attr">COMMERCIAL</span>: <span class="hljs-string">&#x27;Commercial&#x27;</span>,
  <span class="hljs-attr">PLANNED_UNIT_DEVELOPMENT</span>: <span class="hljs-string">&#x27;Planned Unit Development&#x27;</span>,
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> propertyTypesGraphQLEnum = registerEnum(propertyTypes, {
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;PropertyType&#x27;</span>,
});

</code></pre>
<h4 id=/types/issued-document/shared-document-data.ts anchor=true>/types/issued-document/shared-document-data.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { is } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../lib&#x27;</span>;
<span class="hljs-keyword">import</span> { registerEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../type-graphql-decorators&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ALL_PURPOSE_TYPES = [<span class="hljs-string">&#x27;PURCHASE&#x27;</span>, <span class="hljs-string">&#x27;REFINANCE&#x27;</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> purposes: Record&lt;Purpose, <span class="hljs-built_in">string</span>&gt; = {
  <span class="hljs-attr">PURCHASE</span>: <span class="hljs-string">&#x27;Purchase&#x27;</span>,
  <span class="hljs-attr">REFINANCE</span>: <span class="hljs-string">&#x27;Refinance&#x27;</span>,
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> InputPurpose = <span class="hljs-string">&#x27;Purchase&#x27;</span> | <span class="hljs-string">&#x27;Refinance&#x27;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Purpose = <span class="hljs-keyword">typeof</span> ALL_PURPOSE_TYPES[<span class="hljs-built_in">number</span>];
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPurpose = is.value(...ALL_PURPOSE_TYPES);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> purposesGraphQLEnum = registerEnum(purposes, { <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Purpose&#x27;</span> });

</code></pre>
<h4 id=/types/organizationType.ts anchor=true>/types/organizationType.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> organizationTypeEnum = {
  <span class="hljs-attr">UNDERWRITER</span>: <span class="hljs-string">&#x27;UNDERWRITER&#x27;</span>,
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> organizationTypes = [organizationTypeEnum.UNDERWRITER] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> OrganizationTypeType = keyof <span class="hljs-keyword">typeof</span> organizationTypeEnum;

</code></pre>
<h4 id=/types/policyRate.ts anchor=true>/types/policyRate.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { InputType, ObjectType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GQL } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;
<span class="hljs-keyword">import</span> {
  PolicyCategory,
  PolicyType,
  TransactionType,
  PropertyType,
  RoundingType,
  Formula,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLMoney } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./scalars&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { Money } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utilities&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { State } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../lib/title-rates/data-structures&#x27;</span>;

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The shared payload accepted by policy rate mutation.&#x27;</span>,
})
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PolicyRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Optional =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyType?: PolicyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateType?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyCategory?: PolicyCategory;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  transactionType?: TransactionType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  propertyType?: PropertyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">Number</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  crrOrdersRange?: <span class="hljs-built_in">number</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  priorPolicyType?: PolicyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  priorRateType?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  otherPolicyType?: PolicyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  otherRateType?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  county?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateTableDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateTypeDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  excessDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyAmountMin?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  additionalFeeAmount?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  additionalFeeDiscount?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  simultaneousPremium?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  simultaneousPremiumTableDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  simultaneousBasePremiumDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [GraphQLMoney], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  insuranceAmountRange?: Money[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  premiumRounding?: RoundingType;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  discountRounding?: RoundingType;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  minPremium?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">Number</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  oldLoanAgeRange?: <span class="hljs-built_in">number</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  reissueMinPremium?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  reissueDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateTableId?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  simultaneousRateTableId?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  reissueRateTableId?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  name?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  description?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  formula?: Formula;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  isCLR?: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdatePolicyRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PolicyRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreatePolicyRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PolicyRateMutationFields</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  rateManualId!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  name!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestPolicyRateInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PolicyRateMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  state!: State;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  underwriter!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  testCoverageAmount!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Date</span>)
  rateEffectiveDate!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  testOldLoanAmount!: Money;
}

<span class="hljs-meta">@ObjectType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The payload returned from the update policy rate mutation.&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MutatePolicyRateResponse</span> </span>{
  <span class="hljs-meta">@GQL</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;status of the mutation&#x27;</span> })
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>;
}

</code></pre>
<h4 id=/types/rateManual.ts anchor=true>/types/rateManual.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { InputType, ObjectType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GQL } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;
<span class="hljs-keyword">import</span> { Status, Prisma, StateType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@prisma/client&#x27;</span>;
<span class="hljs-keyword">import</span> { RateManual } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../generated/type-graphql&#x27;</span>;

<span class="hljs-meta">@ObjectType</span>({
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&#x27;The payload returned from the update rate manual meta mutation.&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateRateManualMetaResponse</span> </span>{
  <span class="hljs-meta">@GQL</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;status of the update&#x27;</span> })
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The payload accepted by update rate manual meta mutation.&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateRateManualMetaInput</span> </span>{
  <span class="hljs-meta">@GQL</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;rate manual id&#x27;</span> })
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  underwriter!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Date</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;update effective date&#x27;</span>, <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  effectiveDate?: <span class="hljs-built_in">Date</span> | <span class="hljs-literal">null</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;update status&#x27;</span> })
  <span class="hljs-attr">status</span>: Status;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;rate manuals ordered by effective date, state&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateManualOrderByInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  effectiveDate?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  state?: Prisma.SortOrder;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;policy rates ordered by created at, policy category&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PolicyRateOrderByInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  createdAt?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyType?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyCategory?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  name?: Prisma.SortOrder;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&#x27;endorsement rates order by endorsement ID, rate type, property type&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EndorsementRateOrderByInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  endorsementId?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateType?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  propertyType?: Prisma.SortOrder;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&#x27;endorsement short rates order by endorsement ID, rate type, property type&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EndorsementShortRateOrderByInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  endorsementId?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateType?: Prisma.SortOrder;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  propertyType?: Prisma.SortOrder;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;cpl rates order by protected party&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CPLRateOrderByInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  protectedParty?: Prisma.SortOrder;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;rate tables order by name&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableOrderByInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  name?: Prisma.SortOrder;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;create rate manual input&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateRateManualInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  <span class="hljs-attr">state</span>: StateType;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Date</span>)
  effectiveDate!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  status!: Status;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;underwriter name&#x27;</span> })
  underwriter!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;start from blank or the most recent rate manual&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  copyLatest?: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-meta">@ObjectType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Rate Manual Summary with pagination info&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateManualSummary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RateManual</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;total count of policy rates&#x27;</span> })
  <span class="hljs-attr">policyRatesCount</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;total count of endorsement rates&#x27;</span> })
  <span class="hljs-attr">endorsementRatesCount</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;total count of endorsement short rates&#x27;</span> })
  <span class="hljs-attr">endorsementShortRatesCount</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;total count of rate tables&#x27;</span> })
  <span class="hljs-attr">rateTablesCount</span>: <span class="hljs-built_in">number</span>;
}

</code></pre>
<h4 id=/types/rateTable.ts anchor=true>/types/rateTable.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { InputType, ObjectType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GQL } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;
<span class="hljs-keyword">import</span> { TierType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../generated/type-graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLMoney } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./scalars&#x27;</span>;
<span class="hljs-keyword">import</span> { Money } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utilities&#x27;</span>;

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Rate table tier input&#x27;</span>,
})
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableTierCreateInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  lowerBound!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  upperBound!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> TierType, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  tierType?: TierType;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  flatRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  ratePerAmount?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  perAmount?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  baseTableDiscount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  baseTableId?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The shared payload accepted by rate table mutation.&#x27;</span>,
})
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTableMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Optional =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  name!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RateTableTierCreateInput])
  <span class="hljs-attr">tiers</span>: RateTableTierCreateInput[];
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UpdateRateTableInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RateTableMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateRateTableInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RateTableMutationFields</span> </span>{
  <span class="hljs-comment">// ============ Required =============</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  rateManualId!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>({
  <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The payload returned from the update rate table mutation.&#x27;</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MutateRateTableResponse</span> </span>{
  <span class="hljs-meta">@GQL</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;status of the mutation&#x27;</span> })
  <span class="hljs-attr">status</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>({ <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;id of the created rate table&#x27;</span> })
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
}

</code></pre>
<h4 id=/types/rates.ts anchor=true>/types/rates.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
  ObjectType,
  GQL,
  Root,
  ID,
  Float,
  InputType,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./type-graphql-decorators&#x27;</span>;
<span class="hljs-keyword">import</span> { Money } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utilities&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLMoney } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./scalars&#x27;</span>;
<span class="hljs-keyword">import</span> { GraphQLID } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { PolicyType, policyTypeGraphQLEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./issued-document/policy&#x27;</span>;
<span class="hljs-keyword">import</span> { PolicyCategory } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../generated/type-graphql/&#x27;</span>;
<span class="hljs-keyword">import</span> { purposesGraphQLEnum } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types&#x27;</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { InputPurpose, Purpose } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types&#x27;</span>;

<span class="hljs-comment">// &#x27;type-simple-schema&#x27; requires &#x27;/shared/simple-schema&#x27;, so commenting this out to avoid an additional dependency</span>
<span class="hljs-comment">// import { DB, SimpleSchemaMoney } from &#x27;./type-simple-schema&#x27;;</span>
<span class="hljs-keyword">import</span> { State } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../lib/title-rates/data-structures&#x27;</span>;

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputAddress</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  address1?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  address2?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  city?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  state!: State;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  zipcode?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  counties?: <span class="hljs-built_in">string</span>[];
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputEndorsementSecondaryApiParams</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  isOverride?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  overrideReason?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  price?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputEndorsement</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputEndorsementSecondaryApiParams, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  secondaryApiParams?: RatesInputEndorsementSecondaryApiParams;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputPolicy</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The total amount this policy insures.&#x27;</span>,
  })
  coverageAmount!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RatesInputEndorsement], {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Endorsements on this policy&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  endorsements?: RatesInputEndorsement[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> ID, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;An arbitrary ID to identify this policy. Returned rates will have a matching ID.&#x27;</span>,
  })
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> PolicyCategory, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The category of the policy.&#x27;</span>,
  })
  policyCategory!: PolicyCategory;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The selected form to issue.&#x27;</span>,
  })
  policyFormName!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;The rate type, selected from those available for the transaction.&#x27;</span>,
  })
  rateType!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The rate stat code that should apply to this policy.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  rateTypeStatCode?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;The total amount this policy previously covered, for reissue rates.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  previousCoverageAmount?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> Float, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The age of the previous loan, for refinance rates&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  previousLoanAge?: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The prior policy form name, for reissue rates.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  previousPolicyFormName?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The prior policy rate type, for reissue rates.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  previousRateType?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Date</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The effective date of the policy.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  rateEffectiveDate?: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The ID of the corresponding file in an underwriter portal.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  fileNumber?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RatesInputJuniorLoanInsuranceAmounts], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  juniorLoanInsuranceAmounts?: RatesInputJuniorLoanInsuranceAmounts[];
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputProperty</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputAddress)
  address!: RatesInputAddress;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Qualia Property Types: RESIDENCE_ONE_TO_FOUR_FAMILIES, CONDOMINIUM, LAND_ONLY, etc.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  propertyType?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> change string to PropertyType</span>

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  purpose?: InputPurpose;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputFLEndorsementRate</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  rate!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Either flat rate or percentage, flat rate must be a least $25.00, percentage will be applied to the actual policy premium.&#x27;</span>,
  })
  calculation!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  name!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The id of the endorsement.&#x27;</span>,
  })
  endorsement!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExtendedCoverageStatus</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  policyFormName!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>)
  isExtended!: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputSecondaryApiParams</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  user?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  password?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  agentID?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [ExtendedCoverageStatus], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  extendedCoverageStatusList?: ExtendedCoverageStatus[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  extraRates?: <span class="hljs-built_in">string</span>[];
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInputJuniorLoanInsuranceAmounts</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Number</span>)
  index!: <span class="hljs-built_in">number</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  insuranceAmount!: Money;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;For regular rates from Assure, the Assure user&#x27;s agent ID&quot;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  <span class="hljs-attr">agentID</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;For quoting rates only, the deployment the connect user belongs to&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  <span class="hljs-attr">deployment</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  underwriter!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RatesInputPolicy])
  policies!: RatesInputPolicy[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputProperty)
  property!: RatesInputProperty;

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> make this required when deployed on both core and assure https://qualialabs.atlassian.net/browse/ASSURE-1171</span>
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> purposesGraphQLEnum, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  purpose?: Purpose;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  transactionID?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  flSimultaneousRate?: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RatesInputFLEndorsementRate], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  flEndorsementRates?: RatesInputFLEndorsementRate[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policySplit?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  endorsementSplit?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputSecondaryApiParams, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  secondaryApiParams?: RatesInputSecondaryApiParams;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  overrideSplit?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  includeStagingRates?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;This can be used as a black box field to forward request payloads to Undertaker&#x27;</span>,
  })
  requestBlackBox?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesPayload</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RatesPayloadDocument], {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Includes any simultaneous policies&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  policies?: RatesPayloadDocument[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Includes information about failed rate calculation requests.&#x27;</span>,
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
  })
  status?: <span class="hljs-built_in">string</span>[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;This can be used as a black box field to forward response payloads from Undertaker&#x27;</span>,
  })
  responseBlackBox?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@InputType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTypesInput</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  agentID!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  underwriter!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [policyTypeGraphQLEnum])
  policyFormNames!: PolicyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [<span class="hljs-built_in">String</span>], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  otherPolicyFormNames?: PolicyType[];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputProperty)
  property!: RatesInputProperty;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Date</span>)
  rateEffectiveDate!: <span class="hljs-built_in">Date</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> RatesInputSecondaryApiParams, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  secondaryApiParams?: RatesInputSecondaryApiParams;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">Boolean</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  includeStagingRates?: <span class="hljs-built_in">boolean</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> purposesGraphQLEnum, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  purpose?: Purpose;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;This can be used as a black box field to forward request payloads to Undertaker&#x27;</span>,
  })
  requestBlackBox?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateType</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Human-readable rate type label&#x27;</span>,
  })
  label!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Rate type ID&#x27;</span>,
  })
  id!: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RateTypesPayload</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  policyFormName?: PolicyType;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RateType], { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  rateTypes?: [RateType];

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;This can be used as a black box field to forward response payloads from Undertaker&#x27;</span>,
  })
  responseBlackBox?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestRateConfigurationResponse</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  totalPremium!: Money;
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesPayloadPolicyEndorsement</span> </span>{
  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">String</span>)
  id!: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  underwriterPremium!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  agentPremium!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney)
  totalPremium!: Money;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  disclosedTotalPremium?: Money;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> IRatesPayloadDocument {
  id?: <span class="hljs-built_in">string</span>;
  underwriterPremium: Money;
  agentPremium: Money;
  totalPremium: Money;
  disclosedTotalPremium?: Money;
  endorsements: RatesPayloadPolicyEndorsement[];
}

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RatesPayloadDocument</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> _options: {
      id?: <span class="hljs-built_in">string</span>;
      underwriterPremium: () =&gt; <span class="hljs-built_in">Promise</span>&lt;Money&gt;;
      agentPremium: () =&gt; <span class="hljs-built_in">Promise</span>&lt;Money&gt;;
      totalPremium: () =&gt; <span class="hljs-built_in">Promise</span>&lt;Money&gt;;
      disclosedTotalPremium: () =&gt; <span class="hljs-built_in">Promise</span>&lt;Money | <span class="hljs-literal">undefined</span>&gt;;
      endorsements: () =&gt; <span class="hljs-built_in">Promise</span>&lt;RatesPayloadPolicyEndorsement[]&gt;;
    }
  </span>)</span> {
    <span class="hljs-built_in">this</span>.id = _options.id;
  }

  <span class="hljs-keyword">async</span> resolveAll(): <span class="hljs-built_in">Promise</span>&lt;IRatesPayloadDocument&gt; {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">id</span>: <span class="hljs-built_in">this</span>.id,
      <span class="hljs-attr">underwriterPremium</span>: <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.underwriterPremium(<span class="hljs-built_in">this</span>),
      <span class="hljs-attr">agentPremium</span>: <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.agentPremium(<span class="hljs-built_in">this</span>),
      <span class="hljs-attr">totalPremium</span>: <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.totalPremium(<span class="hljs-built_in">this</span>),
      <span class="hljs-attr">disclosedTotalPremium</span>: <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.disclosedTotalPremium(<span class="hljs-built_in">this</span>),
      <span class="hljs-attr">endorsements</span>: <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.endorsements(<span class="hljs-built_in">this</span>),
    };
  }

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLID, {
    <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;The ID of the policy to which these rates apply, corresponding to an ID from the input.&#x27;</span>,
  })
  id?: <span class="hljs-built_in">string</span>;

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The computed underwriter premium, independent of overrides.&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> underwriterPremium(<span class="hljs-meta">@Root</span>() root: <span class="hljs-built_in">this</span>): <span class="hljs-built_in">Promise</span>&lt;Money&gt; {
    <span class="hljs-keyword">return</span> root._options.underwriterPremium();
  }

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The computed agent premium, independent of overrides.&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> agentPremium(<span class="hljs-meta">@Root</span>() root: <span class="hljs-built_in">this</span>): <span class="hljs-built_in">Promise</span>&lt;Money&gt; {
    <span class="hljs-keyword">return</span> root._options.agentPremium();
  }

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The computed total premium, independent of overrides.&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> totalPremium(<span class="hljs-meta">@Root</span>() root: <span class="hljs-built_in">this</span>): <span class="hljs-built_in">Promise</span>&lt;Money&gt; {
    <span class="hljs-keyword">return</span> root._options.totalPremium();
  }

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> GraphQLMoney, { <span class="hljs-attr">nullable</span>: <span class="hljs-literal">true</span> })
  <span class="hljs-keyword">async</span> disclosedTotalPremium(<span class="hljs-meta">@Root</span>() root: <span class="hljs-built_in">this</span>): <span class="hljs-built_in">Promise</span>&lt;Money | <span class="hljs-literal">undefined</span>&gt; {
    <span class="hljs-keyword">return</span> root._options.disclosedTotalPremium();
  }

  <span class="hljs-meta">@GQL</span>(<span class="hljs-function">() =&gt;</span> [RatesPayloadPolicyEndorsement], {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;The rates attributed to endorsements on the policy.&#x27;</span>,
  })
  <span class="hljs-keyword">async</span> endorsements(
    <span class="hljs-meta">@Root</span>() root: <span class="hljs-built_in">this</span>
  ): <span class="hljs-built_in">Promise</span>&lt;RatesPayloadPolicyEndorsement[]&gt; {
    <span class="hljs-keyword">return</span> root._options.endorsements();
  }
}

</code></pre>
<h4 id=/types/scalars/index.ts anchor=true>/types/scalars/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./money&#x27;</span>;

</code></pre>
<h4 id=/types/scalars/money.ts anchor=true>/types/scalars/money.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { GraphQLScalarType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;graphql&#x27;</span>;
<span class="hljs-keyword">import</span> { Kind } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;graphql/language&#x27;</span>;
<span class="hljs-keyword">import</span> { isMoney, isMoneyString } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utilities&#x27;</span>;
<span class="hljs-keyword">import</span> { logger } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../logger&#x27;</span>;
<span class="hljs-keyword">import</span> { dollarsToCents } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../resolvers/helpers/rates&#x27;</span>;
<span class="hljs-keyword">import</span> { ErrorMessage } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../../errors&#x27;</span>;

<span class="hljs-comment">// TODO move this to a more reasonable place</span>
<span class="hljs-keyword">const</span> parseSafeInteger = (x: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> | <span class="hljs-function"><span class="hljs-params">null</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">&#x27;string&#x27;</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[-+]?\d+$/</span>.test(x)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// eslint-disable-next-line no-param-reassign</span>
      x = <span class="hljs-built_in">Number</span>(x);
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Number</span>.isSafeInteger(x) ? x : <span class="hljs-literal">null</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> GraphQLMoney = <span class="hljs-keyword">new</span> GraphQLScalarType({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Money&#x27;</span>,
  <span class="hljs-attr">description</span>:
    <span class="hljs-string">&#x27;Money represented as a number or as dollars and cents (string representation)&#x27;</span>,
  <span class="hljs-function"><span class="hljs-title">parseValue</span>(<span class="hljs-params">value</span>)</span> {
    <span class="hljs-keyword">let</span> parsedValue = value;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">&#x27;string&#x27;</span> &amp;&amp; isMoneyString(value)) {
      parsedValue = dollarsToCents(<span class="hljs-built_in">parseFloat</span>(parsedValue <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>));
    }

    <span class="hljs-keyword">if</span> (!isMoney(parsedValue)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
        <span class="hljs-string">`<span class="hljs-subst">${
          ErrorMessage.INVALID_MONEY_VALUE
        }</span> Received: <span class="hljs-subst">${value}</span>, type: <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> value}</span>`</span>
      );
    }

    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Number</span>.isInteger(parsedValue)) {
      parsedValue = <span class="hljs-built_in">parseFloat</span>(parsedValue.toFixed(<span class="hljs-number">2</span>));
    }

    <span class="hljs-keyword">return</span> parsedValue;
  },
  <span class="hljs-function"><span class="hljs-title">serialize</span>(<span class="hljs-params">value</span>)</span> {
    <span class="hljs-keyword">return</span> value;
  },
});

</code></pre>
<h4 id=/types/type-graphql-decorators.ts anchor=true>/types/type-graphql-decorators.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;reflect-metadata&#x27;</span>; <span class="hljs-comment">// Requirement for type-graphql</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> typeGraphQL <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ID = typeGraphQL.ID;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> GQL = typeGraphQL.Field;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> InputType = typeGraphQL.InputType;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Mutation = typeGraphQL.Mutation;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ObjectType = typeGraphQL.ObjectType;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Query = typeGraphQL.Query;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Resolver = typeGraphQL.Resolver;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Root = typeGraphQL.Root;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Float = typeGraphQL.Float;

<span class="hljs-comment">/**
 * Returns an object to be used as an enum with TypeGraphQL. The package does
 * not have support for scalar union types, so we use this workaround instead.
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> registerEnum = <span class="hljs-function">(<span class="hljs-params">
  values: { [key: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> },
  config: Parameters&lt;<span class="hljs-keyword">typeof</span> typeGraphQL.registerEnumType&gt;[<span class="hljs-number">1</span>]
</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> fakeEnum = <span class="hljs-built_in">Object</span>.fromEntries(
    <span class="hljs-built_in">Object</span>.keys(values).map(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> [key, key])
  );
  <span class="hljs-keyword">const</span> valuesConfig = <span class="hljs-built_in">Object</span>.fromEntries(
    <span class="hljs-built_in">Object</span>.entries(values).map(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> [key, { <span class="hljs-attr">description</span>: value }])
  );
  typeGraphQL.registerEnumType(fakeEnum, { valuesConfig, ...config });
  <span class="hljs-keyword">return</span> fakeEnum;
};

</code></pre>
<h4 id=/types/viewer.ts anchor=true>/types/viewer.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Field, ObjectType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;

<span class="hljs-meta">@ObjectType</span>()
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Viewer</span> </span>{
  <span class="hljs-meta">@Field</span>()
  <span class="hljs-attr">orgId</span>: <span class="hljs-built_in">string</span>;

  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">orgId: <span class="hljs-built_in">string</span></span>)</span> {
    <span class="hljs-built_in">this</span>.orgId = orgId;
  }
}

</code></pre>
<h4 id=/utilities/index.ts anchor=true>/utilities/index.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> fetch, { FetchError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;node-fetch&#x27;</span>;
<span class="hljs-keyword">import</span> {
  UndertakerError,
  UndertakerErrorType,
  UndertakerServerError,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../errors&#x27;</span>;
<span class="hljs-keyword">import</span> { is } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../lib&#x27;</span>;
<span class="hljs-keyword">import</span> {
  FeesInput,
  RatesInput,
  RateTypesInput,
  ExtendedCoverageStatus,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types&#x27;</span>;
<span class="hljs-keyword">import</span> { unmapPropertyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./propertyTypes&#x27;</span>;
<span class="hljs-keyword">import</span> { Context } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../context&#x27;</span>;
<span class="hljs-keyword">import</span> { dollarsToCents } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../resolvers/helpers/rates&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Money = <span class="hljs-built_in">number</span> &amp; { <span class="hljs-attr">_BRAND_Money</span>: <span class="hljs-literal">true</span> };

<span class="hljs-keyword">const</span> INFINITY = -<span class="hljs-number">1</span>;

<span class="hljs-keyword">const</span> isSafeNumber = (value: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Number</span>.isInteger(value)) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Number</span>.isSafeInteger(value);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Number</span>.isFinite(value) || <span class="hljs-built_in">Number</span>.isNaN(value)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isMoney = (money: unknown): money is Money =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-keyword">typeof</span> money === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp;
    isSafeNumber(money) &amp;&amp;
    (money &gt;= <span class="hljs-number">0</span> || money === INFINITY)
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isMoneyString = (money: unknown): money is Money =&gt; {
  <span class="hljs-keyword">let</span> parsedMoney = money;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> parsedMoney === <span class="hljs-string">&#x27;string&#x27;</span>) {
    <span class="hljs-keyword">try</span> {
      parsedMoney = dollarsToCents(<span class="hljs-built_in">parseFloat</span>(parsedMoney));
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-keyword">return</span> isMoney(parsedMoney);
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isAccountingMoney = (money: unknown): money is Money =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> money === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp; <span class="hljs-built_in">Number</span>.isSafeInteger(money);
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getMoney = (money: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">Money</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (!isAccountingMoney(money)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`invalid-money: <span class="hljs-subst">${money}</span>`</span>);
  }
  <span class="hljs-keyword">return</span> money;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> joinWithCommasAnd = <span class="hljs-function">(<span class="hljs-params">strings: ReadonlyArray&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (strings.length &lt; <span class="hljs-number">3</span>) {
    <span class="hljs-keyword">return</span> strings.join(<span class="hljs-string">&#x27; and &#x27;</span>);
  }
  <span class="hljs-keyword">const</span> initial = strings.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>).join(<span class="hljs-string">&#x27;, &#x27;</span>);
  <span class="hljs-keyword">const</span> last = strings[strings.length - <span class="hljs-number">1</span>];

  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${initial}</span>, and <span class="hljs-subst">${last}</span>`</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> centsToDollars = <span class="hljs-function">(<span class="hljs-params">cents: Readonly&lt;Money&gt;</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> cents !== <span class="hljs-string">&#x27;number&#x27;</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
      <span class="hljs-string">`Impossible state: &quot;<span class="hljs-subst">${cents}</span>&quot; was passed which should be of type Money.`</span>
    );
  }

  <span class="hljs-keyword">const</span> dollars = <span class="hljs-built_in">Array</span>.from(<span class="hljs-built_in">Math</span>.floor(cents / <span class="hljs-number">100</span>).toString())
    .reduce(<span class="hljs-function">(<span class="hljs-params">digitCommaArray: <span class="hljs-built_in">string</span>[], digit, index, unformattedDollars</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> distanceFromEnd = unformattedDollars.length - index;
      <span class="hljs-keyword">if</span> (distanceFromEnd % <span class="hljs-number">3</span> === <span class="hljs-number">0</span> &amp;&amp; index !== <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> [...digitCommaArray, <span class="hljs-string">&#x27;,&#x27;</span>, digit];
      }
      <span class="hljs-keyword">return</span> [...digitCommaArray, digit];
    }, [])
    .join(<span class="hljs-string">&#x27;&#x27;</span>);
  <span class="hljs-keyword">const</span> formattedCents = <span class="hljs-string">`<span class="hljs-subst">${cents % <span class="hljs-number">100</span>}</span>`</span>.padStart(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${dollars}</span>.<span class="hljs-subst">${formattedCents}</span>`</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> notNullish = &lt;T&gt;(x: T | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>): x is T =&gt; {
  <span class="hljs-keyword">return</span> x !== <span class="hljs-literal">null</span> &amp;&amp; x !== <span class="hljs-literal">undefined</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> truthy = &lt;T&gt;(x: T | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">false</span> | <span class="hljs-number">0</span> | <span class="hljs-string">&#x27;&#x27;</span>): x is T =&gt; {
  <span class="hljs-keyword">return</span> x !== <span class="hljs-literal">null</span> &amp;&amp; x !== <span class="hljs-literal">undefined</span> &amp;&amp; x !== <span class="hljs-literal">false</span> &amp;&amp; x !== <span class="hljs-number">0</span> &amp;&amp; x !== <span class="hljs-string">&#x27;&#x27;</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> unique = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">arr: T[]</span>) =&gt;</span> [...new <span class="hljs-built_in">Set</span>(arr)];

<span class="hljs-comment">/** This helper function provides a visually cleaner way to conditionally
 * return arrays that would otherwise necessitate an inline ternary
 * expression. It can also be used to shorten conditional expressions
 * that return empty arrays under certain conditions. The most common
 * use case is splicing elements into an array based on a feature flag
 * value.
 *
 * - When `cond` is false, `[]` is returned.
 * - When `cond` is true, the `...items` spread args are returned.
 *
 * Example:
 *
 * ```
 * let contains456 = true;
 * [1, 2, 3, ...fillArrayIf(contains456, 4, 5, 6)]
 * // =&gt; [1, 2, 3, 4, 5, 6]
 *
 * contains456 = false;
 * [1, 2, 3, ...fillArrayIf(contains456, 4, 5, 6)]
 * // =&gt; [1, 2, 3];
 * ```
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> fillArrayIf = &lt;T extends unknown[]&gt;(
  cond: boolean,
  ...items: T
): T | [] =&gt; (cond ? items : []);

/** Returns a shallow copy of the input object but with `keys` omitted
 * from the output object.
 * This is a type-safe alternative to _.omit() */
export const omit = &lt;T, E extends keyof T&gt;(
  obj: T,
  ...keys: E[]
): { [K in Exclude&lt;keyof T, E&gt;]: T[K] } =&gt; {
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  const entries = Object.entries(obj as any).filter(
    ([k]) =&gt; !keys.includes(k as E)
  );
  return Object.fromEntries(entries) as { [K in Exclude&lt;keyof T, E&gt;]: T[K] };
};

// no-op function
export const noop = () =&gt; {};

export const getBidirectionalMap = &lt;K extends string, V extends string&gt;(
  keyValueTuples: [K, V][]
) =&gt; {
  const keys = keyValueTuples.map(([key]) =&gt; key);
  const values = keyValueTuples.map(([, value]) =&gt; value);

  if (
    unique(keys).length !== keys.length ||
    unique(values).length !== values.length
  ) {
    throw new Error(&#x27;all keys and values must be unique&#x27;);
  }

  const map = Object.fromEntries(keyValueTuples) as Record&lt;
    typeof keys[number],
    typeof values[number]
  &gt;;
  const invertedMap = Object.fromEntries(
    keyValueTuples.map(([key, value]) =&gt; [value, key])
  ) as Record&lt;typeof values[number], typeof keys[number]&gt;;

  return { keys, values, map, invertedMap };
};

export const capitalize = (str: string) =&gt; {
  if (str.length === 0) {
    return &#x27;&#x27;;
  }
  return `${str[0].toUpperCase()}${str.slice(1)}`;
};

export const capitalizeFirstLetterOnly = (str: string) =&gt; {
  if (str.length === 0) {
    return &#x27;&#x27;;
  }

  return capitalize(str.toLowerCase());
};

// Undertaker utilities
export const getEndpoint = (organization: string) =&gt; {
  const endpoint = {
    demo: &#x27;amtrust_internal&#x27;,
    pulsar: &#x27;pulsar_internal&#x27;,
    swltic: &#x27;southwest_land_title&#x27;,
    amtrust: &#x27;amtrust_internal&#x27;,
    lighthouse: &#x27;lighthouse_internal&#x27;,
    ameagle: &#x27;ameagle_internal&#x27;,
  }[organization];
  if (!endpoint) {
    return organization;
    // throw new Error(`invalid-organization: The organization &quot;${organization}&quot; is not supported.`);
  }
  return endpoint;
};

export const makeRequest = async (
  endpoint: string,
  body: unknown,
  context: Context
): Promise&lt;unknown&gt; =&gt; {
  let response: unknown;
  try {
    response = await fetch(
      `${process.env.TITLE_RATES_MULTITENANT_UNDERTAKER_URL}/${endpoint}`,
      {
        method: &#x27;post&#x27;,
        body: JSON.stringify(body),
        headers: {
          &#x27;Content-Type&#x27;: &#x27;application/json&#x27;,
          &#x27;x-distributed-transaction-id&#x27;:
            context.distributedTransactionId ?? &#x27;&#x27;,
          &#x27;x-deployment&#x27;: context.deployment ?? &#x27;&#x27;,
        },
      }
    ).then((data) =&gt; data.json());
  } catch (error) {
    if (error instanceof FetchError) {
      throw new UndertakerServerError();
    } else {
      throw error;
    }
  }

  if (
    is.plainObject(response) &amp;&amp;
    is.plainObject(response.error) &amp;&amp;
    is.string(response.error.message)
  ) {
    throw new UndertakerError(response as UndertakerErrorType);
  }

  return response;
};

export const getUndertakerProperty = ({
  property,
  purpose,
}: RatesInput | RateTypesInput | FeesInput) =&gt; {
  // TODO: Remove optional chaining on the property field below
  // once we phase out FeesInput
  return {
    address_1: property?.address.address1,
    address_2: property?.address.address2,
    city: property?.address.city,
    state: property?.address.state,
    state_code: property?.address.state,
    zipcode: property?.address.zipcode,
    county: property?.address?.counties?.[0],
    // Although Core always sends over the propertyType, we&#x27;re not sure if
    // Resware does, so we provide a sane default.
    property_type: property?.propertyType
      ? unmapPropertyType(property?.propertyType)
      : &#x27;Residence (1-4 Families)&#x27;,
    purpose: capitalizeFirstLetterOnly(property?.purpose || purpose || &#x27;&#x27;),
  };
};

export const getUndertakerExtendedCoverageStatus = (
  extendedCoverageStatusList: ExtendedCoverageStatus[]
): Record&lt;string, boolean&gt; =&gt; {
  const output: Record&lt;string, boolean&gt; = {};

  extendedCoverageStatusList.forEach((status: ExtendedCoverageStatus) =&gt; {
    output[status.policyFormName.toLowerCase()] = status.isExtended;
  });

  return output;
};

</code></pre>
<h4 id=/utilities/propertyTypes.ts anchor=true>/utilities/propertyTypes.ts</h4>
<p><a href="#Contents">to top</a></p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { propertyTypes, propertyTypesArray } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { PropertyType } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../types&#x27;</span>;
<span class="hljs-keyword">import</span> { is } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../lib&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> unmapPropertyType = <span class="hljs-function">(<span class="hljs-params">propertyType: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!is.value(...propertyTypesArray)(propertyType)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
      <span class="hljs-string">`invalid-property-type: The property type &quot;<span class="hljs-subst">${propertyType}</span>&quot; is not valid.`</span>
    );
  }

  <span class="hljs-keyword">return</span> propertyTypes[propertyType];
};

<span class="hljs-comment">/* A map from property types to associated information,
   copied from services/qualia/app/packages/qualia_property-types/lib/property_types.js */</span>
<span class="hljs-keyword">const</span> propertyTypeInfoMap = {
  <span class="hljs-attr">RESIDENCE_ONE_TO_FOUR_FAMILIES</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A property designed for a single family occupancy, with a single address.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;r&#x27;</span>,
  },
  <span class="hljs-attr">RESIDENCE_FIVE_PLUS_FAMILIES</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A property designed for multiple families (up to an amount specified by the state).&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;c&#x27;</span>,
  },
  <span class="hljs-attr">COMMERCIAL</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;A property zoned for business purposes.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;c&#x27;</span>,
  },
  <span class="hljs-attr">CONDOMINIUM</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;An individually-owned unit in an apartment building (or a house of more than 1 units) with common areas shared by all unit owners.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;r&#x27;</span>,
  },
  <span class="hljs-attr">PLANNED_UNIT_DEVELOPMENT</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A designed grouping for town homes and condominiums, recreation, commercial centers, and industrial parks within one contained subdivision.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">LAND_AND_BUILDINGS</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Only the land and buildings on a property.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">LAND_ONLY</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;Only the land on a property.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">LEASEHOLD</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Rights to property are negotiated as a separate lease agreement, like a co-op.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">COMMERCIAL_LEASEHOLD</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Rights to commercial property are negotiated as a separate lease agreement, like a co-op.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;c&#x27;</span>,
  },
  <span class="hljs-attr">MANUFACTURED_HOME</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A manufactured home or mobile home attached to a concrete foundation.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;r&#x27;</span>,
  },
  <span class="hljs-attr">MOBILE_HOME</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;A mobile home not attached to a concrete foundation.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;r&#x27;</span>,
  },
  <span class="hljs-attr">WETLANDS</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;A land area that is either permanently or seasonally saturated with water.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">MIXED_USE</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Property that includes both commercial and residential space.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">AGRICULTURAL_LAND</span>: {
    <span class="hljs-attr">description</span>: <span class="hljs-string">&#x27;A land area typically devoted to agriculture.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
  <span class="hljs-attr">NATIVE_AMERICAN_LANDS</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Federally recognized American Indian Reservations and trust lands.&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;r&#x27;</span>,
  },
  <span class="hljs-attr">US_FISH_AND_WILDLIFE</span>: {
    <span class="hljs-attr">description</span>:
      <span class="hljs-string">&#x27;Lands under the management of the U.S. Fish and Wildlife Services&#x27;</span>,
    <span class="hljs-attr">categories</span>: [<span class="hljs-string">&#x27;c&#x27;</span>],
    <span class="hljs-attr">firstAmericanMap</span>: <span class="hljs-string">&#x27;nr&#x27;</span>,
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> hasMultipleLandUseTypes = <span class="hljs-function">(<span class="hljs-params">propertyType: PropertyType</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> info = propertyTypeInfoMap[propertyType];
  <span class="hljs-keyword">if</span> (!info) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">const</span> categories = info.categories;
  <span class="hljs-keyword">if</span> (!categories) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">return</span> categories.length &gt; <span class="hljs-number">1</span>;
};

</code></pre>
</article>

            
        <script src="file:///Users/joshchen/projects/repo-to-pdf/html5bp/js/vendor/jquery-1.10.2.min.js"></script>
        <script src="file:///Users/joshchen/projects/repo-to-pdf/html5bp/js/plugins.js"></script>
        <script src="file:///Users/joshchen/projects/repo-to-pdf/html5bp/js/main.js"></script>
    </body>
</html>
